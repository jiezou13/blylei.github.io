{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"index.html","text":"","title":"\u9996\u9875"},{"location":"about.html","text":"\u5173\u4e8e\u6211 \u00b6 \u57fa\u672c\u4fe1\u606f \u00b6 \u8054\u7cfb\u65b9\u5f0f \u00b6 Github : blylei \u90ae\u7bb1: blylei@163.com blylei.info@gmail.com \u804c\u4e1a\u89c4\u5212 \u00b6 MySQL DBA \u2192 \u6570\u636e\u5e93\u67b6\u6784\u5e08 \u5f00\u6e90\u9879\u76ee \u00b6 frabit : MySQL\u6570\u636e\u5e93\u5907\u4efd\u5de5\u5177 frabit-web \uff1afrabit\u5ba2\u6237\u7aef\u7684web\u7ba1\u7406\u754c\u9762 frabit-server \uff1afrabit\u670d\u52a1\u7aef\u7684\u7f16\u6392\u5668/\u8c03\u5ea6\u5668 \u5de5\u4f5c\u7ecf\u5386 \u00b6 \u9879\u76ee\u7ecf\u5386 \u00b6","title":"\u5173\u4e8e\u6211"},{"location":"about.html#_1","text":"","title":"\u5173\u4e8e\u6211"},{"location":"about.html#_2","text":"","title":"\u57fa\u672c\u4fe1\u606f"},{"location":"about.html#_3","text":"Github : blylei \u90ae\u7bb1: blylei@163.com blylei.info@gmail.com","title":"\u8054\u7cfb\u65b9\u5f0f"},{"location":"about.html#_4","text":"MySQL DBA \u2192 \u6570\u636e\u5e93\u67b6\u6784\u5e08","title":"\u804c\u4e1a\u89c4\u5212"},{"location":"about.html#_5","text":"frabit : MySQL\u6570\u636e\u5e93\u5907\u4efd\u5de5\u5177 frabit-web \uff1afrabit\u5ba2\u6237\u7aef\u7684web\u7ba1\u7406\u754c\u9762 frabit-server \uff1afrabit\u670d\u52a1\u7aef\u7684\u7f16\u6392\u5668/\u8c03\u5ea6\u5668","title":"\u5f00\u6e90\u9879\u76ee"},{"location":"about.html#_6","text":"","title":"\u5de5\u4f5c\u7ecf\u5386"},{"location":"about.html#_7","text":"","title":"\u9879\u76ee\u7ecf\u5386"},{"location":"resume.html","text":"","title":"Resume"},{"location":"archiver/index.html","text":"Blylei\u7684\u535a\u5ba2 \u00b6 \u6b64\u535a\u5ba2\u5e73\u53f0\u4e3b\u8981\u5206\u4eab\u672c\u4eba\u5728\u5b9e\u9645\u5de5\u4f5c\u4e2d\u5173\u4e8eMySQL\u3001Redis\u3001MongoDB\u7684\u5b9e\u8df5\uff0c\u5b66\u4e60\u8bb0\u5f55\uff0c\u4e5f\u5305\u542b\u4e00\u4e9b\u77e5\u540d\u535a\u5ba2\u7684\u7ffb\u8bd1\u7b49 \u535a\u5ba2\u5206\u7c7b \u00b6 MySQL\u76f8\u5173 \u00b6 MySQL\u76f8\u5173\u7684\u535a\u5ba2\u5305\u542b\u65e5\u5e38\u7684\u6700\u4f73\u5b9e\u8df5\u3001\u77e5\u540d\u535a\u5ba2\u7ffb\u8bd1\u7b49,\u53ef\u5206\u4e3a\u4ee5\u4e0b3\u7c7b \u57fa\u7840\u7bc7 : MySQL\u57fa\u7840\u77e5\u8bc6\uff0c\u6bd4\u5982\u5b89\u88c5\u90e8\u7f72\u3001\u8d26\u53f7\u6743\u9650\u7ba1\u7406\u3001\u5907\u4efd\u6062\u590d\u7ba1\u7406\u7b49 \u9ad8\u6027\u80fd\u7bc7 : MySQL\u6027\u80fd\u4f18\u5316\u7684\u5185\u5bb9\uff0c\u6bd4\u5982\u914d\u7f6e\u53c2\u6570\u4f18\u5316\u3001\u7d22\u5f15\u4f18\u5316\u3001\u67e5\u8be2\u4f18\u5316\u7b49 \u9ad8\u53ef\u7528\u7bc7 : MySQL\u9ad8\u53ef\u7528\u7684\u5185\u5bb9\uff0c\u6bd4\u5982\u4e3b\u4ece\u590d\u5236\u3001\u8d1f\u8f7d\u5747\u8861/\u8bfb\u5199\u5206\u79bb\uff0c\u5206\u5e93\u5206\u8868\u7b49 Redis\u76f8\u5173 \u00b6 Redis\u76f8\u5173\u7684\u535a\u5ba2\u5305\u542b\u65e5\u5e38\u7684\u6700\u4f73\u5b9e\u8df5\u3001\u77e5\u540d\u535a\u5ba2\u6216\u8005\u5b98\u65b9\u624b\u518c\u7ae0\u8282\u7ffb\u8bd1\u7b49\uff0c\u53ef\u5206\u4e3a\u4ee5\u4e0b3\u7c7b \u57fa\u7840\u7bc7 : Redis\u57fa\u7840\u77e5\u8bc6\uff0c\u6bd4\u5982\u5b89\u88c5\u90e8\u7f72\u3001\u914d\u7f6e\u9879\u53d8\u66f4\u3001\u5907\u4efd\u6062\u590d\u7b49 \u54e8\u5175\u7bc7 : \u4e3b\u8981\u5206\u4eabRedis\u54e8\u5175\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u6bd4\u5982\u54e8\u5175\u90e8\u7f72\u3001\u54e8\u5175failover\u3001\u54e8\u5175\u5b9e\u4f8b\u6570\u8c03\u6574\u7b49 \u5206\u7247\u96c6\u7fa4\u7bc7 : \u4e3b\u8981\u5206\u4eabRedis\u5206\u7247\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u6bd4\u5982Redis cluster\u7684\u90e8\u7f72\uff0c\u96c6\u7fa4\u67e5\u8be2\u91cd\u5b9a\u5411 \uff0c\u5206\u7247rebalance\u7b49 MongoDB\u76f8\u5173 \u00b6 MongoDB\u76f8\u5173\u7684\u535a\u5ba2\u5305\u542b\u65e5\u5e38\u6700\u4f73\u5b9e\u8df5\u3001\u5b66\u4e60\u8bb0\u5f55\u3001\u5b98\u65b9\u624b\u518c\u7ae0\u8282\u7ffb\u8bd1\u7b49\uff0c\u53ef\u5206\u4e3a\u4ee5\u4e0b3\u7c7b \u57fa\u7840\u7bc7 : \u4e3b\u8981\u5206\u4eabMongoDB\u90e8\u7f72\u3001\u5347\u7ea7\uff0c\u6743\u9650\u7ba1\u7406\u3001\u5907\u4efd\u6062\u590d\u7b49 \u590d\u5236\u96c6\u7bc7 : \u4e3b\u8981\u5206\u4eab\u590d\u5236\u96c6\u76f8\u5173\u7684\u5185\u5bb9\uff1b\u6bd4\u5982\u590d\u5236\u96c6\u7684\u90e8\u7f72\u3001\u6570\u636e\u521d\u59cb\u5316\u3001\u6545\u969c\u8bca\u65ad\u7b49 \u5206\u7247\u96c6\u7fa4 : \u4e3b\u8981\u5206\u4eab\u5206\u7247\u96c6\u7fa4\u76f8\u5173\u7684\u5185\u5bb9\uff1b\u6bd4\u5982\u5206\u7247\u96c6\u7fa4\u90e8\u7f72\uff0c\u5e38\u89c1\u90e8\u7f72\u67b6\u6784\u7b49 \u5df2\u5f52\u6863 \u00b6 \u4ee5\u81ea\u7136\u5e74\u4e3a\u5206\u754c\u7ebf\uff0c\u8d85\u8fc71\u5e74\u7684\u535a\u5ba2\u4f1a\u88ab\u5f52\u6863\u5230\u6b64\u5904 MySQL\u76f8\u5173 Redis\u76f8\u5173 MongoDB\u76f8\u5173","title":"\u5df2\u5f52\u6863"},{"location":"archiver/index.html#blylei","text":"\u6b64\u535a\u5ba2\u5e73\u53f0\u4e3b\u8981\u5206\u4eab\u672c\u4eba\u5728\u5b9e\u9645\u5de5\u4f5c\u4e2d\u5173\u4e8eMySQL\u3001Redis\u3001MongoDB\u7684\u5b9e\u8df5\uff0c\u5b66\u4e60\u8bb0\u5f55\uff0c\u4e5f\u5305\u542b\u4e00\u4e9b\u77e5\u540d\u535a\u5ba2\u7684\u7ffb\u8bd1\u7b49","title":"Blylei\u7684\u535a\u5ba2"},{"location":"archiver/index.html#_1","text":"","title":"\u535a\u5ba2\u5206\u7c7b"},{"location":"archiver/index.html#mysql","text":"MySQL\u76f8\u5173\u7684\u535a\u5ba2\u5305\u542b\u65e5\u5e38\u7684\u6700\u4f73\u5b9e\u8df5\u3001\u77e5\u540d\u535a\u5ba2\u7ffb\u8bd1\u7b49,\u53ef\u5206\u4e3a\u4ee5\u4e0b3\u7c7b \u57fa\u7840\u7bc7 : MySQL\u57fa\u7840\u77e5\u8bc6\uff0c\u6bd4\u5982\u5b89\u88c5\u90e8\u7f72\u3001\u8d26\u53f7\u6743\u9650\u7ba1\u7406\u3001\u5907\u4efd\u6062\u590d\u7ba1\u7406\u7b49 \u9ad8\u6027\u80fd\u7bc7 : MySQL\u6027\u80fd\u4f18\u5316\u7684\u5185\u5bb9\uff0c\u6bd4\u5982\u914d\u7f6e\u53c2\u6570\u4f18\u5316\u3001\u7d22\u5f15\u4f18\u5316\u3001\u67e5\u8be2\u4f18\u5316\u7b49 \u9ad8\u53ef\u7528\u7bc7 : MySQL\u9ad8\u53ef\u7528\u7684\u5185\u5bb9\uff0c\u6bd4\u5982\u4e3b\u4ece\u590d\u5236\u3001\u8d1f\u8f7d\u5747\u8861/\u8bfb\u5199\u5206\u79bb\uff0c\u5206\u5e93\u5206\u8868\u7b49","title":"MySQL\u76f8\u5173"},{"location":"archiver/index.html#redis","text":"Redis\u76f8\u5173\u7684\u535a\u5ba2\u5305\u542b\u65e5\u5e38\u7684\u6700\u4f73\u5b9e\u8df5\u3001\u77e5\u540d\u535a\u5ba2\u6216\u8005\u5b98\u65b9\u624b\u518c\u7ae0\u8282\u7ffb\u8bd1\u7b49\uff0c\u53ef\u5206\u4e3a\u4ee5\u4e0b3\u7c7b \u57fa\u7840\u7bc7 : Redis\u57fa\u7840\u77e5\u8bc6\uff0c\u6bd4\u5982\u5b89\u88c5\u90e8\u7f72\u3001\u914d\u7f6e\u9879\u53d8\u66f4\u3001\u5907\u4efd\u6062\u590d\u7b49 \u54e8\u5175\u7bc7 : \u4e3b\u8981\u5206\u4eabRedis\u54e8\u5175\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u6bd4\u5982\u54e8\u5175\u90e8\u7f72\u3001\u54e8\u5175failover\u3001\u54e8\u5175\u5b9e\u4f8b\u6570\u8c03\u6574\u7b49 \u5206\u7247\u96c6\u7fa4\u7bc7 : \u4e3b\u8981\u5206\u4eabRedis\u5206\u7247\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u6bd4\u5982Redis cluster\u7684\u90e8\u7f72\uff0c\u96c6\u7fa4\u67e5\u8be2\u91cd\u5b9a\u5411 \uff0c\u5206\u7247rebalance\u7b49","title":"Redis\u76f8\u5173"},{"location":"archiver/index.html#mongodb","text":"MongoDB\u76f8\u5173\u7684\u535a\u5ba2\u5305\u542b\u65e5\u5e38\u6700\u4f73\u5b9e\u8df5\u3001\u5b66\u4e60\u8bb0\u5f55\u3001\u5b98\u65b9\u624b\u518c\u7ae0\u8282\u7ffb\u8bd1\u7b49\uff0c\u53ef\u5206\u4e3a\u4ee5\u4e0b3\u7c7b \u57fa\u7840\u7bc7 : \u4e3b\u8981\u5206\u4eabMongoDB\u90e8\u7f72\u3001\u5347\u7ea7\uff0c\u6743\u9650\u7ba1\u7406\u3001\u5907\u4efd\u6062\u590d\u7b49 \u590d\u5236\u96c6\u7bc7 : \u4e3b\u8981\u5206\u4eab\u590d\u5236\u96c6\u76f8\u5173\u7684\u5185\u5bb9\uff1b\u6bd4\u5982\u590d\u5236\u96c6\u7684\u90e8\u7f72\u3001\u6570\u636e\u521d\u59cb\u5316\u3001\u6545\u969c\u8bca\u65ad\u7b49 \u5206\u7247\u96c6\u7fa4 : \u4e3b\u8981\u5206\u4eab\u5206\u7247\u96c6\u7fa4\u76f8\u5173\u7684\u5185\u5bb9\uff1b\u6bd4\u5982\u5206\u7247\u96c6\u7fa4\u90e8\u7f72\uff0c\u5e38\u89c1\u90e8\u7f72\u67b6\u6784\u7b49","title":"MongoDB\u76f8\u5173"},{"location":"archiver/index.html#_2","text":"\u4ee5\u81ea\u7136\u5e74\u4e3a\u5206\u754c\u7ebf\uff0c\u8d85\u8fc71\u5e74\u7684\u535a\u5ba2\u4f1a\u88ab\u5f52\u6863\u5230\u6b64\u5904 MySQL\u76f8\u5173 Redis\u76f8\u5173 MongoDB\u76f8\u5173","title":"\u5df2\u5f52\u6863"},{"location":"archiver/mongodb/index.html","text":"\u5df2\u5f52\u6863 \u00b6 MySQL \u00b6 Redis \u00b6 MongoDB \u00b6","title":"\u5df2\u5f52\u6863"},{"location":"archiver/mongodb/index.html#_1","text":"","title":"\u5df2\u5f52\u6863"},{"location":"archiver/mongodb/index.html#mysql","text":"","title":"MySQL"},{"location":"archiver/mongodb/index.html#redis","text":"","title":"Redis"},{"location":"archiver/mongodb/index.html#mongodb","text":"","title":"MongoDB"},{"location":"archiver/mysql/index.html","text":"\u5df2\u5f52\u6863 \u00b6 MySQL \u00b6 Redis \u00b6 MongoDB \u00b6","title":"\u5df2\u5f52\u6863"},{"location":"archiver/mysql/index.html#_1","text":"","title":"\u5df2\u5f52\u6863"},{"location":"archiver/mysql/index.html#mysql","text":"","title":"MySQL"},{"location":"archiver/mysql/index.html#redis","text":"","title":"Redis"},{"location":"archiver/mysql/index.html#mongodb","text":"","title":"MongoDB"},{"location":"archiver/redis/index.html","text":"\u5df2\u5f52\u6863 \u00b6 MySQL \u00b6 Redis \u00b6 MongoDB \u00b6","title":"\u5df2\u5f52\u6863"},{"location":"archiver/redis/index.html#_1","text":"","title":"\u5df2\u5f52\u6863"},{"location":"archiver/redis/index.html#mysql","text":"","title":"MySQL"},{"location":"archiver/redis/index.html#redis","text":"","title":"Redis"},{"location":"archiver/redis/index.html#mongodb","text":"","title":"MongoDB"},{"location":"mongodb/index.html","text":"","title":"Index"},{"location":"mongodb/basic/index.html","text":"MongoDB-\u57fa\u7840\u7bc7 \u00b6","title":"\u57fa\u7840"},{"location":"mongodb/basic/index.html#mongodb-","text":"","title":"MongoDB-\u57fa\u7840\u7bc7"},{"location":"mongodb/rs/index.html","text":"MongoDB-\u590d\u5236\u96c6\u7bc7 \u00b6 1\u3001MongoDB\u590d\u5236\u96c6\u5e94\u6025\u5207\u6362 2\u3001MongoDB\u590d\u5236\u96c6\u90e8\u7f72","title":"\u590d\u5236\u96c6"},{"location":"mongodb/rs/index.html#mongodb-","text":"1\u3001MongoDB\u590d\u5236\u96c6\u5e94\u6025\u5207\u6362 2\u3001MongoDB\u590d\u5236\u96c6\u90e8\u7f72","title":"MongoDB-\u590d\u5236\u96c6\u7bc7"},{"location":"mongodb/rs/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html","text":"MongoDB\u526f\u672c\u96c6\u5e94\u6025\u5207\u6362 \u00b6 1\u3001\u90e8\u7f72\u60c5\u51b5\u7b80\u4ecb \u00b6 \u90e8\u7f72\u673a\u623f:A\u673a\u623f\u3010\u4e3b\u3011 + B\u673a\u623f\u3010\u5907\u3011 \u526f\u672c\u96c6\u6210\u5458\uff1a 192.168.100.112\u3010\u4e3b\u3011: mongodb01.frabitech.local 192.168.100.113\u3010\u5907\u3011: mongodb02.frabitech.local 192.168.100.114\u3010\u5bb9\u707e\u3011: mongodb03.frabitech.local 2\u3001\u5e94\u6025\u5207\u6362\u6b65\u9aa4 \u00b6 \u5728A\u673a\u623f\u673a\u623f\u51fa\u6545\u969c\u65f6\uff0c\u653e\u7f6e\u5728B\u673a\u623f\u7684\u8282\u70b9\u5c06\u53d8\u6210\u53ea\u8bfb\uff0c\u540c\u65f6\u65e0\u6cd5\u9009\u51fa\u4e3b\u8282\u70b9\u3002\u6b64\u65f6\u4e3a\u4e86\u8ba9\u4e1a\u52a1\u5feb\u901f\u6062\u590d\uff0c\u9700\u8981\u4eba\u5de5\u4ecb\u5165\u3002\u4fee\u6539\u96c6\u7fa4\u914d\u7f6e\uff0c\u5f3a\u5236\u5c06\u5b58\u6d3b\u8282\u70b9\u63d0\u5347\u4e3a\u4e3b\uff0c\u64cd\u4f5c\u6b65\u9aa4\u5982\u4e0b\u3010\u4ee5\u4e0b\u64cd\u4f5c\u5747\u5728\u5b58\u6d3b\u7684\u540c\u4e00\u4e2a\u8282\u70b9\u4e0a\u64cd\u4f5c\u3011: 2.0 \u5148\u5907\u4efd\u5b58\u6d3b\u7684\u8282\u70b9\u3010\u53ef\u9009\u3011 \u00b6 mongodump 2.1 \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\u4fdd\u7559\u5f53\u524d\u914d\u7f6e \u00b6 cfg = rs.conf () status = rs.statsu () 2.2 \u4ece\u590d\u5236\u96c6\u7fa4\u4e2d\u79fb\u9664\u51fa\u6545\u969c\u7684\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u4e2d\u662f\u5b58\u6d3b\u7684\u8282\u70b9 \u00b6 cfg.members = [ cfg.members [ 0 ] , cfg.members [ 1 ] ,..., cfg.members [ n ]] 2.3 \u4f7f\u7528force\u9009\u9879\uff0c\u91cd\u65b0\u914d\u7f6e\u526f\u672c\u96c6\uff0c\u6b64\u547d\u4ee4\u4f1a\u89e6\u53d1\u65b0\u7684\u9009\u4e3e \u00b6 rs.reconfig ( cfg, { force : true }) 2.4 \u91cd\u65b0\u767b\u9646mongo\uff0c\u67e5\u770b\u5f53\u524d\u8282\u70b9\u7684\u89d2\u8272\u662f\u5426\u63d0\u5347\u4e3a\u4e3b \u00b6 mongo --host 127.0.0.1:27030 -u root -p 'Test_123' --authenticationDatabase admin ReplSetOnline:PRIMARY> db.isMaster() { \"hosts\" : [ \"192.168.100.112:27030\", \"192.168.100.113:27030\", \"192.168.100.114:27030\" ], \"setName\" : \"ReplSetOnline\", \"setVersion\" : 9, \"ismaster\" : true, \"secondary\" : false, \"primary\" : \"192.168.100.112:27030\", \"me\" : \"192.168.100.112:27030\", \"electionId\" : ObjectId(\"7fffffff0000000000000012\"), \"lastWrite\" : { \"opTime\" : { \"ts\" : Timestamp(1619181654, 12), \"t\" : NumberLong(18) }, \"lastWriteDate\" : ISODate(\"2021-04-23T12:40:54Z\") }, \"maxBsonObjectSize\" : 16777216, \"maxMessageSizeBytes\" : 48000000, \"maxWriteBatchSize\" : 1000, \"localTime\" : ISODate(\"2021-04-23T12:40:54.689Z\"), \"maxWireVersion\" : 5, \"minWireVersion\" : 0, \"readOnly\" : false, \"ok\" : 1 }","title":"MongoDB\u526f\u672c\u96c6\u5e94\u6025\u5207\u6362"},{"location":"mongodb/rs/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#mongodb","text":"","title":"MongoDB\u526f\u672c\u96c6\u5e94\u6025\u5207\u6362"},{"location":"mongodb/rs/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#1","text":"\u90e8\u7f72\u673a\u623f:A\u673a\u623f\u3010\u4e3b\u3011 + B\u673a\u623f\u3010\u5907\u3011 \u526f\u672c\u96c6\u6210\u5458\uff1a 192.168.100.112\u3010\u4e3b\u3011: mongodb01.frabitech.local 192.168.100.113\u3010\u5907\u3011: mongodb02.frabitech.local 192.168.100.114\u3010\u5bb9\u707e\u3011: mongodb03.frabitech.local","title":"1\u3001\u90e8\u7f72\u60c5\u51b5\u7b80\u4ecb"},{"location":"mongodb/rs/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#2","text":"\u5728A\u673a\u623f\u673a\u623f\u51fa\u6545\u969c\u65f6\uff0c\u653e\u7f6e\u5728B\u673a\u623f\u7684\u8282\u70b9\u5c06\u53d8\u6210\u53ea\u8bfb\uff0c\u540c\u65f6\u65e0\u6cd5\u9009\u51fa\u4e3b\u8282\u70b9\u3002\u6b64\u65f6\u4e3a\u4e86\u8ba9\u4e1a\u52a1\u5feb\u901f\u6062\u590d\uff0c\u9700\u8981\u4eba\u5de5\u4ecb\u5165\u3002\u4fee\u6539\u96c6\u7fa4\u914d\u7f6e\uff0c\u5f3a\u5236\u5c06\u5b58\u6d3b\u8282\u70b9\u63d0\u5347\u4e3a\u4e3b\uff0c\u64cd\u4f5c\u6b65\u9aa4\u5982\u4e0b\u3010\u4ee5\u4e0b\u64cd\u4f5c\u5747\u5728\u5b58\u6d3b\u7684\u540c\u4e00\u4e2a\u8282\u70b9\u4e0a\u64cd\u4f5c\u3011:","title":"2\u3001\u5e94\u6025\u5207\u6362\u6b65\u9aa4"},{"location":"mongodb/rs/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#20","text":"mongodump","title":"2.0 \u5148\u5907\u4efd\u5b58\u6d3b\u7684\u8282\u70b9\u3010\u53ef\u9009\u3011"},{"location":"mongodb/rs/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#21","text":"cfg = rs.conf () status = rs.statsu ()","title":"2.1 \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\u4fdd\u7559\u5f53\u524d\u914d\u7f6e"},{"location":"mongodb/rs/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#22","text":"cfg.members = [ cfg.members [ 0 ] , cfg.members [ 1 ] ,..., cfg.members [ n ]]","title":"2.2 \u4ece\u590d\u5236\u96c6\u7fa4\u4e2d\u79fb\u9664\u51fa\u6545\u969c\u7684\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u4e2d\u662f\u5b58\u6d3b\u7684\u8282\u70b9"},{"location":"mongodb/rs/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#23-force","text":"rs.reconfig ( cfg, { force : true })","title":"2.3 \u4f7f\u7528force\u9009\u9879\uff0c\u91cd\u65b0\u914d\u7f6e\u526f\u672c\u96c6\uff0c\u6b64\u547d\u4ee4\u4f1a\u89e6\u53d1\u65b0\u7684\u9009\u4e3e"},{"location":"mongodb/rs/202112/1.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E5%BA%94%E6%80%A5%E5%88%87%E6%8D%A2.html#24-mongo","text":"mongo --host 127.0.0.1:27030 -u root -p 'Test_123' --authenticationDatabase admin ReplSetOnline:PRIMARY> db.isMaster() { \"hosts\" : [ \"192.168.100.112:27030\", \"192.168.100.113:27030\", \"192.168.100.114:27030\" ], \"setName\" : \"ReplSetOnline\", \"setVersion\" : 9, \"ismaster\" : true, \"secondary\" : false, \"primary\" : \"192.168.100.112:27030\", \"me\" : \"192.168.100.112:27030\", \"electionId\" : ObjectId(\"7fffffff0000000000000012\"), \"lastWrite\" : { \"opTime\" : { \"ts\" : Timestamp(1619181654, 12), \"t\" : NumberLong(18) }, \"lastWriteDate\" : ISODate(\"2021-04-23T12:40:54Z\") }, \"maxBsonObjectSize\" : 16777216, \"maxMessageSizeBytes\" : 48000000, \"maxWriteBatchSize\" : 1000, \"localTime\" : ISODate(\"2021-04-23T12:40:54.689Z\"), \"maxWireVersion\" : 5, \"minWireVersion\" : 0, \"readOnly\" : false, \"ok\" : 1 }","title":"2.4 \u91cd\u65b0\u767b\u9646mongo\uff0c\u67e5\u770b\u5f53\u524d\u8282\u70b9\u7684\u89d2\u8272\u662f\u5426\u63d0\u5347\u4e3a\u4e3b"},{"location":"mongodb/rs/202112/2.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E9%83%A8%E7%BD%B2.html","text":"MongoDB\u526f\u672c\u96c6\u90e8\u7f72 \u00b6 MongoDB\u590d\u5236\u96c6\u53ef\u4ee5\u7531\u90e8\u7f72\u5728\u591a\u53f0\u673a\u5668[\u7269\u7406\u673a/\u865a\u673a]\u6216\u8005\u591a\u4e2a\u6570\u636e\u4e2d\u5fc3\u7684\u591a\u4e2a\u8282\u70b9\u7ec4\u6210\uff0c\u53ea\u9700\u8981\u786e\u4fdd\u8fd9\u4e9b\u8282\u70b9\u95f4\u7684\u7f51\u7edc\u662f \u4e92\u901a\u7684\u5c31\u884c\u3002\u5728\u90e8\u7f72\u4e4b\u524d\uff0c\u9700\u8981\u786e\u4fdd\u4ee5\u4e0b\u524d\u63d0\u6761\u4ef6 1\u3001\u524d\u63d0\u6761\u4ef6 \u00b6 2\u3001\u5355\u673a\u90e8\u7f72 \u00b6 \u5728\u90e8\u7f72\u526f\u672c\u96c6\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5728\u6307\u5b9a\u673a\u5668\u4e0a\u5b89\u88c5\u597dMongoDB\u53ca\u5176\u914d\u5957\u5de5\u5177\uff0c\u6b64\u6b21\u90e8\u7f72\u5b9e\u8df5\u89c4\u5212\u5982\u4e0b \u526f\u672c\u96c6\u6210\u5458\uff1a 192.168.100.112\u3010\u4e3b\u3011: mongodb01.frabitech.local 192.168.100.113\u3010\u5907\u3011: mongodb02.frabitech.local 192.168.100.114\u3010\u5bb9\u707e\u3011: mongodb03.frabitech.local 3\u3001\u96c6\u7fa4\u6784\u5efa\u6d41\u7a0b \u00b6 \u5728A\u673a\u623f\u673a\u623f\u51fa\u6545\u969c\u65f6\uff0c\u653e\u7f6e\u5728B\u673a\u623f\u7684\u8282\u70b9\u5c06\u53d8\u6210\u53ea\u8bfb\uff0c\u540c\u65f6\u65e0\u6cd5\u9009\u51fa\u4e3b\u8282\u70b9\u3002\u6b64\u65f6\u4e3a\u4e86\u8ba9\u4e1a\u52a1\u5feb\u901f\u6062\u590d\uff0c\u9700\u8981\u4eba\u5de5\u4ecb\u5165\u3002\u4fee\u6539\u96c6\u7fa4\u914d\u7f6e\uff0c\u5f3a\u5236\u5c06\u5b58\u6d3b\u8282\u70b9\u63d0\u5347\u4e3a\u4e3b\uff0c\u64cd\u4f5c\u6b65\u9aa4\u5982\u4e0b\u3010\u4ee5\u4e0b\u64cd\u4f5c\u5747\u5728\u5b58\u6d3b\u7684\u540c\u4e00\u4e2a\u8282\u70b9\u4e0a\u64cd\u4f5c\u3011: 3.1 \u5c06\u4e4b\u524d\u90e8\u7f72\u7684\u6bcf\u4e00\u4e2a\u526f\u672c\u96c6\u6210\u5458\u542f\u52a8\u8d77\u6765 \u00b6 mongodump 3.2 \u4f7f\u7528mongo\u547d\u4ee4\u884c\u5de5\u5177\u8fde\u63a5\u5230\u5176\u4e2d\u4e00\u4e2a\u8282\u70b9 \u00b6 cfg = rs.conf () status = rs.statsu () 3.3 \u521d\u59cb\u5316\u526f\u672c\u96c6 \u00b6 rs.initiate ( { _id : \"rs_cluster01\" , members: [ { _id: 0 , host: \"mongodb01.frabitech.local:27017\" } , { _id: 1 , host: \"mongodb02.frabitech.local:27017\" } , { _id: 2 , host: \"mongodb03.frabitech.local:27017\" } ] }) 3.4 \u786e\u8ba4\u526f\u672c\u96c6\u5df2\u9009\u51fa\u4e3b\u8282\u70b9 \u00b6 rs.conf ()","title":"MongoDB\u526f\u672c\u96c6\u90e8\u7f72"},{"location":"mongodb/rs/202112/2.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E9%83%A8%E7%BD%B2.html#mongodb","text":"MongoDB\u590d\u5236\u96c6\u53ef\u4ee5\u7531\u90e8\u7f72\u5728\u591a\u53f0\u673a\u5668[\u7269\u7406\u673a/\u865a\u673a]\u6216\u8005\u591a\u4e2a\u6570\u636e\u4e2d\u5fc3\u7684\u591a\u4e2a\u8282\u70b9\u7ec4\u6210\uff0c\u53ea\u9700\u8981\u786e\u4fdd\u8fd9\u4e9b\u8282\u70b9\u95f4\u7684\u7f51\u7edc\u662f \u4e92\u901a\u7684\u5c31\u884c\u3002\u5728\u90e8\u7f72\u4e4b\u524d\uff0c\u9700\u8981\u786e\u4fdd\u4ee5\u4e0b\u524d\u63d0\u6761\u4ef6","title":"MongoDB\u526f\u672c\u96c6\u90e8\u7f72"},{"location":"mongodb/rs/202112/2.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E9%83%A8%E7%BD%B2.html#1","text":"","title":"1\u3001\u524d\u63d0\u6761\u4ef6"},{"location":"mongodb/rs/202112/2.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E9%83%A8%E7%BD%B2.html#2","text":"\u5728\u90e8\u7f72\u526f\u672c\u96c6\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5728\u6307\u5b9a\u673a\u5668\u4e0a\u5b89\u88c5\u597dMongoDB\u53ca\u5176\u914d\u5957\u5de5\u5177\uff0c\u6b64\u6b21\u90e8\u7f72\u5b9e\u8df5\u89c4\u5212\u5982\u4e0b \u526f\u672c\u96c6\u6210\u5458\uff1a 192.168.100.112\u3010\u4e3b\u3011: mongodb01.frabitech.local 192.168.100.113\u3010\u5907\u3011: mongodb02.frabitech.local 192.168.100.114\u3010\u5bb9\u707e\u3011: mongodb03.frabitech.local","title":"2\u3001\u5355\u673a\u90e8\u7f72"},{"location":"mongodb/rs/202112/2.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E9%83%A8%E7%BD%B2.html#3","text":"\u5728A\u673a\u623f\u673a\u623f\u51fa\u6545\u969c\u65f6\uff0c\u653e\u7f6e\u5728B\u673a\u623f\u7684\u8282\u70b9\u5c06\u53d8\u6210\u53ea\u8bfb\uff0c\u540c\u65f6\u65e0\u6cd5\u9009\u51fa\u4e3b\u8282\u70b9\u3002\u6b64\u65f6\u4e3a\u4e86\u8ba9\u4e1a\u52a1\u5feb\u901f\u6062\u590d\uff0c\u9700\u8981\u4eba\u5de5\u4ecb\u5165\u3002\u4fee\u6539\u96c6\u7fa4\u914d\u7f6e\uff0c\u5f3a\u5236\u5c06\u5b58\u6d3b\u8282\u70b9\u63d0\u5347\u4e3a\u4e3b\uff0c\u64cd\u4f5c\u6b65\u9aa4\u5982\u4e0b\u3010\u4ee5\u4e0b\u64cd\u4f5c\u5747\u5728\u5b58\u6d3b\u7684\u540c\u4e00\u4e2a\u8282\u70b9\u4e0a\u64cd\u4f5c\u3011:","title":"3\u3001\u96c6\u7fa4\u6784\u5efa\u6d41\u7a0b"},{"location":"mongodb/rs/202112/2.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E9%83%A8%E7%BD%B2.html#31","text":"mongodump","title":"3.1 \u5c06\u4e4b\u524d\u90e8\u7f72\u7684\u6bcf\u4e00\u4e2a\u526f\u672c\u96c6\u6210\u5458\u542f\u52a8\u8d77\u6765"},{"location":"mongodb/rs/202112/2.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E9%83%A8%E7%BD%B2.html#32-mongo","text":"cfg = rs.conf () status = rs.statsu ()","title":"3.2 \u4f7f\u7528mongo\u547d\u4ee4\u884c\u5de5\u5177\u8fde\u63a5\u5230\u5176\u4e2d\u4e00\u4e2a\u8282\u70b9"},{"location":"mongodb/rs/202112/2.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E9%83%A8%E7%BD%B2.html#33","text":"rs.initiate ( { _id : \"rs_cluster01\" , members: [ { _id: 0 , host: \"mongodb01.frabitech.local:27017\" } , { _id: 1 , host: \"mongodb02.frabitech.local:27017\" } , { _id: 2 , host: \"mongodb03.frabitech.local:27017\" } ] })","title":"3.3 \u521d\u59cb\u5316\u526f\u672c\u96c6"},{"location":"mongodb/rs/202112/2.MongoDB%E5%A4%8D%E5%88%B6%E9%9B%86%E9%83%A8%E7%BD%B2.html#34","text":"rs.conf ()","title":"3.4 \u786e\u8ba4\u526f\u672c\u96c6\u5df2\u9009\u51fa\u4e3b\u8282\u70b9"},{"location":"mongodb/sc/index.html","text":"MongoDB-\u5206\u7247\u96c6\u7fa4\u7bc7 \u00b6","title":"\u5206\u7247\u96c6\u7fa4"},{"location":"mongodb/sc/index.html#mongodb-","text":"","title":"MongoDB-\u5206\u7247\u96c6\u7fa4\u7bc7"},{"location":"mysql/index.html","text":"MySQL\u76f8\u5173 \u00b6 202112 via the PMM Settings page. 202201 PMM Server via the user interface.","title":"MySQL\u76f8\u5173"},{"location":"mysql/index.html#mysql","text":"202112 via the PMM Settings page. 202201 PMM Server via the user interface.","title":"MySQL\u76f8\u5173"},{"location":"mysql/basic/index.html","text":"MySQL-\u57fa\u7840\u7bc7 \u00b6 1\u3001OSC\u5de5\u4f5c\u539f\u7406 2\u3001\u57fa\u4e8eMySQL\u7684PITR\u6700\u4f73\u5b9e\u8df5 3\u3001InnoDB\u8868\u7a7a\u95f4\u8f6c\u79fb\u5b9e\u8df5 4\u3001InnoDB\u8868\u7a7a\u95f4\u4ecb\u7ecd 5\u3001OSC\u89e3\u51b3\u65b9\u6848\u5bf9\u6bd4 6\u3001MySQL5.7\u5347\u7ea7\u5b9e\u8df5 7\u3001MySQL\u5404\u8bed\u53e5\u52a0\u9501\u7c7b\u578b 8\u3001MySQL\u5907\u4efd\u6062\u590d\u6700\u4f73\u5b9e\u8df5 9\u3001MySQL\u5b95\u673a\u6062\u590d\u6d41\u7a0b","title":"\u57fa\u7840\u7bc7"},{"location":"mysql/basic/index.html#mysql-","text":"1\u3001OSC\u5de5\u4f5c\u539f\u7406 2\u3001\u57fa\u4e8eMySQL\u7684PITR\u6700\u4f73\u5b9e\u8df5 3\u3001InnoDB\u8868\u7a7a\u95f4\u8f6c\u79fb\u5b9e\u8df5 4\u3001InnoDB\u8868\u7a7a\u95f4\u4ecb\u7ecd 5\u3001OSC\u89e3\u51b3\u65b9\u6848\u5bf9\u6bd4 6\u3001MySQL5.7\u5347\u7ea7\u5b9e\u8df5 7\u3001MySQL\u5404\u8bed\u53e5\u52a0\u9501\u7c7b\u578b 8\u3001MySQL\u5907\u4efd\u6062\u590d\u6700\u4f73\u5b9e\u8df5 9\u3001MySQL\u5b95\u673a\u6062\u590d\u6d41\u7a0b","title":"MySQL-\u57fa\u7840\u7bc7"},{"location":"mysql/basic/202201/index.html","text":"MySQL\u76f8\u5173-202201 \u00b6","title":"MySQL\u76f8\u5173-202201"},{"location":"mysql/basic/202201/index.html#mysql-202201","text":"","title":"MySQL\u76f8\u5173-202201"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html","text":"OSC\u5de5\u4f5c\u539f\u7406 \u00b6 1\u3001\u8868\u7ed3\u6784\u53d8\u66f4\u5b58\u5728\u7684\u95ee\u9898 \u00b6 \u9488\u5bf9MySQL\uff0c\u5f53\u524d\u6bd4\u8f83\u6d41\u884c\u7684\u5728\u7ebf\u8868\u7ed3\u6784\u53d8\u66f4\u5de5\u5177\u6709\u5982\u4e0b\u51e0\u6b3e\uff1a gh-ost pt-osc facebook`osc 2\u3001Scheme\u53d8\u66f4\u5b58\u5728\u7684\u89e3\u51b3\u65b9\u6848 \u00b6 3\u3001\u901a\u7528\u903b\u8f91\u548c\u5b58\u5728\u7684\u5de5\u5177 \u00b6 3.1\u3001\u521d\u59cb\u5316\u5f71\u5b50\u8868[ghost table] \u00b6 3.2\u3001\u9a8c\u8bc1\u8868\u7ed3\u6784\u53d8\u66f4 \u00b6 3.3\u3001\u5dee\u5f02\u5206\u6790 \u00b6 3.4\u3001\u5b58\u91cf\u6570\u636e\u8fc1\u79fb \u00b6 3.5\u3001\u5b9e\u65f6\u53d8\u66f4\u6570\u636e\u6355\u83b7\u3001\u8ddf\u8e2a \u00b6 3.6\u3001\u5b9e\u65f6\u53d8\u66f4\u6570\u636e\u6355\u83b7\u3001\u8ddf\u8e2a \u00b6 3.7\u3001\u8fc1\u79fb\u8fdb\u5ea6\u76d1\u63a7\u548c\u6d41\u91cf\u63a7\u5236 \u00b6 3.8\u3001\u786e\u5b9a\u5207\u6362\u65f6\u95f4 \u00b6 3.9\u3001\u6267\u884c\u5207\u6362 \u00b6 3.10\u3001\u5207\u6362\u540e\u7eed \u00b6","title":"OSC\u5de5\u4f5c\u539f\u7406"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html#osc","text":"","title":"OSC\u5de5\u4f5c\u539f\u7406"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html#1","text":"\u9488\u5bf9MySQL\uff0c\u5f53\u524d\u6bd4\u8f83\u6d41\u884c\u7684\u5728\u7ebf\u8868\u7ed3\u6784\u53d8\u66f4\u5de5\u5177\u6709\u5982\u4e0b\u51e0\u6b3e\uff1a gh-ost pt-osc facebook`osc","title":"1\u3001\u8868\u7ed3\u6784\u53d8\u66f4\u5b58\u5728\u7684\u95ee\u9898"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html#2scheme","text":"","title":"2\u3001Scheme\u53d8\u66f4\u5b58\u5728\u7684\u89e3\u51b3\u65b9\u6848"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html#3","text":"","title":"3\u3001\u901a\u7528\u903b\u8f91\u548c\u5b58\u5728\u7684\u5de5\u5177"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html#31ghost-table","text":"","title":"3.1\u3001\u521d\u59cb\u5316\u5f71\u5b50\u8868[ghost table]"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html#32","text":"","title":"3.2\u3001\u9a8c\u8bc1\u8868\u7ed3\u6784\u53d8\u66f4"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html#33","text":"","title":"3.3\u3001\u5dee\u5f02\u5206\u6790"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html#34","text":"","title":"3.4\u3001\u5b58\u91cf\u6570\u636e\u8fc1\u79fb"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html#35","text":"","title":"3.5\u3001\u5b9e\u65f6\u53d8\u66f4\u6570\u636e\u6355\u83b7\u3001\u8ddf\u8e2a"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html#36","text":"","title":"3.6\u3001\u5b9e\u65f6\u53d8\u66f4\u6570\u636e\u6355\u83b7\u3001\u8ddf\u8e2a"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html#37","text":"","title":"3.7\u3001\u8fc1\u79fb\u8fdb\u5ea6\u76d1\u63a7\u548c\u6d41\u91cf\u63a7\u5236"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html#38","text":"","title":"3.8\u3001\u786e\u5b9a\u5207\u6362\u65f6\u95f4"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html#39","text":"","title":"3.9\u3001\u6267\u884c\u5207\u6362"},{"location":"mysql/basic/202201/1.OSC%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86.html#310","text":"","title":"3.10\u3001\u5207\u6362\u540e\u7eed"},{"location":"mysql/basic/202201/2.%E5%9F%BA%E4%BA%8EMySQL%E7%9A%84PITR%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html","text":"\u57fa\u4e8eMySQL\u7684PITR\u6700\u4f73\u5b9e\u8df5 \u00b6 \u6709\u6548\u7684\u5907\u4efd\u5bf9\u6570\u636e\u5e93\u6765\u8bf4\u81f3\u5173\u91cd\u8981\u3002\u5f53\u751f\u4ea7\u73af\u5883\u7684\u6570\u636e\u5e93\u56e0\u4e3a\u5730\u9707\u3001\u6d2a\u707e\u3001\u706b\u707e\u7b49\u81ea\u7136\u707e\u5bb3\u3001\u6216\u8005\u4eba\u4e3a\u8bef\u64cd\u4f5c\u5bfc\u81f4\u5f7b\u5e95\u635f\u574f\u65f6\uff0c \u4e00\u4efd\u6709\u6548\u7684\u5907\u4efd\u5c06\u6210\u4e3a\u6700\u540e\u7684\u6551\u547d\u7a3b\u8349\u3002\u53ea\u8981\u4f60\u62e5\u6709\u6700\u8fd1\u6700\u5b8c\u6574\u7684\u5907\u4efd\u96c6\uff0c\u4f60\u7684\u751f\u4ea7\u6570\u636e\u5c31\u53ef\u4ee5\u4ece\u4e0a\u8ff0\u707e\u96be\u4e2d\u6062\u590d\u8fc7\u6765\u3002\u4f46\u5f88 \u591a\u65f6\u5019\uff0c\u5355\u7eaf\u4ece\u67d0\u4e2a\u5e38\u89c4\u5907\u4efd\u4e2d\u6062\u590d\uff0c\u8fdc\u8fdc\u4e0d\u80fd\u6ee1\u8db3\u4e1a\u52a1\u8fde\u7eed\u6027\u7684\u9700\u6c42\u3002\u6bd4\u5982\u5e38\u89c4\u5907\u4efd\u572813:00\uff0c\u4f46\u4e8b\u6545\u53d1\u751f\u572814:00,\u8fd9\u65f6\u5019 \u53ea\u7528\u57fa\u7840\u5907\u4efd\u6765 \u8fdb\u884c\u707e\u96be\u6062\u590d\uff0c\u90a3\u4ece13:00\u523014:00\u7684\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002\u4e3a\u4e86\u89e3\u51b3\u4ee5\u4e0a\u95ee\u9898\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u6839\u636e\u4e1a\u52a1\u6570\u636e\u7684\u91cd\u8981\u6027\uff0c \u6765\u8bc4\u4f30RTO\u548cRPO\uff0c\u8fdb\u4e00\u6b65\u5224\u65ad\u662f\u5426\u9700\u8981\u5b9e\u73b0\u57fa\u4e8e\u65f6\u95f4\u70b9\u7684\u6062\u590d**P**oint **I**n **T**ime **R**ecovery\u3010PITR\u3011, \u5c3d\u53ef\u80fd\u5c06 \u6570\u636e\u6062\u590d\u5230\u79bb\u6545\u969c\u70b9\u6700\u8fd1\u7684\u65f6\u95f4\u70b9. \u901a\u5e38\u6765\u8bf4\uff0c\u5f53\u53d1\u751f\u4ee5\u4e0b\u573a\u666f\u540e\uff0c\u53ea\u80fd\u4f7f\u7528\u5907\u4efd\u6765\u8fdb\u884c\u707e\u96be\u6062\u590d\uff1a \u610f\u5916\u5220\u9664\u6570\u636e\uff1a\u6267\u884c Drop table \u6216\u8005 Delete \u4e0d\u5e26where\u6761\u4ef6\u6216\u8005where\u6761\u4ef6\u5199\u9519 \u6570\u636e\u5e93\u5347\u7ea7\u5931\u8d25\uff0c\u5bfc\u81f4\u6570\u636e\u6587\u4ef6\u635f\u574f \u5b58\u50a8\u4ecb\u8d28\u635f\u574f 1\u3001\u521b\u5efa\u517c\u5bb9PITR\u7684\u5e38\u89c4\u5907\u4efd \u00b6 \u8981\u60f3\u5b9e\u73b0PITR\uff0c\u9996\u5148\u9700\u8981\u6709\u4e00\u4efd\u517c\u5bb9PITR\u7684\u57fa\u7840\u5907\u4efd\u3002\u517c\u5bb9PITR\u7684\u57fa\u7840\u5907\u4efd\u9700\u8981\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6: \u4e3b\u673a\u5fc5\u987b\u542f\u7528binlog\uff0c\u6ca1\u6709binlog\uff0c\u4e0d\u53ef\u80fd\u5b9e\u73b0PITR\u3002 \u9700\u8981\u4fdd\u7559\u8db3\u591f\u7684binlog \u6587\u4ef6 \u57fa\u7840\u5907\u4efd\u5305\u542b\u8d77\u59cb\u7684binlog\u4f4d\u70b9\u4fe1\u606f \u8fd9\u4e9b\u57fa\u7840\u5907\u4efd\u53ef\u4ee5\u4f7f\u7528\u5e38\u89c1\u7684\u5907\u4efd\u5de5\u5177\u6765\u5b8c\u6210\uff0c\u6bd4\u5982MySQL\u81ea\u5e26\u7684\u903b\u8f91\u5907\u4efd\u5de5\u5177 mysqldump\u3001Percona\u5f00\u53d1\u7684\u7269\u7406\u70ed\u5907\u5de5\u5177Xtarbackup\u7b49\u3002\u6b64\u6b21\u7684\u535a\u5ba2\u5206\u522b\u57fa\u4e8e\u4ee5\u4e0a\u4e24\u79cd\u5de5\u5177\u6765\u8fdb\u884c\u6f14\u793a # master \u8282\u70b9\u505a\u57fa\u7840\u5907\u4efd\uff0c\u52a0\u4e0amaster-data=2\u9009\u9879\uff0c\u5c06\u5f53\u524dmaster\u8282\u70b9\u7684binlog\u4f4d\u3001\u70b9\u4fe1\u606f\u4ee5\u6ce8\u91ca\u7684\u5f62\u5f0f\u5199\u5165\u5230\u5907\u4efd\u6587\u4ef6\u5f00\u5934 mysqldump -u root -p --single-transaction --master-data = 2 --databases db1 db2 ...dbn > dumpfile_yyyymmdd.sql # slave\u8282\u70b9\u505a\u57fa\u7840\u5907\u4efd\uff0c\u52a0\u4e0adump-slave=2\u9009\u9879\uff0c\u5c06\u5f53\u524d\u4ece\u8282\u70b9\u5bf9\u5e94\u7684master\u7684binlog\u4f4d\u3001\u70b9\u4fe1\u606f\u4ee5\u6ce8\u91ca\u7684\u5f62\u5f0f\u5199\u5165\u5230\u5907\u4efd\u6587\u4ef6\u5f00\u5934 mysqldump -u root -p --single-transaction --dump-slave = 2 --databases db1 db2 ...dbn > dumpfile_yyyymmdd.sql # \u4e3b\u8282\u70b9\u505a\u57fa\u7840\u5907\u4efd xtrabackup --user = root --password --parallel = 4 --backup --target-dir = full_path_to_backupdir # \u4ece\u8282\u70b9\u505a\u57fa\u7840\u5907\u4efd\uff0c\u6b64\u65f6\u9700\u8981\u52a0\u4e0aslave-info\u9009\u9879\uff0c\u5c06\u5f53\u524dslave\u8282\u70b9\u5bf9\u5e94\u7684master\u8282\u70b9\u7684binlog\u4f4d\u70b9\u4fe1\u606f\u767b\u8bb0\u5230\u5355\u72ec\u7684\u6587\u4ef6\u5185 xtrabackup --user = root --password --parallel = 4 --slave-info --backup --target-dir = full_path_to_backupdir 2\u3001PITR\u7c7b\u578b \u00b6 \u5728\u6062\u590d\u5b8c\u57fa\u7840\u5907\u4efd\u4ee5\u540e\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528binlog\u6765\u5b8c\u6210PITR\u3002\u5728\u4f7f\u7528mysqlbinlog\u6765\u8fdb\u884c\u6062\u590d\u65f6\uff0c\u53ef\u4ee5\u63d0\u4f9b\u57fa\u4e8e\u65f6\u95f4\u7684 \u4f4d\u70b9\u4fe1\u606f \u57fa\u4e8e\u65f6\u95f4\u7684PITR ;\u4e5f\u53ef\u4ee5\u5148\u63d0\u4f9b\u57fa\u4e8ePosition\u7684\u4f4d\u70b9\u4fe1\u606f \u57fa\u4e8e\u4f4d\u70b9\u7684PITR 2.1 \u57fa\u4e8e\u65f6\u95f4\u7684PITR \u00b6 2.1 \u57fa\u4e8e\u4f4d\u70b9\u7684PITR \u00b6","title":"\u57fa\u4e8eMySQL\u7684PITR\u6700\u4f73\u5b9e\u8df5"},{"location":"mysql/basic/202201/2.%E5%9F%BA%E4%BA%8EMySQL%E7%9A%84PITR%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#mysqlpitr","text":"\u6709\u6548\u7684\u5907\u4efd\u5bf9\u6570\u636e\u5e93\u6765\u8bf4\u81f3\u5173\u91cd\u8981\u3002\u5f53\u751f\u4ea7\u73af\u5883\u7684\u6570\u636e\u5e93\u56e0\u4e3a\u5730\u9707\u3001\u6d2a\u707e\u3001\u706b\u707e\u7b49\u81ea\u7136\u707e\u5bb3\u3001\u6216\u8005\u4eba\u4e3a\u8bef\u64cd\u4f5c\u5bfc\u81f4\u5f7b\u5e95\u635f\u574f\u65f6\uff0c \u4e00\u4efd\u6709\u6548\u7684\u5907\u4efd\u5c06\u6210\u4e3a\u6700\u540e\u7684\u6551\u547d\u7a3b\u8349\u3002\u53ea\u8981\u4f60\u62e5\u6709\u6700\u8fd1\u6700\u5b8c\u6574\u7684\u5907\u4efd\u96c6\uff0c\u4f60\u7684\u751f\u4ea7\u6570\u636e\u5c31\u53ef\u4ee5\u4ece\u4e0a\u8ff0\u707e\u96be\u4e2d\u6062\u590d\u8fc7\u6765\u3002\u4f46\u5f88 \u591a\u65f6\u5019\uff0c\u5355\u7eaf\u4ece\u67d0\u4e2a\u5e38\u89c4\u5907\u4efd\u4e2d\u6062\u590d\uff0c\u8fdc\u8fdc\u4e0d\u80fd\u6ee1\u8db3\u4e1a\u52a1\u8fde\u7eed\u6027\u7684\u9700\u6c42\u3002\u6bd4\u5982\u5e38\u89c4\u5907\u4efd\u572813:00\uff0c\u4f46\u4e8b\u6545\u53d1\u751f\u572814:00,\u8fd9\u65f6\u5019 \u53ea\u7528\u57fa\u7840\u5907\u4efd\u6765 \u8fdb\u884c\u707e\u96be\u6062\u590d\uff0c\u90a3\u4ece13:00\u523014:00\u7684\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002\u4e3a\u4e86\u89e3\u51b3\u4ee5\u4e0a\u95ee\u9898\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u6839\u636e\u4e1a\u52a1\u6570\u636e\u7684\u91cd\u8981\u6027\uff0c \u6765\u8bc4\u4f30RTO\u548cRPO\uff0c\u8fdb\u4e00\u6b65\u5224\u65ad\u662f\u5426\u9700\u8981\u5b9e\u73b0\u57fa\u4e8e\u65f6\u95f4\u70b9\u7684\u6062\u590d**P**oint **I**n **T**ime **R**ecovery\u3010PITR\u3011, \u5c3d\u53ef\u80fd\u5c06 \u6570\u636e\u6062\u590d\u5230\u79bb\u6545\u969c\u70b9\u6700\u8fd1\u7684\u65f6\u95f4\u70b9. \u901a\u5e38\u6765\u8bf4\uff0c\u5f53\u53d1\u751f\u4ee5\u4e0b\u573a\u666f\u540e\uff0c\u53ea\u80fd\u4f7f\u7528\u5907\u4efd\u6765\u8fdb\u884c\u707e\u96be\u6062\u590d\uff1a \u610f\u5916\u5220\u9664\u6570\u636e\uff1a\u6267\u884c Drop table \u6216\u8005 Delete \u4e0d\u5e26where\u6761\u4ef6\u6216\u8005where\u6761\u4ef6\u5199\u9519 \u6570\u636e\u5e93\u5347\u7ea7\u5931\u8d25\uff0c\u5bfc\u81f4\u6570\u636e\u6587\u4ef6\u635f\u574f \u5b58\u50a8\u4ecb\u8d28\u635f\u574f","title":"\u57fa\u4e8eMySQL\u7684PITR\u6700\u4f73\u5b9e\u8df5"},{"location":"mysql/basic/202201/2.%E5%9F%BA%E4%BA%8EMySQL%E7%9A%84PITR%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#1pitr","text":"\u8981\u60f3\u5b9e\u73b0PITR\uff0c\u9996\u5148\u9700\u8981\u6709\u4e00\u4efd\u517c\u5bb9PITR\u7684\u57fa\u7840\u5907\u4efd\u3002\u517c\u5bb9PITR\u7684\u57fa\u7840\u5907\u4efd\u9700\u8981\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6: \u4e3b\u673a\u5fc5\u987b\u542f\u7528binlog\uff0c\u6ca1\u6709binlog\uff0c\u4e0d\u53ef\u80fd\u5b9e\u73b0PITR\u3002 \u9700\u8981\u4fdd\u7559\u8db3\u591f\u7684binlog \u6587\u4ef6 \u57fa\u7840\u5907\u4efd\u5305\u542b\u8d77\u59cb\u7684binlog\u4f4d\u70b9\u4fe1\u606f \u8fd9\u4e9b\u57fa\u7840\u5907\u4efd\u53ef\u4ee5\u4f7f\u7528\u5e38\u89c1\u7684\u5907\u4efd\u5de5\u5177\u6765\u5b8c\u6210\uff0c\u6bd4\u5982MySQL\u81ea\u5e26\u7684\u903b\u8f91\u5907\u4efd\u5de5\u5177 mysqldump\u3001Percona\u5f00\u53d1\u7684\u7269\u7406\u70ed\u5907\u5de5\u5177Xtarbackup\u7b49\u3002\u6b64\u6b21\u7684\u535a\u5ba2\u5206\u522b\u57fa\u4e8e\u4ee5\u4e0a\u4e24\u79cd\u5de5\u5177\u6765\u8fdb\u884c\u6f14\u793a # master \u8282\u70b9\u505a\u57fa\u7840\u5907\u4efd\uff0c\u52a0\u4e0amaster-data=2\u9009\u9879\uff0c\u5c06\u5f53\u524dmaster\u8282\u70b9\u7684binlog\u4f4d\u3001\u70b9\u4fe1\u606f\u4ee5\u6ce8\u91ca\u7684\u5f62\u5f0f\u5199\u5165\u5230\u5907\u4efd\u6587\u4ef6\u5f00\u5934 mysqldump -u root -p --single-transaction --master-data = 2 --databases db1 db2 ...dbn > dumpfile_yyyymmdd.sql # slave\u8282\u70b9\u505a\u57fa\u7840\u5907\u4efd\uff0c\u52a0\u4e0adump-slave=2\u9009\u9879\uff0c\u5c06\u5f53\u524d\u4ece\u8282\u70b9\u5bf9\u5e94\u7684master\u7684binlog\u4f4d\u3001\u70b9\u4fe1\u606f\u4ee5\u6ce8\u91ca\u7684\u5f62\u5f0f\u5199\u5165\u5230\u5907\u4efd\u6587\u4ef6\u5f00\u5934 mysqldump -u root -p --single-transaction --dump-slave = 2 --databases db1 db2 ...dbn > dumpfile_yyyymmdd.sql # \u4e3b\u8282\u70b9\u505a\u57fa\u7840\u5907\u4efd xtrabackup --user = root --password --parallel = 4 --backup --target-dir = full_path_to_backupdir # \u4ece\u8282\u70b9\u505a\u57fa\u7840\u5907\u4efd\uff0c\u6b64\u65f6\u9700\u8981\u52a0\u4e0aslave-info\u9009\u9879\uff0c\u5c06\u5f53\u524dslave\u8282\u70b9\u5bf9\u5e94\u7684master\u8282\u70b9\u7684binlog\u4f4d\u70b9\u4fe1\u606f\u767b\u8bb0\u5230\u5355\u72ec\u7684\u6587\u4ef6\u5185 xtrabackup --user = root --password --parallel = 4 --slave-info --backup --target-dir = full_path_to_backupdir","title":"1\u3001\u521b\u5efa\u517c\u5bb9PITR\u7684\u5e38\u89c4\u5907\u4efd"},{"location":"mysql/basic/202201/2.%E5%9F%BA%E4%BA%8EMySQL%E7%9A%84PITR%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#2pitr","text":"\u5728\u6062\u590d\u5b8c\u57fa\u7840\u5907\u4efd\u4ee5\u540e\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528binlog\u6765\u5b8c\u6210PITR\u3002\u5728\u4f7f\u7528mysqlbinlog\u6765\u8fdb\u884c\u6062\u590d\u65f6\uff0c\u53ef\u4ee5\u63d0\u4f9b\u57fa\u4e8e\u65f6\u95f4\u7684 \u4f4d\u70b9\u4fe1\u606f \u57fa\u4e8e\u65f6\u95f4\u7684PITR ;\u4e5f\u53ef\u4ee5\u5148\u63d0\u4f9b\u57fa\u4e8ePosition\u7684\u4f4d\u70b9\u4fe1\u606f \u57fa\u4e8e\u4f4d\u70b9\u7684PITR","title":"2\u3001PITR\u7c7b\u578b"},{"location":"mysql/basic/202201/2.%E5%9F%BA%E4%BA%8EMySQL%E7%9A%84PITR%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#21-pitr","text":"","title":"2.1 \u57fa\u4e8e\u65f6\u95f4\u7684PITR"},{"location":"mysql/basic/202201/2.%E5%9F%BA%E4%BA%8EMySQL%E7%9A%84PITR%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#21-pitr_1","text":"","title":"2.1 \u57fa\u4e8e\u4f4d\u70b9\u7684PITR"},{"location":"mysql/basic/202201/3.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E8%BD%AC%E7%A7%BB%E5%AE%9E%E8%B7%B5.html","text":"InnoDB\u8868\u7a7a\u95f4\u8f6c\u79fb\u5b9e\u8df5 \u00b6 MySQL\u5b98\u65b9\u63d0\u4f9b\u7684\u8868\u7a7a\u95f4\u8f6c\u79fb\u7279\u6027[Transportable Tablespaces]\u53ef\u4ee5\u5feb\u901f\u5c06\u5927\u8868\u4ece\u4e00\u4e2a\u5b9e\u4f8b\u5bfc\u51fa\uff0c \u7136\u540e\u5bfc\u5165\u5230\u65b0\u7684\u5b9e\u4f8b\u3002\u501f\u52a9\u8fd9\u4e2a\u7279\u6027\u53ef\u4ee5\u5728\u65b0\u7684\u5b9e\u4f8b\u4e0a\u8fdb\u884c\u62a5\u8868\u67e5\u8be2\u3001\u5907\u4efd\u6062\u590d\u3001\u5feb\u901f\u91cd\u5efa\u5907\u5e93\u7b49 1\u3001\u524d\u63d0\u6761\u4ef6 \u00b6 \u8981\u60f3\u5b8c\u6210InnoDB\u8868\u7a7a\u95f4\u8f6c\u79fb\uff0c\u9700\u8981\u6ee1\u8db3\u4e0b\u9762\u7684\u6761\u4ef6: \u6e90\u5b9e\u4f8b\u548c\u76ee\u6807\u5b9e\u4f8b\u5fc5\u987b\u5c06innodb_file_per_table\u8bbe\u7f6e\u4e3aON\uff0cMySQL\u9ed8\u8ba4\u8bbe\u7f6e\u4e3aON. \u6e90\u5b9e\u4f8b\u548c\u76ee\u6807\u5b9e\u4f8b\u5fc5\u987b\u5c06innodb_page_size\u7684\u503c\u4fdd\u6301\u4e00\u81f4\uff0c\u901a\u5e38\u8be5\u53c2\u6570\u53ea\u9700\u8981\u5728\u521d\u59cb\u5316MySQL\u5b9e\u4f8b\u65f6\u8bbe\u7f6e. \u6e90\u5b9e\u4f8b\u548c\u76ee\u6807\u5b9e\u4f8b\u5fc5\u987b\u4e3aGA\u7684\u7248\u672c\uff0c\u4e14\u7248\u672c\u53f7\u4e00\u81f4. \u5982\u679c\u4f7f\u7528\u5916\u952e\u7ea6\u675f\uff0c\u9700\u8981\u5728\u6267\u884cALTER TABLE db.table DISCARD TABLESPACE\u8bed\u53e5\u4e4b\u524d\uff0c\u5c06foreign_key_checks\u53c2\u6570\u7981\u7528\u3002\u4e3a\u4e86\u83b7\u53d6\u5230\u51c6\u786e\u7684\u6570\u636e\u6587\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7\u6682\u505c\u66f4\u65b0\u76f8\u4e92\u5173\u8054\u7684\u8868\uff0c\u63d0\u4ea4\u6240\u6709\u7684\u4e8b\u52a1\uff0c\u5728\u8fd9\u4e9b\u8868\u4e0a\u7533\u8bf7\u5171\u4eab\u9501\u4ee5\u540e\uff0c\u5728\u6267\u884c\u5bfc\u51fa\u8868\u7a7a\u95f4\u7684\u64cd\u4f5c\uff0c\u4ece\u800c\u5c06\u76f8\u4e92\u5173\u8054\u7684\u8868\u5728\u76f8\u540c\u7684\u903b\u8f91\u65f6\u95f4\u70b9\u5bfc\u51fa. \u6e90\u5b9e\u4f8b\u548c\u76ee\u6807\u5b9e\u4f8b\u7684\u8868\u7a7a\u95f4\u8def\u5f84\u5fc5\u987b\u4e00\u81f4,\u5426\u5219\u5728\u8fdb\u884c\u5bfc\u5165\u65f6\u4f1a\u62a5\u9519. \u6e90\u5b9e\u4f8b\u548c\u76ee\u6807\u5b9e\u4f8b\u7684\u6587\u4ef6\u683c\u5f0f\u5fc5\u987b\u4e00\u81f4. \u5982\u679c\u5728\u5efa\u8868\u65f6\u6ca1\u6709\u663e\u793a\u5b9a\u4e49row_format\u3001\u6216\u8005row_format=default,\u5fc5\u987b\u786e\u4fddinnodb_default_row_format\u7684\u503c\u5728\u6e90\u5b9e\u4f8b\u548c\u76ee\u6807\u5b9e\u4f8b\u4fdd\u6301\u4e00\u81f4 2\u3001\u5b9e\u8df5 \u00b6 \u5982\u679c\u4e0a\u8ff0\u6761\u4ef6\u5b8c\u5168\u7b26\u5408\u4ee5\u540e\uff0c\u53ef\u4ee5\u8fdb\u884c\u540e\u7eed\u7684\u64cd\u4f5c\u3002\u6b64\u6b21\u5b9e\u8df5\u7684\u73af\u5883\u5982\u4e0b OS\uff1aCentOS Linux release 7 .7.1908 ( Core ) MySQL: mysqld Ver 5 .7.30 for Linux on x86_64 ( MySQL Community Server ( GPL )) DB: testdb table: test_tbl src_instance: 192 .168.100.187 dst_instance: 192 .168.100.48 \u8868\u7ed3\u6784\u5982\u4e0b\uff1a mysql> show create table testdb.test_tbl \\G *************************** 1 . row *************************** Table: test_tbl Create Table: CREATE TABLE ` test_tbl ` ( ` id ` bigint ( 20 ) unsigned NOT NULL AUTO_INCREMENT COMMENT 'pk' , ` order_car_id ` bigint ( 20 ) NOT NULL DEFAULT '0' COMMENT '\u5b57\u6bb5\u6ce8\u91ca' , ` car_num ` varchar ( 20 ) NOT NULL DEFAULT '' COMMENT '\u5b57\u6bb5\u6ce8\u91ca' , ` type ` tinyint ( 1 ) NOT NULL DEFAULT '0' COMMENT '\u5b57\u6bb5\u6ce8\u91ca ' , ` warn_message ` varchar ( 200 ) NOT NULL DEFAULT '' COMMENT '\u5b57\u6bb5\u6ce8\u91ca' , ` glongitude ` varchar ( 100 ) NOT NULL DEFAULT '' COMMENT '\u5b57\u6bb5\u6ce8\u91ca' , ` glatitude ` varchar ( 100 ) NOT NULL DEFAULT '' COMMENT '\u5b57\u6bb5\u6ce8\u91ca' , ` create_time ` bigint ( 20 ) NOT NULL DEFAULT '0' COMMENT '\u5b57\u6bb5\u6ce8\u91ca' , ` last_access ` bigint ( 20 ) NOT NULL DEFAULT '0' COMMENT '\u5b57\u6bb5\u6ce8\u91ca' , PRIMARY KEY ( ` id ` ) , KEY ` idx_order_car_id ` ( ` order_car_id ` ) ) ENGINE = InnoDB AUTO_INCREMENT = 5 DEFAULT CHARSET = utf8 ROW_FORMAT = DYNAMIC COMMENT = '\u8868\u6ce8\u91ca\u4fe1\u606f' 1 row in set ( 0 .00 sec ) mysql > select * from testdb.test_tbl ; +----+--------------+----------+------+--------------+------------+-------------+-------------+--------------+ | id | order_car_id | car_num | type | warn_message | glongitude | glatitude | create_time | last_access | +----+--------------+----------+------+--------------+------------+-------------+-------------+--------------+ | 1 | 12345 | \u6caaA**** | 1 | test data1 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | | 2 | 12346 | \u6caaB**** | 0 | test data2 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | | 3 | 12347 | \u6caaC**** | 0 | test data3 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | | 4 | 12348 | \u6caaD**** | 1 | test data4 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | +----+--------------+----------+------+--------------+------------+-------------+-------------+--------------+ 2.1 \u6e90\u5b9e\u4f8b\u64cd\u4f5c \u00b6 \u5728\u6e90\u5b9e\u4f8b\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u5bfc\u51fa\u9700\u8981\u8f6c\u79fb\u7684\u8868\u7ed3\u6784\u5b9a\u4e49\u8bed\u53e5 shell > mysqldump -u root -p --single-transaction --no-data testdb test_tbl>test_tbl_define.sql \u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u5c06\u9700\u8981\u8f6c\u79fb\u7684\u8868\u7684\u5143\u6570\u636e\u548c\u6570\u636e\u6587\u4ef6\u5237\u65b0\u5230\u78c1\u76d8\uff0c\u5e76\u52a0\u4e0a\u5171\u4eab\u9501\u3002\u9700\u8981\u6ce8\u610f\uff0c\u5728\u6267\u884c\u5b8c\u8bed\u53e5\u4e4b\u540e\uff0c\u5c06cfg\u6587\u4ef6\u548cibd\u6587\u4ef6\u8f6c\u79fb\u4e4b\u524d\uff0c \u4e0d\u80fd\u9000\u51fa\u5f53\u524d\u4f1a\u8bdd mysql> FLUSH TABLE testdb.test_tbl FOR EXPORT ; Query OK, 0 rows affected ( 0 .06 sec ) \u6267\u884c\u5b8c\u4e0a\u8ff0\u8bed\u53e5\u4ee5\u540e\uff0c\u4f1a\u5728\u5bf9\u5e94\u7684\u6570\u636e\u5e93\u8def\u5f84\u4e0b\u65b0\u589e.cfg\u7684\u5143\u6570\u636e\u6587\u4ef6 mysql> system ls /mysqldata/testdb db.opt test_tbl.cfg test_tbl.frm test_tbl.ibd 2.2 \u76ee\u6807\u5b9e\u4f8b\u64cd\u4f5c \u00b6 \u5c06\u6e90\u5b9e\u4f8b\u5bfc\u51fa\u7684\u8868\u7ed3\u6784\u5b9a\u4e49\u8bed\u53e5\uff0c\u5728\u76ee\u6807\u5b9e\u4f8b\u6267\u884c\u4e00\u904d shell> mysql -u root -p testdb<test_tbl_define.sql \u767b\u5f55\u5230mysql\u5ba2\u6237\u7aef\uff0c\u6267\u884c\u4e0b\u9762\u7684\u8bed\u53e5\u5c06\u8868\u7a7a\u95f4\u4e22\u5f03\u3002\u8be5\u8bed\u53e5\u6267\u884c\u5b8c\u4ee5\u540e\uff0c\u4f1a\u5c06\u5bf9\u5e94\u8def\u5f84\u4e0b\u7684ibd\u6570\u636e\u6587\u4ef6\u5220\u9664 mysql > ALTER TABLE testdb.test_tbl DISCARD TABLESPACE ; 2.3 \u7ec4\u5408\u64cd\u4f5c \u00b6 \u5728\u6e90\u5b9e\u4f8b\u548c\u76ee\u6807\u5b9e\u4f8b\u5b8c\u6210\u4ee5\u4e0a\u64cd\u4f5c\u540e\uff0c\u53ef\u4ee5\u8fdb\u5165\u5230\u63a5\u4e0b\u6765\u7684\u7ec4\u5408\u64cd\u4f5c\u73af\u8282 \u91cd\u65b0\u6253\u5f00\u4e00\u4e2a\u4f1a\u8bdd\uff0c\u5c06cfg\u6587\u4ef6\u548cibd\u6587\u4ef6\u4ece\u6e90\u5b9e\u4f8b\u8f6c\u79fb\u5230\u76ee\u6807\u5b9e\u4f8b \u6e90\u5b9e\u4f8b shell> scp /mysqldata/testdb/test_tbl. { cfg,ibd } 192 .168.100.48:/mysqldata/testdb \u8f6c\u79fb\u5b8ccfg\u6587\u4ef6\u548cibd\u6587\u4ef6\u6587\u4ef6\u540e\uff0c\u5373\u53ef\u91ca\u653e\u6e90\u5b9e\u4f8b\u7684\u5171\u4eab\u9501 \u6e90\u5b9e\u4f8b mysql> USE testdb ; mysql> UNLOCK TABLES ; \u901a\u8fc7ssh\u767b\u5f55\u5230\u76ee\u6807\u5b9e\u4f8b\u5e76\u4fee\u6539\u6587\u4ef6\u5c5e\u6027 \u76ee\u6807\u5b9e\u4f8b shell> chown -R mysql:mysql /mysqldata/testdb \u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u5c06\u8868\u7a7a\u95f4\u6587\u4ef6\u5bfc\u5165\u76ee\u6807\u5b9e\u4f8b \u76ee\u6807\u5b9e\u4f8b mysql> ALTER TABLE testdb.test_tbl IMPORT TABLESPACE ; \u8868\u7a7a\u95f4\u8f6c\u79fb\u7ed3\u679c\u786e\u8ba4 \u76ee\u6807\u5b9e\u4f8b mysql> select * from testdb.test_tbl ; +----+--------------+----------+------+--------------+------------+-------------+-------------+--------------+ | id | order_car_id | car_num | type | warn_message | glongitude | glatitude | create_time | last_access | +----+--------------+----------+------+--------------+------------+-------------+-------------+--------------+ | 1 | 12345 | \u6caaA**** | 1 | test data1 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | | 2 | 12346 | \u6caaB**** | 0 | test data2 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | | 3 | 12347 | \u6caaC**** | 0 | test data3 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | | 4 | 12348 | \u6caaD**** | 1 | test data4 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | +----+--------------+----------+------+--------------+------------+-------------+-------------+--------------+ DB\u7c92\u5ea6\u5bfc\u5165\u3001\u5bfc\u51fa,\u53ef\u4ee5\u53c2\u8003\u6b64\u811a\u672c 3\u3001\u9650\u5236 \u00b6 **\u53ef\u8f6c\u79fb\u8868\u7a7a\u95f4**\u7279\u6027\u53ea\u652f\u6301file-per-table\u8868\u7a7a\u95f4\u91cc\u9762\u7684\u8868\uff0c\u8fd9\u4e00\u7279\u6027\u5bf9\u4e8e\u653e\u5728\u7cfb\u7edf\u8868\u7a7a\u95f4\u6216\u8005 \u901a\u7528\u8868\u7a7a\u95f4\u91cc\u9762\u7684\u8868\u4e0d\u9002\u7528 FLUSh TABLES ... FOR EXPORT \u4e0d\u652f\u6301\u5305\u542b\u5168\u6587\u7d22\u5f15\u7684\u8868\u3002\u5728\u6b64\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5728\u6267\u884c\u5bfc\u51fa \u8bed\u53e5\u4e4b\u524d\u5c06\u5168\u6587\u7d22\u5f15\u5220\u9664\uff0c\u76ee\u6807\u7aef\u5bfc\u5165\u4ee5\u540e\u5728\u8fdb\u884c\u91cd\u5efa\u3002 \u7531\u4e8e.cfg\u5143\u6570\u636e\u6587\u4ef6\u7684\u9650\u5236\uff0c\u5bf9\u4e8e\u5206\u533a\u8868\u6216\u8005\u5206\u533a\u5b9a\u4e49\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\u5c06\u4f1a\u629b\u51fa\u8868\u7a7a\u95f4\u4e0d\u5339\u914d\u7684\u62a5\u9519 4\u3001\u5185\u90e8\u5b9e\u73b0\u539f\u7406 \u00b6 \u5728\u6267\u884c\u5bfc\u5165\u3001\u5bfc\u51fa\u8868\u7a7a\u95f4\u76f8\u5173\u8bed\u53e5\u65f6\uff0c\u5404\u8bed\u53e5\u7684\u5185\u90e8\u64cd\u4f5c\u63cf\u8ff0\u5982\u4e0b\uff1a 4.1\u3001 ALTER TABLE ... DISCARD TABLESPACE \u00b6 \u5728\u76ee\u6807\u7aef\u3010\u5bfc\u5165\u5b9e\u4f8b\u3011\u6267\u884c\u8fd9\u6761\u8bed\u53e5\u65f6\uff0c\u5185\u90e8\u64cd\u4f5c\u5982\u4e0b \u5f85\u5bfc\u5165\u8868\u4f1a\u4ee5\u6392\u67e5\u7684\u65b9\u5f0f\u9501\u5b9a \u6570\u636e\u6587\u4ef6\u548c\u5143\u6570\u636e\u6587\u4ef6\u5206\u79bb 4.2\u3001 ALTER TABLE ... FOR EXPORT \u00b6 \u5728\u6e90\u7aef\u3010\u5bfc\u51fa\u5b9e\u4f8b\u3011\u6267\u884c\u8fd9\u6761\u8bed\u53e5\u65f6\uff0c\u5185\u90e8\u64cd\u4f5c\u5982\u4e0b \u5f85\u5bfc\u51fa\u8868\u4f1a\u4ee5\u5171\u4eab\u7684\u65b9\u5f0f\u9501\u5b9a \u6e05\u7406\u7ebf\u7a0b\u505c\u6b62\u5de5\u4f5c \u9a7b\u7559\u5728\u7f13\u51b2\u6c60\u91cc\u9762\u7684\u810f\u6570\u636e\u5237\u65b0\u5230\u78c1\u76d8 \u5f85\u5bfc\u51fa\u8868\u7684\u5143\u6570\u636e\u5199\u5165.cfg\u6587\u4ef6 \u6267\u884c\u4e0a\u8ff0\u8bed\u53e5\u65f6\uff0c\u5728MySQL\u9519\u8bef\u65e5\u5fd7\u91cc\u9762\u7684\u5185\u5982\u5982\u4e0b [ Note ] InnoDB: Sync to disk of '\"test\".\"t1\"' started. [ Note ] InnoDB: Stopping purge [ Note ] InnoDB: Writing table metadata to './test/t1.cfg' [ Note ] InnoDB: Table '\"test\".\"t1\"' flushed to disk 4.3\u3001 UNLOCK TABLES \u00b6 \u5728\u6e90\u7aef\u3010\u5bfc\u51fa\u5b9e\u4f8b\u3011\u6267\u884c\u8fd9\u6761\u8bed\u53e5\u65f6\uff0c\u5185\u90e8\u64cd\u4f5c\u5982\u4e0b \u5220\u9664\u5f85\u5bfc\u51fa\u8868\u7684\u5143\u6570\u636e.cfg\u6587\u4ef6 \u91ca\u653e\u5f85\u5bfc\u51fa\u8868\u4f1a\u4e0a\u9762\u7684\u5171\u4eab\u9501 \u6e05\u7406\u7ebf\u7a0b\u91cd\u542f \u6267\u884c\u4e0a\u8ff0\u8bed\u53e5\u65f6\uff0c\u5728MySQL\u9519\u8bef\u65e5\u5fd7\u91cc\u9762\u7684\u5185\u5982\u5982\u4e0b [ Note ] InnoDB: Deleting the meta-data file './test/t1.cfg' [ Note ] InnoDB: Resuming purge 4.4\u3001 ALTER TABLE ... IMPORT TABLESPACE \u00b6 \u5728\u76ee\u6807\u7aef\u3010\u5bfc\u5165\u5b9e\u4f8b\u3011\u6267\u884c\u8fd9\u6761\u8bed\u53e5\u65f6\uff0c\u5185\u90e8\u64cd\u4f5c\u5982\u4e0b \u68c0\u67e5\u6bcf\u4e00\u4e2a\u5f85\u5bfc\u5165\u8868\u7a7a\u95f4\u6570\u636e\u6587\u4ef6\u9875\u662f\u5426\u635f\u574f \u66f4\u65b0\u6bcf\u4e00\u9875\u7684\u8868\u7a7a\u95f4ID\u3010SPACE ID\u3011 \u548c\u65e5\u5fd7\u5e8f\u5217\u53f7\u3010LSN\u3011 \u6570\u636e\u9875\u5934\u6587\u4ef6\u91cc\u9762\u7684flags\u6821\u9a8c\u548cLSN\u66f4\u65b0 Btree\u7d22\u5f15\u9875\u66f4\u65b0 \u6570\u636e\u9875\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u810f\u9875\uff0c\u8fdb\u4e00\u6b65\u5237\u65b0\u5230\u78c1\u76d8 \u6267\u884c\u4e0a\u8ff0\u8bed\u53e5\u65f6\uff0c\u5728MySQL\u9519\u8bef\u65e5\u5fd7\u91cc\u9762\u7684\u5185\u5982\u5982\u4e0b [ Note ] InnoDB: Importing tablespace for table 'test/t1' that was exported from host 'host_name' [ Note ] InnoDB: Phase I - Update all pages [ Note ] InnoDB: Sync to disk [ Note ] InnoDB: Sync to disk - done ! [ Note ] InnoDB: Phase III - Flush changes to disk [ Note ] InnoDB: Phase IV - Flush complete","title":"InnoDB\u8868\u7a7a\u95f4\u8f6c\u79fb\u5b9e\u8df5"},{"location":"mysql/basic/202201/3.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E8%BD%AC%E7%A7%BB%E5%AE%9E%E8%B7%B5.html#innodb","text":"MySQL\u5b98\u65b9\u63d0\u4f9b\u7684\u8868\u7a7a\u95f4\u8f6c\u79fb\u7279\u6027[Transportable Tablespaces]\u53ef\u4ee5\u5feb\u901f\u5c06\u5927\u8868\u4ece\u4e00\u4e2a\u5b9e\u4f8b\u5bfc\u51fa\uff0c \u7136\u540e\u5bfc\u5165\u5230\u65b0\u7684\u5b9e\u4f8b\u3002\u501f\u52a9\u8fd9\u4e2a\u7279\u6027\u53ef\u4ee5\u5728\u65b0\u7684\u5b9e\u4f8b\u4e0a\u8fdb\u884c\u62a5\u8868\u67e5\u8be2\u3001\u5907\u4efd\u6062\u590d\u3001\u5feb\u901f\u91cd\u5efa\u5907\u5e93\u7b49","title":"InnoDB\u8868\u7a7a\u95f4\u8f6c\u79fb\u5b9e\u8df5"},{"location":"mysql/basic/202201/3.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E8%BD%AC%E7%A7%BB%E5%AE%9E%E8%B7%B5.html#1","text":"\u8981\u60f3\u5b8c\u6210InnoDB\u8868\u7a7a\u95f4\u8f6c\u79fb\uff0c\u9700\u8981\u6ee1\u8db3\u4e0b\u9762\u7684\u6761\u4ef6: \u6e90\u5b9e\u4f8b\u548c\u76ee\u6807\u5b9e\u4f8b\u5fc5\u987b\u5c06innodb_file_per_table\u8bbe\u7f6e\u4e3aON\uff0cMySQL\u9ed8\u8ba4\u8bbe\u7f6e\u4e3aON. \u6e90\u5b9e\u4f8b\u548c\u76ee\u6807\u5b9e\u4f8b\u5fc5\u987b\u5c06innodb_page_size\u7684\u503c\u4fdd\u6301\u4e00\u81f4\uff0c\u901a\u5e38\u8be5\u53c2\u6570\u53ea\u9700\u8981\u5728\u521d\u59cb\u5316MySQL\u5b9e\u4f8b\u65f6\u8bbe\u7f6e. \u6e90\u5b9e\u4f8b\u548c\u76ee\u6807\u5b9e\u4f8b\u5fc5\u987b\u4e3aGA\u7684\u7248\u672c\uff0c\u4e14\u7248\u672c\u53f7\u4e00\u81f4. \u5982\u679c\u4f7f\u7528\u5916\u952e\u7ea6\u675f\uff0c\u9700\u8981\u5728\u6267\u884cALTER TABLE db.table DISCARD TABLESPACE\u8bed\u53e5\u4e4b\u524d\uff0c\u5c06foreign_key_checks\u53c2\u6570\u7981\u7528\u3002\u4e3a\u4e86\u83b7\u53d6\u5230\u51c6\u786e\u7684\u6570\u636e\u6587\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7\u6682\u505c\u66f4\u65b0\u76f8\u4e92\u5173\u8054\u7684\u8868\uff0c\u63d0\u4ea4\u6240\u6709\u7684\u4e8b\u52a1\uff0c\u5728\u8fd9\u4e9b\u8868\u4e0a\u7533\u8bf7\u5171\u4eab\u9501\u4ee5\u540e\uff0c\u5728\u6267\u884c\u5bfc\u51fa\u8868\u7a7a\u95f4\u7684\u64cd\u4f5c\uff0c\u4ece\u800c\u5c06\u76f8\u4e92\u5173\u8054\u7684\u8868\u5728\u76f8\u540c\u7684\u903b\u8f91\u65f6\u95f4\u70b9\u5bfc\u51fa. \u6e90\u5b9e\u4f8b\u548c\u76ee\u6807\u5b9e\u4f8b\u7684\u8868\u7a7a\u95f4\u8def\u5f84\u5fc5\u987b\u4e00\u81f4,\u5426\u5219\u5728\u8fdb\u884c\u5bfc\u5165\u65f6\u4f1a\u62a5\u9519. \u6e90\u5b9e\u4f8b\u548c\u76ee\u6807\u5b9e\u4f8b\u7684\u6587\u4ef6\u683c\u5f0f\u5fc5\u987b\u4e00\u81f4. \u5982\u679c\u5728\u5efa\u8868\u65f6\u6ca1\u6709\u663e\u793a\u5b9a\u4e49row_format\u3001\u6216\u8005row_format=default,\u5fc5\u987b\u786e\u4fddinnodb_default_row_format\u7684\u503c\u5728\u6e90\u5b9e\u4f8b\u548c\u76ee\u6807\u5b9e\u4f8b\u4fdd\u6301\u4e00\u81f4","title":"1\u3001\u524d\u63d0\u6761\u4ef6"},{"location":"mysql/basic/202201/3.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E8%BD%AC%E7%A7%BB%E5%AE%9E%E8%B7%B5.html#2","text":"\u5982\u679c\u4e0a\u8ff0\u6761\u4ef6\u5b8c\u5168\u7b26\u5408\u4ee5\u540e\uff0c\u53ef\u4ee5\u8fdb\u884c\u540e\u7eed\u7684\u64cd\u4f5c\u3002\u6b64\u6b21\u5b9e\u8df5\u7684\u73af\u5883\u5982\u4e0b OS\uff1aCentOS Linux release 7 .7.1908 ( Core ) MySQL: mysqld Ver 5 .7.30 for Linux on x86_64 ( MySQL Community Server ( GPL )) DB: testdb table: test_tbl src_instance: 192 .168.100.187 dst_instance: 192 .168.100.48 \u8868\u7ed3\u6784\u5982\u4e0b\uff1a mysql> show create table testdb.test_tbl \\G *************************** 1 . row *************************** Table: test_tbl Create Table: CREATE TABLE ` test_tbl ` ( ` id ` bigint ( 20 ) unsigned NOT NULL AUTO_INCREMENT COMMENT 'pk' , ` order_car_id ` bigint ( 20 ) NOT NULL DEFAULT '0' COMMENT '\u5b57\u6bb5\u6ce8\u91ca' , ` car_num ` varchar ( 20 ) NOT NULL DEFAULT '' COMMENT '\u5b57\u6bb5\u6ce8\u91ca' , ` type ` tinyint ( 1 ) NOT NULL DEFAULT '0' COMMENT '\u5b57\u6bb5\u6ce8\u91ca ' , ` warn_message ` varchar ( 200 ) NOT NULL DEFAULT '' COMMENT '\u5b57\u6bb5\u6ce8\u91ca' , ` glongitude ` varchar ( 100 ) NOT NULL DEFAULT '' COMMENT '\u5b57\u6bb5\u6ce8\u91ca' , ` glatitude ` varchar ( 100 ) NOT NULL DEFAULT '' COMMENT '\u5b57\u6bb5\u6ce8\u91ca' , ` create_time ` bigint ( 20 ) NOT NULL DEFAULT '0' COMMENT '\u5b57\u6bb5\u6ce8\u91ca' , ` last_access ` bigint ( 20 ) NOT NULL DEFAULT '0' COMMENT '\u5b57\u6bb5\u6ce8\u91ca' , PRIMARY KEY ( ` id ` ) , KEY ` idx_order_car_id ` ( ` order_car_id ` ) ) ENGINE = InnoDB AUTO_INCREMENT = 5 DEFAULT CHARSET = utf8 ROW_FORMAT = DYNAMIC COMMENT = '\u8868\u6ce8\u91ca\u4fe1\u606f' 1 row in set ( 0 .00 sec ) mysql > select * from testdb.test_tbl ; +----+--------------+----------+------+--------------+------------+-------------+-------------+--------------+ | id | order_car_id | car_num | type | warn_message | glongitude | glatitude | create_time | last_access | +----+--------------+----------+------+--------------+------------+-------------+-------------+--------------+ | 1 | 12345 | \u6caaA**** | 1 | test data1 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | | 2 | 12346 | \u6caaB**** | 0 | test data2 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | | 3 | 12347 | \u6caaC**** | 0 | test data3 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | | 4 | 12348 | \u6caaD**** | 1 | test data4 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | +----+--------------+----------+------+--------------+------------+-------------+-------------+--------------+","title":"2\u3001\u5b9e\u8df5"},{"location":"mysql/basic/202201/3.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E8%BD%AC%E7%A7%BB%E5%AE%9E%E8%B7%B5.html#21","text":"\u5728\u6e90\u5b9e\u4f8b\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u5bfc\u51fa\u9700\u8981\u8f6c\u79fb\u7684\u8868\u7ed3\u6784\u5b9a\u4e49\u8bed\u53e5 shell > mysqldump -u root -p --single-transaction --no-data testdb test_tbl>test_tbl_define.sql \u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u5c06\u9700\u8981\u8f6c\u79fb\u7684\u8868\u7684\u5143\u6570\u636e\u548c\u6570\u636e\u6587\u4ef6\u5237\u65b0\u5230\u78c1\u76d8\uff0c\u5e76\u52a0\u4e0a\u5171\u4eab\u9501\u3002\u9700\u8981\u6ce8\u610f\uff0c\u5728\u6267\u884c\u5b8c\u8bed\u53e5\u4e4b\u540e\uff0c\u5c06cfg\u6587\u4ef6\u548cibd\u6587\u4ef6\u8f6c\u79fb\u4e4b\u524d\uff0c \u4e0d\u80fd\u9000\u51fa\u5f53\u524d\u4f1a\u8bdd mysql> FLUSH TABLE testdb.test_tbl FOR EXPORT ; Query OK, 0 rows affected ( 0 .06 sec ) \u6267\u884c\u5b8c\u4e0a\u8ff0\u8bed\u53e5\u4ee5\u540e\uff0c\u4f1a\u5728\u5bf9\u5e94\u7684\u6570\u636e\u5e93\u8def\u5f84\u4e0b\u65b0\u589e.cfg\u7684\u5143\u6570\u636e\u6587\u4ef6 mysql> system ls /mysqldata/testdb db.opt test_tbl.cfg test_tbl.frm test_tbl.ibd","title":"2.1 \u6e90\u5b9e\u4f8b\u64cd\u4f5c"},{"location":"mysql/basic/202201/3.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E8%BD%AC%E7%A7%BB%E5%AE%9E%E8%B7%B5.html#22","text":"\u5c06\u6e90\u5b9e\u4f8b\u5bfc\u51fa\u7684\u8868\u7ed3\u6784\u5b9a\u4e49\u8bed\u53e5\uff0c\u5728\u76ee\u6807\u5b9e\u4f8b\u6267\u884c\u4e00\u904d shell> mysql -u root -p testdb<test_tbl_define.sql \u767b\u5f55\u5230mysql\u5ba2\u6237\u7aef\uff0c\u6267\u884c\u4e0b\u9762\u7684\u8bed\u53e5\u5c06\u8868\u7a7a\u95f4\u4e22\u5f03\u3002\u8be5\u8bed\u53e5\u6267\u884c\u5b8c\u4ee5\u540e\uff0c\u4f1a\u5c06\u5bf9\u5e94\u8def\u5f84\u4e0b\u7684ibd\u6570\u636e\u6587\u4ef6\u5220\u9664 mysql > ALTER TABLE testdb.test_tbl DISCARD TABLESPACE ;","title":"2.2 \u76ee\u6807\u5b9e\u4f8b\u64cd\u4f5c"},{"location":"mysql/basic/202201/3.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E8%BD%AC%E7%A7%BB%E5%AE%9E%E8%B7%B5.html#23","text":"\u5728\u6e90\u5b9e\u4f8b\u548c\u76ee\u6807\u5b9e\u4f8b\u5b8c\u6210\u4ee5\u4e0a\u64cd\u4f5c\u540e\uff0c\u53ef\u4ee5\u8fdb\u5165\u5230\u63a5\u4e0b\u6765\u7684\u7ec4\u5408\u64cd\u4f5c\u73af\u8282 \u91cd\u65b0\u6253\u5f00\u4e00\u4e2a\u4f1a\u8bdd\uff0c\u5c06cfg\u6587\u4ef6\u548cibd\u6587\u4ef6\u4ece\u6e90\u5b9e\u4f8b\u8f6c\u79fb\u5230\u76ee\u6807\u5b9e\u4f8b \u6e90\u5b9e\u4f8b shell> scp /mysqldata/testdb/test_tbl. { cfg,ibd } 192 .168.100.48:/mysqldata/testdb \u8f6c\u79fb\u5b8ccfg\u6587\u4ef6\u548cibd\u6587\u4ef6\u6587\u4ef6\u540e\uff0c\u5373\u53ef\u91ca\u653e\u6e90\u5b9e\u4f8b\u7684\u5171\u4eab\u9501 \u6e90\u5b9e\u4f8b mysql> USE testdb ; mysql> UNLOCK TABLES ; \u901a\u8fc7ssh\u767b\u5f55\u5230\u76ee\u6807\u5b9e\u4f8b\u5e76\u4fee\u6539\u6587\u4ef6\u5c5e\u6027 \u76ee\u6807\u5b9e\u4f8b shell> chown -R mysql:mysql /mysqldata/testdb \u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u5c06\u8868\u7a7a\u95f4\u6587\u4ef6\u5bfc\u5165\u76ee\u6807\u5b9e\u4f8b \u76ee\u6807\u5b9e\u4f8b mysql> ALTER TABLE testdb.test_tbl IMPORT TABLESPACE ; \u8868\u7a7a\u95f4\u8f6c\u79fb\u7ed3\u679c\u786e\u8ba4 \u76ee\u6807\u5b9e\u4f8b mysql> select * from testdb.test_tbl ; +----+--------------+----------+------+--------------+------------+-------------+-------------+--------------+ | id | order_car_id | car_num | type | warn_message | glongitude | glatitude | create_time | last_access | +----+--------------+----------+------+--------------+------------+-------------+-------------+--------------+ | 1 | 12345 | \u6caaA**** | 1 | test data1 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | | 2 | 12346 | \u6caaB**** | 0 | test data2 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | | 3 | 12347 | \u6caaC**** | 0 | test data3 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | | 4 | 12348 | \u6caaD**** | 1 | test data4 | 1273 .9988 | 124523 .9988 | 168343434 | 168348367634 | +----+--------------+----------+------+--------------+------------+-------------+-------------+--------------+ DB\u7c92\u5ea6\u5bfc\u5165\u3001\u5bfc\u51fa,\u53ef\u4ee5\u53c2\u8003\u6b64\u811a\u672c","title":"2.3 \u7ec4\u5408\u64cd\u4f5c"},{"location":"mysql/basic/202201/3.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E8%BD%AC%E7%A7%BB%E5%AE%9E%E8%B7%B5.html#3","text":"**\u53ef\u8f6c\u79fb\u8868\u7a7a\u95f4**\u7279\u6027\u53ea\u652f\u6301file-per-table\u8868\u7a7a\u95f4\u91cc\u9762\u7684\u8868\uff0c\u8fd9\u4e00\u7279\u6027\u5bf9\u4e8e\u653e\u5728\u7cfb\u7edf\u8868\u7a7a\u95f4\u6216\u8005 \u901a\u7528\u8868\u7a7a\u95f4\u91cc\u9762\u7684\u8868\u4e0d\u9002\u7528 FLUSh TABLES ... FOR EXPORT \u4e0d\u652f\u6301\u5305\u542b\u5168\u6587\u7d22\u5f15\u7684\u8868\u3002\u5728\u6b64\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5728\u6267\u884c\u5bfc\u51fa \u8bed\u53e5\u4e4b\u524d\u5c06\u5168\u6587\u7d22\u5f15\u5220\u9664\uff0c\u76ee\u6807\u7aef\u5bfc\u5165\u4ee5\u540e\u5728\u8fdb\u884c\u91cd\u5efa\u3002 \u7531\u4e8e.cfg\u5143\u6570\u636e\u6587\u4ef6\u7684\u9650\u5236\uff0c\u5bf9\u4e8e\u5206\u533a\u8868\u6216\u8005\u5206\u533a\u5b9a\u4e49\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\u5c06\u4f1a\u629b\u51fa\u8868\u7a7a\u95f4\u4e0d\u5339\u914d\u7684\u62a5\u9519","title":"3\u3001\u9650\u5236"},{"location":"mysql/basic/202201/3.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E8%BD%AC%E7%A7%BB%E5%AE%9E%E8%B7%B5.html#4","text":"\u5728\u6267\u884c\u5bfc\u5165\u3001\u5bfc\u51fa\u8868\u7a7a\u95f4\u76f8\u5173\u8bed\u53e5\u65f6\uff0c\u5404\u8bed\u53e5\u7684\u5185\u90e8\u64cd\u4f5c\u63cf\u8ff0\u5982\u4e0b\uff1a","title":"4\u3001\u5185\u90e8\u5b9e\u73b0\u539f\u7406"},{"location":"mysql/basic/202201/3.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E8%BD%AC%E7%A7%BB%E5%AE%9E%E8%B7%B5.html#41alter-table-discard-tablespace","text":"\u5728\u76ee\u6807\u7aef\u3010\u5bfc\u5165\u5b9e\u4f8b\u3011\u6267\u884c\u8fd9\u6761\u8bed\u53e5\u65f6\uff0c\u5185\u90e8\u64cd\u4f5c\u5982\u4e0b \u5f85\u5bfc\u5165\u8868\u4f1a\u4ee5\u6392\u67e5\u7684\u65b9\u5f0f\u9501\u5b9a \u6570\u636e\u6587\u4ef6\u548c\u5143\u6570\u636e\u6587\u4ef6\u5206\u79bb","title":"4.1\u3001ALTER TABLE ... DISCARD TABLESPACE"},{"location":"mysql/basic/202201/3.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E8%BD%AC%E7%A7%BB%E5%AE%9E%E8%B7%B5.html#42alter-table-for-export","text":"\u5728\u6e90\u7aef\u3010\u5bfc\u51fa\u5b9e\u4f8b\u3011\u6267\u884c\u8fd9\u6761\u8bed\u53e5\u65f6\uff0c\u5185\u90e8\u64cd\u4f5c\u5982\u4e0b \u5f85\u5bfc\u51fa\u8868\u4f1a\u4ee5\u5171\u4eab\u7684\u65b9\u5f0f\u9501\u5b9a \u6e05\u7406\u7ebf\u7a0b\u505c\u6b62\u5de5\u4f5c \u9a7b\u7559\u5728\u7f13\u51b2\u6c60\u91cc\u9762\u7684\u810f\u6570\u636e\u5237\u65b0\u5230\u78c1\u76d8 \u5f85\u5bfc\u51fa\u8868\u7684\u5143\u6570\u636e\u5199\u5165.cfg\u6587\u4ef6 \u6267\u884c\u4e0a\u8ff0\u8bed\u53e5\u65f6\uff0c\u5728MySQL\u9519\u8bef\u65e5\u5fd7\u91cc\u9762\u7684\u5185\u5982\u5982\u4e0b [ Note ] InnoDB: Sync to disk of '\"test\".\"t1\"' started. [ Note ] InnoDB: Stopping purge [ Note ] InnoDB: Writing table metadata to './test/t1.cfg' [ Note ] InnoDB: Table '\"test\".\"t1\"' flushed to disk","title":"4.2\u3001ALTER TABLE ... FOR EXPORT"},{"location":"mysql/basic/202201/3.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E8%BD%AC%E7%A7%BB%E5%AE%9E%E8%B7%B5.html#43unlock-tables","text":"\u5728\u6e90\u7aef\u3010\u5bfc\u51fa\u5b9e\u4f8b\u3011\u6267\u884c\u8fd9\u6761\u8bed\u53e5\u65f6\uff0c\u5185\u90e8\u64cd\u4f5c\u5982\u4e0b \u5220\u9664\u5f85\u5bfc\u51fa\u8868\u7684\u5143\u6570\u636e.cfg\u6587\u4ef6 \u91ca\u653e\u5f85\u5bfc\u51fa\u8868\u4f1a\u4e0a\u9762\u7684\u5171\u4eab\u9501 \u6e05\u7406\u7ebf\u7a0b\u91cd\u542f \u6267\u884c\u4e0a\u8ff0\u8bed\u53e5\u65f6\uff0c\u5728MySQL\u9519\u8bef\u65e5\u5fd7\u91cc\u9762\u7684\u5185\u5982\u5982\u4e0b [ Note ] InnoDB: Deleting the meta-data file './test/t1.cfg' [ Note ] InnoDB: Resuming purge","title":"4.3\u3001UNLOCK TABLES"},{"location":"mysql/basic/202201/3.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E8%BD%AC%E7%A7%BB%E5%AE%9E%E8%B7%B5.html#44alter-table-import-tablespace","text":"\u5728\u76ee\u6807\u7aef\u3010\u5bfc\u5165\u5b9e\u4f8b\u3011\u6267\u884c\u8fd9\u6761\u8bed\u53e5\u65f6\uff0c\u5185\u90e8\u64cd\u4f5c\u5982\u4e0b \u68c0\u67e5\u6bcf\u4e00\u4e2a\u5f85\u5bfc\u5165\u8868\u7a7a\u95f4\u6570\u636e\u6587\u4ef6\u9875\u662f\u5426\u635f\u574f \u66f4\u65b0\u6bcf\u4e00\u9875\u7684\u8868\u7a7a\u95f4ID\u3010SPACE ID\u3011 \u548c\u65e5\u5fd7\u5e8f\u5217\u53f7\u3010LSN\u3011 \u6570\u636e\u9875\u5934\u6587\u4ef6\u91cc\u9762\u7684flags\u6821\u9a8c\u548cLSN\u66f4\u65b0 Btree\u7d22\u5f15\u9875\u66f4\u65b0 \u6570\u636e\u9875\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u810f\u9875\uff0c\u8fdb\u4e00\u6b65\u5237\u65b0\u5230\u78c1\u76d8 \u6267\u884c\u4e0a\u8ff0\u8bed\u53e5\u65f6\uff0c\u5728MySQL\u9519\u8bef\u65e5\u5fd7\u91cc\u9762\u7684\u5185\u5982\u5982\u4e0b [ Note ] InnoDB: Importing tablespace for table 'test/t1' that was exported from host 'host_name' [ Note ] InnoDB: Phase I - Update all pages [ Note ] InnoDB: Sync to disk [ Note ] InnoDB: Sync to disk - done ! [ Note ] InnoDB: Phase III - Flush changes to disk [ Note ] InnoDB: Phase IV - Flush complete","title":"4.4\u3001ALTER TABLE ... IMPORT TABLESPACE"},{"location":"mysql/basic/202201/4.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E4%BB%8B%E7%BB%8D.html","text":"InnoDB\u8868\u7a7a\u95f4\u4ecb\u7ecd \u00b6 1\u3001\u5171\u4eab\u8868\u7a7a\u95f4 \u00b6 \u8981\u60f3\u5b8c\u6210InnoDB\u8868\u7a7a\u95f4\u8f6c\u79fb\uff0c\u9700\u8981\u6ee1\u8db3\u4e0b\u9762\u7684\u6761\u4ef6: 1.1 \u7cfb\u7edf\u8868\u7a7a\u95f4-System tablespace \u00b6 1.2 \u901a\u7528\u8868\u7a7a\u95f4-General tablespace \u00b6 1.3 \u4e34\u65f6\u8868\u8868\u7a7a\u95f4 Temporary tablespace \u00b6 2\u3001\u72ec\u7acb\u8868\u7a7a\u95f4 File-per-table tablespace \u00b6 3\u3001\u56de\u6eda\u8868\u7a7a\u95f4 Undo tablespace \u00b6","title":"InnoDB\u8868\u7a7a\u95f4\u4ecb\u7ecd"},{"location":"mysql/basic/202201/4.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E4%BB%8B%E7%BB%8D.html#innodb","text":"","title":"InnoDB\u8868\u7a7a\u95f4\u4ecb\u7ecd"},{"location":"mysql/basic/202201/4.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E4%BB%8B%E7%BB%8D.html#1","text":"\u8981\u60f3\u5b8c\u6210InnoDB\u8868\u7a7a\u95f4\u8f6c\u79fb\uff0c\u9700\u8981\u6ee1\u8db3\u4e0b\u9762\u7684\u6761\u4ef6:","title":"1\u3001\u5171\u4eab\u8868\u7a7a\u95f4"},{"location":"mysql/basic/202201/4.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E4%BB%8B%E7%BB%8D.html#11-system-tablespace","text":"","title":"1.1 \u7cfb\u7edf\u8868\u7a7a\u95f4-System tablespace"},{"location":"mysql/basic/202201/4.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E4%BB%8B%E7%BB%8D.html#12-general-tablespace","text":"","title":"1.2 \u901a\u7528\u8868\u7a7a\u95f4-General tablespace"},{"location":"mysql/basic/202201/4.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E4%BB%8B%E7%BB%8D.html#13-temporary-tablespace","text":"","title":"1.3 \u4e34\u65f6\u8868\u8868\u7a7a\u95f4 Temporary tablespace"},{"location":"mysql/basic/202201/4.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E4%BB%8B%E7%BB%8D.html#2-file-per-table-tablespace","text":"","title":"2\u3001\u72ec\u7acb\u8868\u7a7a\u95f4 File-per-table tablespace"},{"location":"mysql/basic/202201/4.InnoDB%E8%A1%A8%E7%A9%BA%E9%97%B4%E4%BB%8B%E7%BB%8D.html#3-undo-tablespace","text":"","title":"3\u3001\u56de\u6eda\u8868\u7a7a\u95f4 Undo tablespace"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html","text":"OSC\u89e3\u51b3\u65b9\u6848\u5bf9\u6bd4 \u00b6 \u5728\u9605\u8bfb\u6b64\u535a\u5ba2\u4e4b\u524d\uff0c\u5efa\u8bae\u5148\u9605\u8bfb OSC\u5de5\u4f5c\u539f\u7406 1\u3001\u5b58\u5728\u7684\u5de5\u5177 \u00b6 \u9488\u5bf9MySQL\uff0c\u5f53\u524d\u6bd4\u8f83\u6d41\u884c\u7684\u5728\u7ebf\u8868\u7ed3\u6784\u53d8\u66f4\u5de5\u5177\u6709\u5982\u4e0b\u51e0\u6b3e\uff1a gh-ost pt-osc fb-osc Vitess 2\u3001\u5bf9\u6bd4\u9879\u76ee \u00b6 2.1 \u5f02\u6b65-asynchronous VS \u540c\u6b65-Synchronous \u00b6 2.2 \u57fa\u4e8e\u89e6\u53d1\u5668-Trigger-based VS \u65e0\u89e6\u53d1\u5668-triggerless \u00b6 2.3 \u7c97\u653e-Coarse VS \u7cbe\u7ec6-fine \u00b6 2.4 \u539f\u5b50\u6027\u5207\u6362-Atomic VS \u95f4\u9699\u6027\u5207\u6362-punctured \u00b6 2.5 Controlled vs. arbitrary cut-over schedule \u00b6 2.6 Primary vs. shared vs. flexible key iteration \u00b6 2.7 \u6258\u7ba1-Managed VS \u975e\u6258\u7ba1-unmanaged \u00b6 2.8 \u6267\u884c\u8fdb\u5ea6\u662f\u5426\u53ef\u63a7\u3001\u53ef\u5ba1\u8ba1 \u00b6 2.9 \u6267\u884c\u5931\u8d25\u540e\u662f\u5426\u53ef\u6062\u590d \u00b6 2.10 \u6267\u884c\u6210\u529f\u540e\u662f\u5426\u53ef\u56de\u9000 \u00b6 2.11 \u58f0\u660e\u5f0f-Declarative VS \u547d\u4ee4\u5f0f-imperative \u00b6","title":"OSC\u89e3\u51b3\u65b9\u6848\u5bf9\u6bd4"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html#osc","text":"\u5728\u9605\u8bfb\u6b64\u535a\u5ba2\u4e4b\u524d\uff0c\u5efa\u8bae\u5148\u9605\u8bfb OSC\u5de5\u4f5c\u539f\u7406","title":"OSC\u89e3\u51b3\u65b9\u6848\u5bf9\u6bd4"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html#1","text":"\u9488\u5bf9MySQL\uff0c\u5f53\u524d\u6bd4\u8f83\u6d41\u884c\u7684\u5728\u7ebf\u8868\u7ed3\u6784\u53d8\u66f4\u5de5\u5177\u6709\u5982\u4e0b\u51e0\u6b3e\uff1a gh-ost pt-osc fb-osc Vitess","title":"1\u3001\u5b58\u5728\u7684\u5de5\u5177"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html#2","text":"","title":"2\u3001\u5bf9\u6bd4\u9879\u76ee"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html#21-asynchronous-vs-synchronous","text":"","title":"2.1 \u5f02\u6b65-asynchronous  VS \u540c\u6b65-Synchronous"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html#22-trigger-based-vs-triggerless","text":"","title":"2.2 \u57fa\u4e8e\u89e6\u53d1\u5668-Trigger-based  VS \u65e0\u89e6\u53d1\u5668-triggerless"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html#23-coarse-vs-fine","text":"","title":"2.3 \u7c97\u653e-Coarse VS \u7cbe\u7ec6-fine"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html#24-atomic-vs-punctured","text":"","title":"2.4 \u539f\u5b50\u6027\u5207\u6362-Atomic VS \u95f4\u9699\u6027\u5207\u6362-punctured"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html#25-controlled-vs-arbitrary-cut-over-schedule","text":"","title":"2.5 Controlled vs. arbitrary cut-over schedule"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html#26-primary-vs-shared-vs-flexible-key-iteration","text":"","title":"2.6 Primary vs. shared vs. flexible key iteration"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html#27-managed-vs-unmanaged","text":"","title":"2.7 \u6258\u7ba1-Managed VS \u975e\u6258\u7ba1-unmanaged"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html#28","text":"","title":"2.8 \u6267\u884c\u8fdb\u5ea6\u662f\u5426\u53ef\u63a7\u3001\u53ef\u5ba1\u8ba1"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html#29","text":"","title":"2.9 \u6267\u884c\u5931\u8d25\u540e\u662f\u5426\u53ef\u6062\u590d"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html#210","text":"","title":"2.10 \u6267\u884c\u6210\u529f\u540e\u662f\u5426\u53ef\u56de\u9000"},{"location":"mysql/basic/202201/5.OSC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94.html#211-declarative-vs-imperative","text":"","title":"2.11 \u58f0\u660e\u5f0f-Declarative VS \u547d\u4ee4\u5f0f-imperative"},{"location":"mysql/basic/202201/6.MySQL5.7%E5%8D%87%E7%BA%A7%E5%AE%9E%E8%B7%B5.html","text":"MySQL5.7\u5c0f\u7248\u672c\u5347\u7ea7\u5b9e\u8df5 \u00b6 \u672c\u6b21\u5206\u4eab\u4eceMySQL5.7.18\u5347\u7ea7\u5230MySQL5.7.30\u7684\u5b9e\u8df5\uff0cMySQL\u5b8c\u6574\u7684\u5347\u7ea7\u6d41\u7a0b\u5982\u4e0b\uff1a 1\u3001\u4e3b\u8981\u53d8\u66f4Review \u00b6 \u5728\u5f00\u59cb\u5347\u7ea7MySQL\u4e4b\u524d\uff0c\u9700\u8981\u5148\u67e5\u770b \u5b98\u65b9\u624b\u518c \uff0c\u786e\u5b9a\u597d\u76ee\u6807\u7248\u672c\u4e0e\u73b0\u5728\u4f7f\u7528\u7248\u672c\u4e4b\u95f4\u7684\u91cd\u5927\u53d8\u66f4\uff0c\u5982\u679c\u4e24\u4e2a\u7248\u672c\u4e4b\u95f4\u5b58\u5728\u4e0d\u517c\u5bb9\uff0c\u9700\u8981\u4e0e\u5f00\u53d1\u4eba\u5458\u534f \u5546\u89e3\u51b3\u65b9\u6848\u3002\u4e3b\u8981\u5173\u6ce8\u70b9\u5305\u62ecSchema\u53d8\u66f4\uff0c\u65b0\u589e\u7cfb\u7edf\u53d8\u91cf\u3001\u72b6\u6001\u53d8\u91cf\uff0cSQL\u6a21\u5f0f\u7b49. 2\u3001\u89c4\u5212\u5b8c\u6574\u7684\u5347\u7ea7\u8fc7\u7a0b \u00b6 \u5728\u5b8c\u6210\u6b65\u9aa41\u4ee5\u540e\uff0c\u9700\u8981\u6839\u636e\u5f53\u524d\u6570\u636e\u91cf\u6765\u786e\u8ba4\u5347\u7ea7\u65b9\u5f0f. MySQL\u5e38\u89c1\u7684\u5347\u7ea7\u65b9\u5f0f\u5305\u542b\u4ee5\u4e0b\u4e24\u79cd\uff1a \u903b\u8f91\u5347\u7ea7 : \u9002\u7528\u4e8e \u539f\u5730\u5347\u7ea7 : \u9002\u7528\u4e8e 3\u3001\u5347\u7ea7\u4ece\u5e93 \u00b6 \u5728\u786e\u8ba4\u5b8c\u4e0a\u4e00\u6b65\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u5347\u7ea7\u751f\u4ea7\u73af\u5883\u7684\u6570\u636e\u5e93\u4e86\uff0c\u5728\u4e00\u5957\u4e3b\u4ece\u73af\u5883\u4e2d\uff0c\u5148\u5347\u7ea7\u5b8c\u4ece\u5e93\uff0c\u6700\u540e\u5347\u7ea7\u4e3b\u5e93\u3002 \u5347\u7ea7\u4ece\u5e93\u7684\u6d41\u7a0b\u5982\u4e0b: 1\u3001\u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u5173\u95edMySQL\u6570\u636e\u5e93\u4e4b\u524d\uff0c\u5148\u5c06\u9a7b\u7559\u5728\u5185\u5b58\u91cc\u9762\u7684\u6570\u636e\u5237\u65b0\u5230\u6570\u636e\u6587\u4ef6 mysql> set global innodb_fast_shutdown = 0 ; 2\u3001\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u505c\u6b62MySQL\u670d\u52a1 shell> service mysqld stop \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u5c06\u65e7\u7248MySQL\u4e8c\u8fdb\u5236\u6587\u4ef6\u79fb\u9664 shell> rpm -e mysql-community- { server,client,common,libs,libs-compat } -5.7.18-1.el7.x86_64 --nodeps \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u5b89\u88c5\u65b0\u7248MySQL\u4e8c\u8fdb\u5236\u6587\u4ef6 shell> rpm -ivh mysql-community- { server,devel,client,common,libs,libs-compat } -5.7.30-1.el7.x86_64.rpm \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u4f7f\u7528\u539f\u6765\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5c06MySQL\u5b9e\u4f8b\u542f\u52a8 shell> systemctl start mysqld \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u4fee\u590d\u65b0\u65e7\u7248\u672c\u4e0d\u517c\u5bb9\u7684\u5730\u65b9 shell> mysql_upgrade -u root -ppasswd \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u91cd\u542fMySQL\u5b9e\u4f8b shell> systemctl restart mysqld 3\u3001Switchover\u4e4b\u540e\uff0c\u5347\u7ea7\u4e3b\u5e93 \u00b6 \u5728\u5f00\u59cb\u5347\u7ea7\u4e3b\u5e93\u4e4b\u524d\uff0c\u9700\u8981\u786e\u4fdd\u6240\u6709\u4ece\u5e93\u5df2\u5b8c\u6210\u5347\u7ea7\u3002\u5728MHA\u7ba1\u7406\u8282\u70b9\u4e0a\u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c \u5728\u7ebf\u5c06\u4e3b\u8282\u70b9\u5207\u5230\u4ece\u5e93 masterha_master_switch --master_state = alive --conf = /data/mha_workdir/testmha/testmha.cnf --new_master_host = 192 .168.100.48 --orig_master_is_new_slave \u5728\u786e\u8ba4\u4e3b\u5e93\u89d2\u8272\u4e00\u5207\u6362\u4e3a\u4ece\u5e93\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u6309\u7167\u5347\u7ea7\u4ece\u5e93\u7684\u6d41\u7a0b\u6765\u5347\u7ea7\u4e3b\u5e93\uff0c\u5f85\u4e3b\u5e93\u5347\u7ea7\u5b8c\u6210\u540e\uff0c\u5728\u5c06\u539f\u4e3b\u5207\u5230\u5bf9\u5e94\u7684\u673a\u5668\u4e0a","title":"MySQL5.7\u5c0f\u7248\u672c\u5347\u7ea7\u5b9e\u8df5"},{"location":"mysql/basic/202201/6.MySQL5.7%E5%8D%87%E7%BA%A7%E5%AE%9E%E8%B7%B5.html#mysql57","text":"\u672c\u6b21\u5206\u4eab\u4eceMySQL5.7.18\u5347\u7ea7\u5230MySQL5.7.30\u7684\u5b9e\u8df5\uff0cMySQL\u5b8c\u6574\u7684\u5347\u7ea7\u6d41\u7a0b\u5982\u4e0b\uff1a","title":"MySQL5.7\u5c0f\u7248\u672c\u5347\u7ea7\u5b9e\u8df5"},{"location":"mysql/basic/202201/6.MySQL5.7%E5%8D%87%E7%BA%A7%E5%AE%9E%E8%B7%B5.html#1review","text":"\u5728\u5f00\u59cb\u5347\u7ea7MySQL\u4e4b\u524d\uff0c\u9700\u8981\u5148\u67e5\u770b \u5b98\u65b9\u624b\u518c \uff0c\u786e\u5b9a\u597d\u76ee\u6807\u7248\u672c\u4e0e\u73b0\u5728\u4f7f\u7528\u7248\u672c\u4e4b\u95f4\u7684\u91cd\u5927\u53d8\u66f4\uff0c\u5982\u679c\u4e24\u4e2a\u7248\u672c\u4e4b\u95f4\u5b58\u5728\u4e0d\u517c\u5bb9\uff0c\u9700\u8981\u4e0e\u5f00\u53d1\u4eba\u5458\u534f \u5546\u89e3\u51b3\u65b9\u6848\u3002\u4e3b\u8981\u5173\u6ce8\u70b9\u5305\u62ecSchema\u53d8\u66f4\uff0c\u65b0\u589e\u7cfb\u7edf\u53d8\u91cf\u3001\u72b6\u6001\u53d8\u91cf\uff0cSQL\u6a21\u5f0f\u7b49.","title":"1\u3001\u4e3b\u8981\u53d8\u66f4Review"},{"location":"mysql/basic/202201/6.MySQL5.7%E5%8D%87%E7%BA%A7%E5%AE%9E%E8%B7%B5.html#2","text":"\u5728\u5b8c\u6210\u6b65\u9aa41\u4ee5\u540e\uff0c\u9700\u8981\u6839\u636e\u5f53\u524d\u6570\u636e\u91cf\u6765\u786e\u8ba4\u5347\u7ea7\u65b9\u5f0f. MySQL\u5e38\u89c1\u7684\u5347\u7ea7\u65b9\u5f0f\u5305\u542b\u4ee5\u4e0b\u4e24\u79cd\uff1a \u903b\u8f91\u5347\u7ea7 : \u9002\u7528\u4e8e \u539f\u5730\u5347\u7ea7 : \u9002\u7528\u4e8e","title":"2\u3001\u89c4\u5212\u5b8c\u6574\u7684\u5347\u7ea7\u8fc7\u7a0b"},{"location":"mysql/basic/202201/6.MySQL5.7%E5%8D%87%E7%BA%A7%E5%AE%9E%E8%B7%B5.html#3","text":"\u5728\u786e\u8ba4\u5b8c\u4e0a\u4e00\u6b65\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u5347\u7ea7\u751f\u4ea7\u73af\u5883\u7684\u6570\u636e\u5e93\u4e86\uff0c\u5728\u4e00\u5957\u4e3b\u4ece\u73af\u5883\u4e2d\uff0c\u5148\u5347\u7ea7\u5b8c\u4ece\u5e93\uff0c\u6700\u540e\u5347\u7ea7\u4e3b\u5e93\u3002 \u5347\u7ea7\u4ece\u5e93\u7684\u6d41\u7a0b\u5982\u4e0b: 1\u3001\u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u5173\u95edMySQL\u6570\u636e\u5e93\u4e4b\u524d\uff0c\u5148\u5c06\u9a7b\u7559\u5728\u5185\u5b58\u91cc\u9762\u7684\u6570\u636e\u5237\u65b0\u5230\u6570\u636e\u6587\u4ef6 mysql> set global innodb_fast_shutdown = 0 ; 2\u3001\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u505c\u6b62MySQL\u670d\u52a1 shell> service mysqld stop \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u5c06\u65e7\u7248MySQL\u4e8c\u8fdb\u5236\u6587\u4ef6\u79fb\u9664 shell> rpm -e mysql-community- { server,client,common,libs,libs-compat } -5.7.18-1.el7.x86_64 --nodeps \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u5b89\u88c5\u65b0\u7248MySQL\u4e8c\u8fdb\u5236\u6587\u4ef6 shell> rpm -ivh mysql-community- { server,devel,client,common,libs,libs-compat } -5.7.30-1.el7.x86_64.rpm \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u4f7f\u7528\u539f\u6765\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5c06MySQL\u5b9e\u4f8b\u542f\u52a8 shell> systemctl start mysqld \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u4fee\u590d\u65b0\u65e7\u7248\u672c\u4e0d\u517c\u5bb9\u7684\u5730\u65b9 shell> mysql_upgrade -u root -ppasswd \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u91cd\u542fMySQL\u5b9e\u4f8b shell> systemctl restart mysqld","title":"3\u3001\u5347\u7ea7\u4ece\u5e93"},{"location":"mysql/basic/202201/6.MySQL5.7%E5%8D%87%E7%BA%A7%E5%AE%9E%E8%B7%B5.html#3switchover","text":"\u5728\u5f00\u59cb\u5347\u7ea7\u4e3b\u5e93\u4e4b\u524d\uff0c\u9700\u8981\u786e\u4fdd\u6240\u6709\u4ece\u5e93\u5df2\u5b8c\u6210\u5347\u7ea7\u3002\u5728MHA\u7ba1\u7406\u8282\u70b9\u4e0a\u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c \u5728\u7ebf\u5c06\u4e3b\u8282\u70b9\u5207\u5230\u4ece\u5e93 masterha_master_switch --master_state = alive --conf = /data/mha_workdir/testmha/testmha.cnf --new_master_host = 192 .168.100.48 --orig_master_is_new_slave \u5728\u786e\u8ba4\u4e3b\u5e93\u89d2\u8272\u4e00\u5207\u6362\u4e3a\u4ece\u5e93\u4ee5\u540e\uff0c\u5c31\u53ef\u4ee5\u6309\u7167\u5347\u7ea7\u4ece\u5e93\u7684\u6d41\u7a0b\u6765\u5347\u7ea7\u4e3b\u5e93\uff0c\u5f85\u4e3b\u5e93\u5347\u7ea7\u5b8c\u6210\u540e\uff0c\u5728\u5c06\u539f\u4e3b\u5207\u5230\u5bf9\u5e94\u7684\u673a\u5668\u4e0a","title":"3\u3001Switchover\u4e4b\u540e\uff0c\u5347\u7ea7\u4e3b\u5e93"},{"location":"mysql/basic/202201/7.MySQL%E5%90%84%E8%AF%AD%E5%8F%A5%E5%8A%A0%E9%94%81%E7%B1%BB%E5%9E%8B.html","text":"MySQL\u5404\u8bed\u53e5\u52a0\u9501\u7c7b\u578b \u00b6 MySQL\u4e3a\u4e86\u5bf9\u5171\u4eab\u8d44\u6e90\u7684\u5e76\u53d1\u8bbf\u95ee\u8fdb\u884c\u63a7\u5236\uff0c\u5f15\u5165\u4e86\u9501\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u4fdd\u62a4 1. \u975e\u9501\u5b9a\u8bfb \u00b6 SELECT ... FROM \u5c5e\u4e8e\u4e00\u81f4\u6027\u975e\u9501\u5b9a\u8bfb\uff0c\u901a\u8fc7\u6570\u636e\u5e93\u7684undo\u6765\u6784\u5efa\u5feb\u7167\uff0c\u7136\u540e\u57fa\u4e8e\u6b64\u5feb\u7167\u8fd4\u56de\u7ed3\u679c\u96c6\uff0c \u5728RC\u548cRR\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u6b64\u65f6\u4e0d\u4f1a\u5bf9\u6570\u636e\u5e93\u8bb0\u5f55\u52a0\u9501\u3002\u5f53\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u7f6e\u4e3a**\u53ef\u4e32\u884c\u5316\u3010SERIALIZABLE\u3011**\u65f6\uff0c \u8fd9\u4e2a\u67e5\u8be2\u5bf9\u626b\u63cf\u7684\u7d22\u5f15\u8bb0\u5f55\u52a0 shared next-key \u9501\uff1b\u5f53\u67e5\u8be2\u6761\u4ef6\u7684\u5b57\u6bb5\u4f7f\u7528\u552f\u4e00\u7d22\u5f15\u65f6\uff0c\u52a0\u7d22\u5f15\u8bb0\u5f55\u9501\u3002 2. \u9501\u5b9a\u8bfb \u00b6 SELECT ... FROM ... FOR UPDATE \u6216 SELECT ... FROM ... LOCK IN SHARE MODE \u4f1a \u5bf9\u626b\u63cf\u5230\u7684\u884c\u52a0\u9501. \u5bf9\u4e8e SELECT ... FROM ... FOR UPDATE \u5c06\u904d\u5386\u7684\u884c\u6dfb\u52a0\u4e92\u65a5 next-key\u9501\uff0c\u5f53\u67e5\u8be2\u6761\u4ef6\u91cc\u9762\u7684\u5b57\u6bb5\u4f7f\u7528 \u552f\u4e00\u7d22\u5f15\u65f6\uff0c\u5c06\u904d\u5386\u7684\u884c\u6dfb\u52a0\u7d22\u5f15\u8bb0\u5f55\u9501\u3010index record lock\u3011 \u5bf9\u4e8e SELECT ... FROM ... LOCK IN SHARE MODE \u5c06\u904d\u5386\u7684\u884c\u6dfb\u52a0\u5171\u4eab next-key\u9501\uff0c\u5f53\u67e5\u8be2\u6761\u4ef6\u91cc\u9762\u7684\u5b57\u6bb5\u4f7f\u7528 \u552f\u4e00\u7d22\u5f15\u65f6\uff0c\u5c06\u904d\u5386\u7684\u884c\u6dfb\u52a0\u7d22\u5f15\u8bb0\u5f55\u9501\u3010index record lock\u3011 3. DML\u8bed\u53e5 \u00b6 UPDATE ... WHERE ... \u5728\u626b\u63cf\u7684\u884c\u4e0a\u9762\u52a0\u4e92\u65a5next-key\u9501\uff0c\u5f53\u67e5\u8be2\u6761\u4ef6\u91cc\u9762\u7684\u5b57\u6bb5\u4f7f\u7528 \u552f\u4e00\u7d22\u5f15\u65f6\uff0c\u5c06\u904d\u5386\u7684\u884c\u6dfb\u52a0\u7d22\u5f15\u8bb0\u5f55\u9501\u3010index record lock\u3011\u3002\u5f53UPDATE\u8bed\u53e5\u66f4\u65b0\u805a\u7c07\u7d22\u5f15\u65f6\uff0c\u4f1a\u5728\u53d7\u5f71\u54cd\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u9762 \u6dfb\u52a0\u9690\u5f0f\u9501\uff1b DELETE FROM ... WHERE ... \u5728\u626b\u63cf\u7684\u884c\u4e0a\u9762\u52a0\u4e92\u65a5next-key\u9501\uff0c\u5f53\u67e5\u8be2\u6761\u4ef6\u91cc\u9762\u7684\u5b57\u6bb5\u4f7f\u7528 \u552f\u4e00\u7d22\u5f15\u65f6\uff0c\u5c06\u904d\u5386\u7684\u884c\u6dfb\u52a0\u7d22\u5f15\u8bb0\u5f55\u9501\u3010index record lock\u3011\u3002 INSERT \u5728\u88ab\u63d2\u5165\u7684\u884c\u4e0a\u9762\u6dfb\u52a0\u4e92\u65a5\u9501\u3002\u8fd9\u4e2a\u9501\u662f\u7d22\u5f15\u8bb0\u5f55\u9501","title":"MySQL\u5404\u8bed\u53e5\u52a0\u9501\u7c7b\u578b"},{"location":"mysql/basic/202201/7.MySQL%E5%90%84%E8%AF%AD%E5%8F%A5%E5%8A%A0%E9%94%81%E7%B1%BB%E5%9E%8B.html#mysql","text":"MySQL\u4e3a\u4e86\u5bf9\u5171\u4eab\u8d44\u6e90\u7684\u5e76\u53d1\u8bbf\u95ee\u8fdb\u884c\u63a7\u5236\uff0c\u5f15\u5165\u4e86\u9501\u6765\u5bf9\u6570\u636e\u8fdb\u884c\u4fdd\u62a4","title":"MySQL\u5404\u8bed\u53e5\u52a0\u9501\u7c7b\u578b"},{"location":"mysql/basic/202201/7.MySQL%E5%90%84%E8%AF%AD%E5%8F%A5%E5%8A%A0%E9%94%81%E7%B1%BB%E5%9E%8B.html#1","text":"SELECT ... FROM \u5c5e\u4e8e\u4e00\u81f4\u6027\u975e\u9501\u5b9a\u8bfb\uff0c\u901a\u8fc7\u6570\u636e\u5e93\u7684undo\u6765\u6784\u5efa\u5feb\u7167\uff0c\u7136\u540e\u57fa\u4e8e\u6b64\u5feb\u7167\u8fd4\u56de\u7ed3\u679c\u96c6\uff0c \u5728RC\u548cRR\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u6b64\u65f6\u4e0d\u4f1a\u5bf9\u6570\u636e\u5e93\u8bb0\u5f55\u52a0\u9501\u3002\u5f53\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u7f6e\u4e3a**\u53ef\u4e32\u884c\u5316\u3010SERIALIZABLE\u3011**\u65f6\uff0c \u8fd9\u4e2a\u67e5\u8be2\u5bf9\u626b\u63cf\u7684\u7d22\u5f15\u8bb0\u5f55\u52a0 shared next-key \u9501\uff1b\u5f53\u67e5\u8be2\u6761\u4ef6\u7684\u5b57\u6bb5\u4f7f\u7528\u552f\u4e00\u7d22\u5f15\u65f6\uff0c\u52a0\u7d22\u5f15\u8bb0\u5f55\u9501\u3002","title":"1. \u975e\u9501\u5b9a\u8bfb"},{"location":"mysql/basic/202201/7.MySQL%E5%90%84%E8%AF%AD%E5%8F%A5%E5%8A%A0%E9%94%81%E7%B1%BB%E5%9E%8B.html#2","text":"SELECT ... FROM ... FOR UPDATE \u6216 SELECT ... FROM ... LOCK IN SHARE MODE \u4f1a \u5bf9\u626b\u63cf\u5230\u7684\u884c\u52a0\u9501. \u5bf9\u4e8e SELECT ... FROM ... FOR UPDATE \u5c06\u904d\u5386\u7684\u884c\u6dfb\u52a0\u4e92\u65a5 next-key\u9501\uff0c\u5f53\u67e5\u8be2\u6761\u4ef6\u91cc\u9762\u7684\u5b57\u6bb5\u4f7f\u7528 \u552f\u4e00\u7d22\u5f15\u65f6\uff0c\u5c06\u904d\u5386\u7684\u884c\u6dfb\u52a0\u7d22\u5f15\u8bb0\u5f55\u9501\u3010index record lock\u3011 \u5bf9\u4e8e SELECT ... FROM ... LOCK IN SHARE MODE \u5c06\u904d\u5386\u7684\u884c\u6dfb\u52a0\u5171\u4eab next-key\u9501\uff0c\u5f53\u67e5\u8be2\u6761\u4ef6\u91cc\u9762\u7684\u5b57\u6bb5\u4f7f\u7528 \u552f\u4e00\u7d22\u5f15\u65f6\uff0c\u5c06\u904d\u5386\u7684\u884c\u6dfb\u52a0\u7d22\u5f15\u8bb0\u5f55\u9501\u3010index record lock\u3011","title":"2. \u9501\u5b9a\u8bfb"},{"location":"mysql/basic/202201/7.MySQL%E5%90%84%E8%AF%AD%E5%8F%A5%E5%8A%A0%E9%94%81%E7%B1%BB%E5%9E%8B.html#3-dml","text":"UPDATE ... WHERE ... \u5728\u626b\u63cf\u7684\u884c\u4e0a\u9762\u52a0\u4e92\u65a5next-key\u9501\uff0c\u5f53\u67e5\u8be2\u6761\u4ef6\u91cc\u9762\u7684\u5b57\u6bb5\u4f7f\u7528 \u552f\u4e00\u7d22\u5f15\u65f6\uff0c\u5c06\u904d\u5386\u7684\u884c\u6dfb\u52a0\u7d22\u5f15\u8bb0\u5f55\u9501\u3010index record lock\u3011\u3002\u5f53UPDATE\u8bed\u53e5\u66f4\u65b0\u805a\u7c07\u7d22\u5f15\u65f6\uff0c\u4f1a\u5728\u53d7\u5f71\u54cd\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u9762 \u6dfb\u52a0\u9690\u5f0f\u9501\uff1b DELETE FROM ... WHERE ... \u5728\u626b\u63cf\u7684\u884c\u4e0a\u9762\u52a0\u4e92\u65a5next-key\u9501\uff0c\u5f53\u67e5\u8be2\u6761\u4ef6\u91cc\u9762\u7684\u5b57\u6bb5\u4f7f\u7528 \u552f\u4e00\u7d22\u5f15\u65f6\uff0c\u5c06\u904d\u5386\u7684\u884c\u6dfb\u52a0\u7d22\u5f15\u8bb0\u5f55\u9501\u3010index record lock\u3011\u3002 INSERT \u5728\u88ab\u63d2\u5165\u7684\u884c\u4e0a\u9762\u6dfb\u52a0\u4e92\u65a5\u9501\u3002\u8fd9\u4e2a\u9501\u662f\u7d22\u5f15\u8bb0\u5f55\u9501","title":"3. DML\u8bed\u53e5"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html","text":"MySQL\u5907\u4efd\u6062\u590d\u6700\u4f73\u5b9e\u8df5 \u00b6 \u5907\u4efd\u548c\u6062\u590d\u662f\u6570\u636e\u5e93\u65e5\u5e38\u8fd0\u7ef4\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u9879\u4efb\u52a1\u3002\u5982\u679c\u6570\u636e\u5e93\u53d1\u751f\u5b95\u673a\u5e76\u4e14\u6ca1\u6709\u6709\u6548\u7684\u5907\u4efd\u7528\u6765\u6062\u590d\u6570\u636e\u5e93\uff0c \u90a3\u4efb\u4f55\u7531\u6b64\u800c\u4ea7\u751f\u7684\u6570\u636e\u4e22\u5931\u90fd\u53ef\u80fd\u7ed9\u4f01\u4e1a\u5e26\u6765\u6bc1\u706d\u6027\u7684\u540e\u679c\u3002\u6709\u4eba\u53ef\u80fd\u4f1a\u4e89\u8fa9\u8bf4\uff0c\u53ef\u4ee5\u901a\u8fc7\u5c06\u6570\u636e\u590d\u5236\u5230\u591a\u4e2a\u670d\u52a1\u5668 \u6216\u6570\u636e\u4e2d\u5fc3\u6765\u9632\u6b62\u5d29\u6e83\uff0c\u4f46\u8bbe\u60f3\u4e00\u4e0b\uff0c\u5f53\u4e0b\u5217\u5f02\u5e38\u53d1\u751f\u65f6\uff0c\u4f60\u53ea\u80fd\u7528\u5907\u4efd\u6765\u8fdb\u884c\u6062\u590d\uff1a \u7531\u4e8e\u5e94\u7528\u7a0b\u5e8fbug\u5bfc\u81f4\u6570\u636e\u9519\u8bef\uff0c\u4e14\u8fd9\u4e9b\u9519\u8bef\u5df2\u7ecf\u5e7f\u64ad\u5230\u6240\u6709\u4ece\u5e93 \u4eba\u4e3a\u56e0\u7d20\u5bfc\u81f4\u7684\u6570\u636e\u5e93\u5bf9\u8c61(database\u3001table\u3001row)\u88ab\u5220\u9664 1\u3001\u4e0d\u540c\u7684\u5907\u4efd\u65b9\u6cd5 \u00b6 \u76ee\u524d\u5b58\u5728\u5f88\u591a\u79cd\u6570\u636e\u5e93\u5907\u4efd\u65b9\u6cd5\uff0c\u4ece\u5907\u4efd\u7684\u6570\u636e\u6587\u4ef6\u6765\u770b\uff0c\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8fdb\u884c\u5206\u7c7b\uff1a \u4ece\u6587\u4ef6\u5f62\u5f0f\uff1a \u7269\u7406\u5907\u4efd vs \u903b\u8f91\u5907\u4efd \u4ece\u662f\u5426\u9700\u8981\u505c\u673a\uff1a \u70ed\u5907 vs \u6e29\u5907 vs \u51b7\u5907 \u4ece\u662f\u5426\u5b8c\u6574\uff1a \u5168\u91cf\u5907\u4efd vs \u589e\u91cf/\u5dee\u5f02\u5907\u4efd \u4ece\u5907\u4efd\u5bf9\u8c61\u6765\u770b\uff1a \u6570\u636e\u5907\u4efd vs \u65e5\u5fd7\u5907\u4efd \u7269\u7406\u5907\u4efd\u5219\u662f\u76f4\u63a5\u5728\u6587\u4ef6\u7cfb\u7edf\u5c42\u5bf9\u6240\u6709\u76f8\u5173\u7684\u539f\u751f\u6587\u4ef6\u8fdb\u884c\u62f7\u8d1d\uff0c\u6bd4\u5982\u6574\u4e2a\u6570\u636e\u6587\u4ef6\u5939\u3002 \u903b\u8f91\u5907\u4efd\u5305\u542b\u4f7f\u7528SQL\u8bed\u53e5\u5bfc\u51fa\u5e76\u5b58\u50a8\u5230\u4e00\u4e2a\u6587\u4ef6\u7684\u6570\u636e\uff0c\u6587\u4ef6\u5185\u5bb9\u7531\u4e00\u7cfb\u5217DDL\u8bed\u53e5\u548cINSERT\u8bed\u53e5\u7ec4\u6210\u3002\u903b\u8f91\u5907\u4efd \u901a\u5e38\u6bd4\u7269\u7406\u5907\u4efd\u6162 1.1\u3001\u903b\u8f91\u5907\u4efd\u65b9\u6cd5 \u00b6 1.1.1 \u4f7f\u7528mysqldump\u505a\u903b\u8f91\u5907\u4efd \u00b6 1.1.2 \u4f7f\u7528SELECT ... INTO OUTFILE\u505a\u903b\u8f91\u5907\u4efd \u00b6 1.1.3 \u4f7f\u7528mydumper/myloader\u505a\u903b\u8f91\u5907\u4efd \u00b6 1.2\u3001\u7269\u7406\u5907\u4efd\u65b9\u6cd5 \u00b6 1.2.1 \u4f7f\u7528xtrabackup\u505a\u7269\u7406\u5907\u4efd \u00b6 1.2.2 \u4f7f\u7528Snapshot\u505a\u7269\u7406\u5907\u4efd \u00b6 2 \u6700\u4f73\u5b9e\u8df5\u4e0e\u6307\u5bfc \u00b6 2.1 \u662f\u5426\u9700\u8981PITR \u00b6 2.2 \u80fd\u4ece\u884c\u7684\u7c92\u5ea6\u8fdb\u884c\u6062\u590d \u00b6 2.3 \u80fd\u4ece\u884c\u7684\u7c92\u5ea6\u8fdb\u884c\u6062\u590d \u00b6 2.4 \u5907\u4efd\u9891\u7387\u548c\u4fdd\u7559\u5468\u671f \u00b6 2.5 \u5907\u4efd\u6709\u6548\u6027\u68c0\u67e5\u4e0e\u8fc7\u7a0b\u6587\u6863\u5316 \u00b6","title":"MySQL\u5907\u4efd\u6062\u590d\u6700\u4f73\u5b9e\u8df5"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#mysql","text":"\u5907\u4efd\u548c\u6062\u590d\u662f\u6570\u636e\u5e93\u65e5\u5e38\u8fd0\u7ef4\u4e2d\u975e\u5e38\u91cd\u8981\u7684\u4e00\u9879\u4efb\u52a1\u3002\u5982\u679c\u6570\u636e\u5e93\u53d1\u751f\u5b95\u673a\u5e76\u4e14\u6ca1\u6709\u6709\u6548\u7684\u5907\u4efd\u7528\u6765\u6062\u590d\u6570\u636e\u5e93\uff0c \u90a3\u4efb\u4f55\u7531\u6b64\u800c\u4ea7\u751f\u7684\u6570\u636e\u4e22\u5931\u90fd\u53ef\u80fd\u7ed9\u4f01\u4e1a\u5e26\u6765\u6bc1\u706d\u6027\u7684\u540e\u679c\u3002\u6709\u4eba\u53ef\u80fd\u4f1a\u4e89\u8fa9\u8bf4\uff0c\u53ef\u4ee5\u901a\u8fc7\u5c06\u6570\u636e\u590d\u5236\u5230\u591a\u4e2a\u670d\u52a1\u5668 \u6216\u6570\u636e\u4e2d\u5fc3\u6765\u9632\u6b62\u5d29\u6e83\uff0c\u4f46\u8bbe\u60f3\u4e00\u4e0b\uff0c\u5f53\u4e0b\u5217\u5f02\u5e38\u53d1\u751f\u65f6\uff0c\u4f60\u53ea\u80fd\u7528\u5907\u4efd\u6765\u8fdb\u884c\u6062\u590d\uff1a \u7531\u4e8e\u5e94\u7528\u7a0b\u5e8fbug\u5bfc\u81f4\u6570\u636e\u9519\u8bef\uff0c\u4e14\u8fd9\u4e9b\u9519\u8bef\u5df2\u7ecf\u5e7f\u64ad\u5230\u6240\u6709\u4ece\u5e93 \u4eba\u4e3a\u56e0\u7d20\u5bfc\u81f4\u7684\u6570\u636e\u5e93\u5bf9\u8c61(database\u3001table\u3001row)\u88ab\u5220\u9664","title":"MySQL\u5907\u4efd\u6062\u590d\u6700\u4f73\u5b9e\u8df5"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#1","text":"\u76ee\u524d\u5b58\u5728\u5f88\u591a\u79cd\u6570\u636e\u5e93\u5907\u4efd\u65b9\u6cd5\uff0c\u4ece\u5907\u4efd\u7684\u6570\u636e\u6587\u4ef6\u6765\u770b\uff0c\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8fdb\u884c\u5206\u7c7b\uff1a \u4ece\u6587\u4ef6\u5f62\u5f0f\uff1a \u7269\u7406\u5907\u4efd vs \u903b\u8f91\u5907\u4efd \u4ece\u662f\u5426\u9700\u8981\u505c\u673a\uff1a \u70ed\u5907 vs \u6e29\u5907 vs \u51b7\u5907 \u4ece\u662f\u5426\u5b8c\u6574\uff1a \u5168\u91cf\u5907\u4efd vs \u589e\u91cf/\u5dee\u5f02\u5907\u4efd \u4ece\u5907\u4efd\u5bf9\u8c61\u6765\u770b\uff1a \u6570\u636e\u5907\u4efd vs \u65e5\u5fd7\u5907\u4efd \u7269\u7406\u5907\u4efd\u5219\u662f\u76f4\u63a5\u5728\u6587\u4ef6\u7cfb\u7edf\u5c42\u5bf9\u6240\u6709\u76f8\u5173\u7684\u539f\u751f\u6587\u4ef6\u8fdb\u884c\u62f7\u8d1d\uff0c\u6bd4\u5982\u6574\u4e2a\u6570\u636e\u6587\u4ef6\u5939\u3002 \u903b\u8f91\u5907\u4efd\u5305\u542b\u4f7f\u7528SQL\u8bed\u53e5\u5bfc\u51fa\u5e76\u5b58\u50a8\u5230\u4e00\u4e2a\u6587\u4ef6\u7684\u6570\u636e\uff0c\u6587\u4ef6\u5185\u5bb9\u7531\u4e00\u7cfb\u5217DDL\u8bed\u53e5\u548cINSERT\u8bed\u53e5\u7ec4\u6210\u3002\u903b\u8f91\u5907\u4efd \u901a\u5e38\u6bd4\u7269\u7406\u5907\u4efd\u6162","title":"1\u3001\u4e0d\u540c\u7684\u5907\u4efd\u65b9\u6cd5"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#11","text":"","title":"1.1\u3001\u903b\u8f91\u5907\u4efd\u65b9\u6cd5"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#111-mysqldump","text":"","title":"1.1.1 \u4f7f\u7528mysqldump\u505a\u903b\u8f91\u5907\u4efd"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#112-select-into-outfile","text":"","title":"1.1.2 \u4f7f\u7528SELECT ... INTO OUTFILE\u505a\u903b\u8f91\u5907\u4efd"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#113-mydumpermyloader","text":"","title":"1.1.3 \u4f7f\u7528mydumper/myloader\u505a\u903b\u8f91\u5907\u4efd"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#12","text":"","title":"1.2\u3001\u7269\u7406\u5907\u4efd\u65b9\u6cd5"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#121-xtrabackup","text":"","title":"1.2.1 \u4f7f\u7528xtrabackup\u505a\u7269\u7406\u5907\u4efd"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#122-snapshot","text":"","title":"1.2.2 \u4f7f\u7528Snapshot\u505a\u7269\u7406\u5907\u4efd"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#2","text":"","title":"2 \u6700\u4f73\u5b9e\u8df5\u4e0e\u6307\u5bfc"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#21-pitr","text":"","title":"2.1 \u662f\u5426\u9700\u8981PITR"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#22","text":"","title":"2.2 \u80fd\u4ece\u884c\u7684\u7c92\u5ea6\u8fdb\u884c\u6062\u590d"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#23","text":"","title":"2.3 \u80fd\u4ece\u884c\u7684\u7c92\u5ea6\u8fdb\u884c\u6062\u590d"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#24","text":"","title":"2.4 \u5907\u4efd\u9891\u7387\u548c\u4fdd\u7559\u5468\u671f"},{"location":"mysql/basic/202202/1.MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#25","text":"","title":"2.5 \u5907\u4efd\u6709\u6548\u6027\u68c0\u67e5\u4e0e\u8fc7\u7a0b\u6587\u6863\u5316"},{"location":"mysql/basic/202202/2.MySQL%E5%AE%95%E6%9C%BA%E6%81%A2%E5%A4%8D%E6%B5%81%E7%A8%8B.html","text":"MySQL\u5b95\u673a\u6062\u590d\u6d41\u7a0b \u00b6 \u5f53MySQL\u63d0\u4ea4\u4e8b\u52a1\u7684\u65f6\u5019\uff0c\u5c06\u4f1a\u7ecf\u8fc7\u4ee5\u4e0b\u6d41\u7a0b\uff1a 1. Prepare the transaction in the storage engine (InnoDB) 2. Write the transaction to the binary logs 3. Complete the transaction in the storage engine 4. Return an acknowledgment to the client 1\u3001Server \u5c42\u6545\u969c\u6062\u590d \u00b6 \u76ee\u524d\u5b58\u5728\u5f88\u591a\u79cd\u6570\u636e\u5e93\u5907\u4efd\u65b9\u6cd5\uff0c\u4ece\u5907\u4efd\u7684\u6570\u636e\u6587\u4ef6\u6765\u770b\uff0c\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8fdb\u884c\u5206\u7c7b\uff1a \u4ece\u6587\u4ef6\u5f62\u5f0f\uff1a \u7269\u7406\u5907\u4efd vs \u903b\u8f91\u5907\u4efd \u4ece\u662f\u5426\u9700\u8981\u505c\u673a\uff1a \u70ed\u5907 vs \u6e29\u5907 vs \u51b7\u5907 \u4ece\u662f\u5426\u5b8c\u6574\uff1a \u5168\u91cf\u5907\u4efd vs \u589e\u91cf/\u5dee\u5f02\u5907\u4efd \u4ece\u5907\u4efd\u5bf9\u8c61\u6765\u770b\uff1a \u6570\u636e\u5907\u4efd vs \u65e5\u5fd7\u5907\u4efd 2 InnoDB \u5c42\u6545\u969c\u6062\u590d \u00b6 2.1 \u8868\u7a7a\u95f4\u53d1\u73b0 \u00b6 2.2 \u5e94\u7528redo\u65e5\u5fd7 \u00b6 2.3 \u56de\u6eda\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1 \u00b6 2.4 Change buffer\u5408\u5e76 \u00b6 2.5 \u6e05\u7406\u5df2\u6807\u8bc6\u7684\u5220\u9664\u7684\u8bb0\u5f55 \u00b6","title":"MySQL\u5b95\u673a\u6062\u590d\u6d41\u7a0b"},{"location":"mysql/basic/202202/2.MySQL%E5%AE%95%E6%9C%BA%E6%81%A2%E5%A4%8D%E6%B5%81%E7%A8%8B.html#mysql","text":"\u5f53MySQL\u63d0\u4ea4\u4e8b\u52a1\u7684\u65f6\u5019\uff0c\u5c06\u4f1a\u7ecf\u8fc7\u4ee5\u4e0b\u6d41\u7a0b\uff1a 1. Prepare the transaction in the storage engine (InnoDB) 2. Write the transaction to the binary logs 3. Complete the transaction in the storage engine 4. Return an acknowledgment to the client","title":"MySQL\u5b95\u673a\u6062\u590d\u6d41\u7a0b"},{"location":"mysql/basic/202202/2.MySQL%E5%AE%95%E6%9C%BA%E6%81%A2%E5%A4%8D%E6%B5%81%E7%A8%8B.html#1server","text":"\u76ee\u524d\u5b58\u5728\u5f88\u591a\u79cd\u6570\u636e\u5e93\u5907\u4efd\u65b9\u6cd5\uff0c\u4ece\u5907\u4efd\u7684\u6570\u636e\u6587\u4ef6\u6765\u770b\uff0c\u53ef\u4ee5\u6309\u5982\u4e0b\u65b9\u5f0f\u8fdb\u884c\u5206\u7c7b\uff1a \u4ece\u6587\u4ef6\u5f62\u5f0f\uff1a \u7269\u7406\u5907\u4efd vs \u903b\u8f91\u5907\u4efd \u4ece\u662f\u5426\u9700\u8981\u505c\u673a\uff1a \u70ed\u5907 vs \u6e29\u5907 vs \u51b7\u5907 \u4ece\u662f\u5426\u5b8c\u6574\uff1a \u5168\u91cf\u5907\u4efd vs \u589e\u91cf/\u5dee\u5f02\u5907\u4efd \u4ece\u5907\u4efd\u5bf9\u8c61\u6765\u770b\uff1a \u6570\u636e\u5907\u4efd vs \u65e5\u5fd7\u5907\u4efd","title":"1\u3001Server \u5c42\u6545\u969c\u6062\u590d"},{"location":"mysql/basic/202202/2.MySQL%E5%AE%95%E6%9C%BA%E6%81%A2%E5%A4%8D%E6%B5%81%E7%A8%8B.html#2-innodb","text":"","title":"2 InnoDB \u5c42\u6545\u969c\u6062\u590d"},{"location":"mysql/basic/202202/2.MySQL%E5%AE%95%E6%9C%BA%E6%81%A2%E5%A4%8D%E6%B5%81%E7%A8%8B.html#21","text":"","title":"2.1 \u8868\u7a7a\u95f4\u53d1\u73b0"},{"location":"mysql/basic/202202/2.MySQL%E5%AE%95%E6%9C%BA%E6%81%A2%E5%A4%8D%E6%B5%81%E7%A8%8B.html#22-redo","text":"","title":"2.2 \u5e94\u7528redo\u65e5\u5fd7"},{"location":"mysql/basic/202202/2.MySQL%E5%AE%95%E6%9C%BA%E6%81%A2%E5%A4%8D%E6%B5%81%E7%A8%8B.html#23","text":"","title":"2.3 \u56de\u6eda\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1"},{"location":"mysql/basic/202202/2.MySQL%E5%AE%95%E6%9C%BA%E6%81%A2%E5%A4%8D%E6%B5%81%E7%A8%8B.html#24-change-buffer","text":"","title":"2.4 Change buffer\u5408\u5e76"},{"location":"mysql/basic/202202/2.MySQL%E5%AE%95%E6%9C%BA%E6%81%A2%E5%A4%8D%E6%B5%81%E7%A8%8B.html#25","text":"","title":"2.5 \u6e05\u7406\u5df2\u6807\u8bc6\u7684\u5220\u9664\u7684\u8bb0\u5f55"},{"location":"mysql/ha/index.html","text":"MySQL-\u9ad8\u53ef\u7528\u7bc7 \u00b6 1\u3001MHA\u90e8\u7f72\u5b9e\u8df5 2\u3001\u57fa\u4e8egtid\u7684\u7a7a\u4e8b\u52a1\u6ce8\u5165 3\u3001\u5728\u7ebf\u5207\u6362gtid\u6a21\u5f0f 4\u3001\u91cd\u5efa\u4e0d\u4e00\u81f4\u7684Slave 5\u3001\u65e0\u635f\u534a\u540c\u6b65\u6700\u4f73\u5b9e\u8df5 6\u3001MHA\u5728\u7ebf\u5207\u6362\u4e3b\u8282\u70b9 7\u3001MySQL\u4e3b\u4ece\u90e8\u7f72\u6700\u4f73\u5b9e\u8df5 8\u3001MGR\u90e8\u7f72\u5b9e\u8df5 9\u3001MySQL\u9ad8\u53ef\u7528\u62d3\u6251\u7ba1\u7406\u5de5\u5177\u5bf9\u6bd4 10\u3001MySQ\u5728Github\u7684\u9ad8\u53ef\u7528\u5b9e\u8df5 11\u3001MySQL\u9ad8\u53ef\u7528\u548c\u6545\u969c\u8f6c\u79fb\u7684\u66f4\u591a\u60f3\u6cd5 12\u3001MySQL\u4e3b\u5e93\u670d\u52a1\u53d1\u73b0\u65b9\u5f0f 13\u3001MHA-failover\u6d41\u7a0b 14\u3001MHA-switchover\u6d41\u7a0b 15\u3001\u6570\u636e\u5e93\u6269\u5c55\u6700\u4f73\u5b9e\u8df5 16\u3001\u6570\u636e\u5e93\u6269\u5c55\u6700\u4f73\u5b9e\u8df5-\u7eed 17\u3001MySQL-semi-sync-replication","title":"\u9ad8\u53ef\u7528\u7bc7"},{"location":"mysql/ha/index.html#mysql-","text":"1\u3001MHA\u90e8\u7f72\u5b9e\u8df5 2\u3001\u57fa\u4e8egtid\u7684\u7a7a\u4e8b\u52a1\u6ce8\u5165 3\u3001\u5728\u7ebf\u5207\u6362gtid\u6a21\u5f0f 4\u3001\u91cd\u5efa\u4e0d\u4e00\u81f4\u7684Slave 5\u3001\u65e0\u635f\u534a\u540c\u6b65\u6700\u4f73\u5b9e\u8df5 6\u3001MHA\u5728\u7ebf\u5207\u6362\u4e3b\u8282\u70b9 7\u3001MySQL\u4e3b\u4ece\u90e8\u7f72\u6700\u4f73\u5b9e\u8df5 8\u3001MGR\u90e8\u7f72\u5b9e\u8df5 9\u3001MySQL\u9ad8\u53ef\u7528\u62d3\u6251\u7ba1\u7406\u5de5\u5177\u5bf9\u6bd4 10\u3001MySQ\u5728Github\u7684\u9ad8\u53ef\u7528\u5b9e\u8df5 11\u3001MySQL\u9ad8\u53ef\u7528\u548c\u6545\u969c\u8f6c\u79fb\u7684\u66f4\u591a\u60f3\u6cd5 12\u3001MySQL\u4e3b\u5e93\u670d\u52a1\u53d1\u73b0\u65b9\u5f0f 13\u3001MHA-failover\u6d41\u7a0b 14\u3001MHA-switchover\u6d41\u7a0b 15\u3001\u6570\u636e\u5e93\u6269\u5c55\u6700\u4f73\u5b9e\u8df5 16\u3001\u6570\u636e\u5e93\u6269\u5c55\u6700\u4f73\u5b9e\u8df5-\u7eed 17\u3001MySQL-semi-sync-replication","title":"MySQL-\u9ad8\u53ef\u7528\u7bc7"},{"location":"mysql/ha/202112/index.html","text":"MySQL-\u9ad8\u53ef\u7528\u7bc7 \u00b6 MHA\u90e8\u7f72\u5b9e\u8df5 via the PMM Settings page. \u57fa\u4e8egtid\u7684\u7a7a\u4e8b\u52a1\u6ce8\u5165 via the PMM Settings page.","title":"MySQL-\u9ad8\u53ef\u7528\u7bc7"},{"location":"mysql/ha/202112/index.html#mysql-","text":"MHA\u90e8\u7f72\u5b9e\u8df5 via the PMM Settings page. \u57fa\u4e8egtid\u7684\u7a7a\u4e8b\u52a1\u6ce8\u5165 via the PMM Settings page.","title":"MySQL-\u9ad8\u53ef\u7528\u7bc7"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html","text":"MHA\u642d\u5efa\u6b65\u9aa4 \u00b6 1\u3001MySQL\u4e3b\u4ece\u642d\u5efa \u00b6 1.1 MySQL\u90e8\u7f72\u548c\u4e3b\u4ece\u642d\u5efa(\u7565) \u00b6 1.2 MHA\u7ba1\u7406\u8d26\u53f7\u521b\u5efa \u00b6 CREATE USER 'mha' @ '172.16.3.%' IDENTIFIED BY 'passwd' \uff1b # \u5bc6\u7801\u53ef\u4ee5\u4ece\u5df2\u6709 MHA\u914d\u7f6e\u6587\u4ef6\u5185\u67e5\u770b GRANT ALL PRIVILEGES ON * . * TO 'mha' @ '172.16.3.%' \uff1b 2\u3001MHA\u7ec4\u4ef6\u5b89\u88c5 \u00b6 2.1 \u5b89\u88c5\u5305\u4e0b\u8f7d \u00b6 \u53ef\u4ee5\u8bbf\u95ee MHA\u7684github\u4e3b\u9875 \u4e0b\u8f7d\u6e90\u7801\u81ea\u884c\u7f16\u8bd1\u5b89\u88c5\uff0c\u6b64\u5904\u76f4\u63a5\u4e0b\u8f7d\u7f16\u8bd1\u597d\u7684rpm\u5305,\u9700\u8981\u6ce8\u610f\u5b89\u88c5\u5305\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u7684\u5339\u914d # \u4e0b\u8f7d MHA Manager\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-manager/releases/download/v0.58/mha4mysql-manager-0.58-0.el7.centos.noarch.rpm # \u4e0b\u8f7d MHA Node\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-node/releases/download/v0.58/mha4mysql-node-0.58-0.el7.centos.noarch.rpm 2.2 MHA\u7ec4\u4ef6\u5b89\u88c5 \u00b6 MHA\u7531 MHA-node\u548cMHA-manger\u4e24\u90e8\u5206\u7ec4\u6210\uff0c\u5176\u4e2dMHA-node\u9700\u8981\u90e8\u7f72\u5728\u53c2\u4e0e\u6784\u5efaMHA\u7684\u6bcf\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0cMHA-manger\u53ea\u9700\u8981\u5728\u7ba1\u7406\u5b9e\u4f8b\u4e0a\u90e8\u7f72\u5373\u53ef # \u5728\u9700\u8981\u53c2\u4e0eMHA\u90e8\u7f72\u7684MySQL\u5b9e\u4f8b\u4e0a\u5b89\u88c5\u5bf9\u5e94\u7684\u4f9d\u8d56\u5305\u548cMHA Node yum install perl-DBD-MySQL yum install perl-devel rpm -ivh mha4mysql-node-X.Y-0.noarch. # \u5728MHA\u7ba1\u7406\u8282\u70b9\u4e0a\u5b89\u88c5\u6240\u9700\u4f9d\u8d56\u548cMHA Manager\uff0cMHA Node \u53ea\u662f\u4e00\u4e2a\u53ef\u9009\u9879\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u662f\u591a\u5957MHA\u5171\u7528\u7684 yum install perl-DBD-MySQL yum install perl-devel yum install perl-Config-Tiny yum install perl-Log-Dispatch yum install perl-Parallel-ForkManager rpm -ivh mha4mysql-node-X.Y-0.noarch.rpm rpm -ivh mha4mysql-manager-X.Y-0.noarch.rpm 2.3 MHA\u914d\u7f6e \u00b6 \u5b89\u88c5\u5b8cMHA\u7684\u5404\u4e2a\u7ec4\u4ef6\u540e\uff0c\u9700\u8981\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e: 2.3.1 \u4fee\u6539\u7f51\u5361\u540d \u00b6 # \u4fee\u6539\u89c4\u5219\u6587\u4ef6 cd /etc/udev/rules.d touch 70 -persistent-ipoib.rules less 70 -persistent-ipoib.rules # This is a sample udev rules file that demonstrates how to get udev to # set the name of IPoIB interfaces to whatever you wish. There is a # 16 character limit on network device names though, so don't go too nuts # # Important items to note: ATTR{type}==\"32\" is IPoIB interfaces, and the # ATTR{address} match must start with ?* and only reference the last 8 # bytes of the address or else the address might not match on any given # start of the IPoIB stack # # Note: as of rhel7, udev is case sensitive on the address field match # and all addresses need to be in lower case. # # ACTION==\"add\", SUBSYSTEM==\"net\", DRIVERS==\"?*\", ATTR{type}==\"32\", ATTR{address}==\"?*00:02:c9:03:00:31:78:f2\", NAME=\"mlx4_ib3\" SUBSYSTEM == \"net\" , ACTION == \"add\" , DRIVERS == \"?*\" , ATTR { type }== \"1\" , ATTR { address }== \"00:50:56:af:23:b8\" ,KERNEL == \"ens*\" , NAME = \"bond0\" # \u4fee\u6539ATTR \u4e3a\u76ee\u6807\u7f51\u5361\u7684mac\u5730\u5740\uff0cKERNEL\u4e3a\u5f53\u524d\u7f51\u5361\u540d \uff0cNAME\u4e3a\u9700\u8981\u91cd\u547d\u540d\u7684\u7f51\u5361\u540d\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u53ea\u9700\u8981\u4fee\u6539ATTR\u7684\u503c\u5c31\u884c # \u4fee\u6539\u7f51\u5361\u914d\u7f6e\u6587\u4ef6 cd /etc/sysconfig/network-scripts cp ifcfg-ens160 ifcfg-bond0 vim ifcfg-bond0 HWADDR = 00 :50:56:af:23:b8 NAME = bond0 # \u4eceens160 \u6539\u4e3abond0 PEERDNS = no NM_CONTROLLED = no GATEWAY = 172 .16.31.200 DEVICE = bond0 # \u4eceens160 \u6539\u4e3abond0 ONBOOT = yes USERCTL = no BOOTPROTO = static NETMASK = 255 .255.255.0 IPADDR = 172 .16.31.103 IPV6INIT = yes IPV6_AUTOCONF = yes # \u91cd\u542f\u673a\u5668 reboot 2.3.2 \u5de5\u4f5c\u6587\u4ef6\u5939\u521b\u5efa \u00b6 export mha_app = db6_4_30 #\u547d\u540d\u683c\u5f0f:\u6570\u636e\u5e93\u5b9e\u4f8b\u540d_vip\u7b2c3\u6bb5_vip\u7b2c4\u6bb5 mkdir -p /data/mha_workdir/ ${ mha_app } # \u6839\u636eMHA\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u521b\u5efa\u5bf9\u5e94\u7684\u5e94\u7528\u8def\u5f84\uff0c\u7528\u6765\u4fdd\u5b58\u5bf9\u5e94\u7684\u65e5\u5fd7\u6587\u4ef6\u3001\u914d\u7f6e\u6587\u4ef6\u3001\u5fc3\u8df3\u68c0\u6d4b\u6587\u4ef6\u7b49 2.3.3 MHA\u8282\u70b9\u95f4\u514d\u5bc6\u767b\u5f55 \u00b6 # \u4f9d\u6b21\u5728\u6bcf\u4e2aMySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip # \u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66\uff08\u53ef\u9009\uff0c\u591a\u5957MHA\u5171\u7528\u7ba1\u7406\u8282\u70b9\u7684\u8bdd\uff0c\u8bc1\u4e66\u5df2\u5b58\u5728\uff09 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u4ece\u7ba1\u7406\u8282\u70b9\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip 2.3.4 MHA\u914d\u7f6e\u6587\u4ef6\u521b\u5efa \u00b6 touch /data/mha_workdir/ ${ mha_app } / ${ mha_app } .cnf 2.3.5 MHA\u76f8\u5173\u811a\u672c\u5b9a\u4e49 \u00b6 \u9700\u8981\u5728\u4e0b\u5217\u811a\u672c\u4e2d\u65b0\u589evip\u548c\u7f51\u5361\u7684\u53c2\u6570\uff0c\u4e24\u4e2a\u811a\u672c\u4e2d\uff0c\u4fee\u6539\u65f6\u4e00\u6837\u7684 # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u5b9e\u73b0\u5728\u7ebf\u5207\u6362master\u8282\u70b9 master_ip_online_change # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u6458\u9664vip master_ip_failover 3\u3001MHA\u8fd0\u884c\u72b6\u6001\u786e\u8ba4 \u00b6 \u5728\u4e4b\u524d\u7684\u6240\u6709\u6b65\u9aa4\u51c6\u786e\u65e0\u8bef\u7684\u5b8c\u6210\u540e\uff0c\u53ef\u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u5bf9MHA\u8fdb\u884c\u4e0b\u5217\u68c0\u67e5 3.1 \u514d\u5bc6\u767b\u5f55\u68c0\u67e5 \u00b6 masterha_check_ssh --conf = /data/mha_workdir/ ${ mha_app } / ${ mha_app } .cnf 3.2 \u4e3b\u4ece\u590d\u5236\u68c0\u67e5 \u00b6 masterha_check_repl --conf = /data/mha_workdir/ ${ mha_app } / ${ mha_app } .cnf 4\u3001\u542f\u52a8MHA \u00b6 \u5728\u7b2c3\u6b65\u9aa4\u4e2d\u4e24\u9879\u68c0\u67e5\u90fd\u901a\u8fc7\u4ee5\u540e\uff0c\u53ef\u4ee5\u542f\u52a8MHA\uff0c\u63a8\u8350\u4f7f\u7528screen\u521b\u5efa\u4f1a\u8bdd\uff0c\u7136\u540e\u5728\u91cc\u9762\u8fdb\u884c\u542f\u52a8 # \u8fd0\u884c\u4e0b\u5217\u8bed\u53e5\u521b\u5efa\u5e76\u8fdb\u5165\u8be5\u4f1a\u8bdd\u7a97\u53e3 screen -S ${ mha_app } # \u8fd0\u884c\u4e0b\u5217\u8bed\u53e5\u542f\u52a8MHA\uff0c\u7136\u540e\u76f4\u63a5\u5173\u95ed\u4f1a\u8bdd\u7a97\u53e3 masterha_manager --conf = /data/mha_workdir/ ${ mha_app } / ${ mha_app } .cnf --ignore_fail_on_start --ignore_last_failover >>/data/mha_workdir/ ${ mha_app } / ${ mha_app } .log 2 > & 1 & # \u8fd0\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u68c0\u67e5MHA\u8fd0\u884c\u72b6\u6001,\u8f93\u51fa:${mha_app}is running\u8bf4\u660eMHA\u5df2\u6b63\u5e38\u542f\u52a8 masterha_check_status --conf = /data/mha_workdir/ ${ mha_app } / ${ mha_app } .cnf 5\u3001MHA\u76f8\u5173\u76d1\u63a7\u6dfb\u52a0 \u00b6 5.1 \u4e3b\u673a\u4f4d\u7f6e\u76d1\u63a7 \u00b6 5.2 mha\u8fdb\u7a0b\u76d1\u63a7 \u00b6","title":"MHA\u642d\u5efa\u6b65\u9aa4"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#mha","text":"","title":"MHA\u642d\u5efa\u6b65\u9aa4"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#1mysql","text":"","title":"1\u3001MySQL\u4e3b\u4ece\u642d\u5efa"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#11-mysql","text":"","title":"1.1 MySQL\u90e8\u7f72\u548c\u4e3b\u4ece\u642d\u5efa(\u7565)"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#12-mha","text":"CREATE USER 'mha' @ '172.16.3.%' IDENTIFIED BY 'passwd' \uff1b # \u5bc6\u7801\u53ef\u4ee5\u4ece\u5df2\u6709 MHA\u914d\u7f6e\u6587\u4ef6\u5185\u67e5\u770b GRANT ALL PRIVILEGES ON * . * TO 'mha' @ '172.16.3.%' \uff1b","title":"1.2 MHA\u7ba1\u7406\u8d26\u53f7\u521b\u5efa"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#2mha","text":"","title":"2\u3001MHA\u7ec4\u4ef6\u5b89\u88c5"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#21","text":"\u53ef\u4ee5\u8bbf\u95ee MHA\u7684github\u4e3b\u9875 \u4e0b\u8f7d\u6e90\u7801\u81ea\u884c\u7f16\u8bd1\u5b89\u88c5\uff0c\u6b64\u5904\u76f4\u63a5\u4e0b\u8f7d\u7f16\u8bd1\u597d\u7684rpm\u5305,\u9700\u8981\u6ce8\u610f\u5b89\u88c5\u5305\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u7684\u5339\u914d # \u4e0b\u8f7d MHA Manager\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-manager/releases/download/v0.58/mha4mysql-manager-0.58-0.el7.centos.noarch.rpm # \u4e0b\u8f7d MHA Node\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-node/releases/download/v0.58/mha4mysql-node-0.58-0.el7.centos.noarch.rpm","title":"2.1 \u5b89\u88c5\u5305\u4e0b\u8f7d"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#22-mha","text":"MHA\u7531 MHA-node\u548cMHA-manger\u4e24\u90e8\u5206\u7ec4\u6210\uff0c\u5176\u4e2dMHA-node\u9700\u8981\u90e8\u7f72\u5728\u53c2\u4e0e\u6784\u5efaMHA\u7684\u6bcf\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0cMHA-manger\u53ea\u9700\u8981\u5728\u7ba1\u7406\u5b9e\u4f8b\u4e0a\u90e8\u7f72\u5373\u53ef # \u5728\u9700\u8981\u53c2\u4e0eMHA\u90e8\u7f72\u7684MySQL\u5b9e\u4f8b\u4e0a\u5b89\u88c5\u5bf9\u5e94\u7684\u4f9d\u8d56\u5305\u548cMHA Node yum install perl-DBD-MySQL yum install perl-devel rpm -ivh mha4mysql-node-X.Y-0.noarch. # \u5728MHA\u7ba1\u7406\u8282\u70b9\u4e0a\u5b89\u88c5\u6240\u9700\u4f9d\u8d56\u548cMHA Manager\uff0cMHA Node \u53ea\u662f\u4e00\u4e2a\u53ef\u9009\u9879\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u662f\u591a\u5957MHA\u5171\u7528\u7684 yum install perl-DBD-MySQL yum install perl-devel yum install perl-Config-Tiny yum install perl-Log-Dispatch yum install perl-Parallel-ForkManager rpm -ivh mha4mysql-node-X.Y-0.noarch.rpm rpm -ivh mha4mysql-manager-X.Y-0.noarch.rpm","title":"2.2 MHA\u7ec4\u4ef6\u5b89\u88c5"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#23-mha","text":"\u5b89\u88c5\u5b8cMHA\u7684\u5404\u4e2a\u7ec4\u4ef6\u540e\uff0c\u9700\u8981\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e:","title":"2.3 MHA\u914d\u7f6e"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#231","text":"# \u4fee\u6539\u89c4\u5219\u6587\u4ef6 cd /etc/udev/rules.d touch 70 -persistent-ipoib.rules less 70 -persistent-ipoib.rules # This is a sample udev rules file that demonstrates how to get udev to # set the name of IPoIB interfaces to whatever you wish. There is a # 16 character limit on network device names though, so don't go too nuts # # Important items to note: ATTR{type}==\"32\" is IPoIB interfaces, and the # ATTR{address} match must start with ?* and only reference the last 8 # bytes of the address or else the address might not match on any given # start of the IPoIB stack # # Note: as of rhel7, udev is case sensitive on the address field match # and all addresses need to be in lower case. # # ACTION==\"add\", SUBSYSTEM==\"net\", DRIVERS==\"?*\", ATTR{type}==\"32\", ATTR{address}==\"?*00:02:c9:03:00:31:78:f2\", NAME=\"mlx4_ib3\" SUBSYSTEM == \"net\" , ACTION == \"add\" , DRIVERS == \"?*\" , ATTR { type }== \"1\" , ATTR { address }== \"00:50:56:af:23:b8\" ,KERNEL == \"ens*\" , NAME = \"bond0\" # \u4fee\u6539ATTR \u4e3a\u76ee\u6807\u7f51\u5361\u7684mac\u5730\u5740\uff0cKERNEL\u4e3a\u5f53\u524d\u7f51\u5361\u540d \uff0cNAME\u4e3a\u9700\u8981\u91cd\u547d\u540d\u7684\u7f51\u5361\u540d\u3002\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u53ea\u9700\u8981\u4fee\u6539ATTR\u7684\u503c\u5c31\u884c # \u4fee\u6539\u7f51\u5361\u914d\u7f6e\u6587\u4ef6 cd /etc/sysconfig/network-scripts cp ifcfg-ens160 ifcfg-bond0 vim ifcfg-bond0 HWADDR = 00 :50:56:af:23:b8 NAME = bond0 # \u4eceens160 \u6539\u4e3abond0 PEERDNS = no NM_CONTROLLED = no GATEWAY = 172 .16.31.200 DEVICE = bond0 # \u4eceens160 \u6539\u4e3abond0 ONBOOT = yes USERCTL = no BOOTPROTO = static NETMASK = 255 .255.255.0 IPADDR = 172 .16.31.103 IPV6INIT = yes IPV6_AUTOCONF = yes # \u91cd\u542f\u673a\u5668 reboot","title":"2.3.1 \u4fee\u6539\u7f51\u5361\u540d"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#232","text":"export mha_app = db6_4_30 #\u547d\u540d\u683c\u5f0f:\u6570\u636e\u5e93\u5b9e\u4f8b\u540d_vip\u7b2c3\u6bb5_vip\u7b2c4\u6bb5 mkdir -p /data/mha_workdir/ ${ mha_app } # \u6839\u636eMHA\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u521b\u5efa\u5bf9\u5e94\u7684\u5e94\u7528\u8def\u5f84\uff0c\u7528\u6765\u4fdd\u5b58\u5bf9\u5e94\u7684\u65e5\u5fd7\u6587\u4ef6\u3001\u914d\u7f6e\u6587\u4ef6\u3001\u5fc3\u8df3\u68c0\u6d4b\u6587\u4ef6\u7b49","title":"2.3.2 \u5de5\u4f5c\u6587\u4ef6\u5939\u521b\u5efa"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#233-mha","text":"# \u4f9d\u6b21\u5728\u6bcf\u4e2aMySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip # \u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66\uff08\u53ef\u9009\uff0c\u591a\u5957MHA\u5171\u7528\u7ba1\u7406\u8282\u70b9\u7684\u8bdd\uff0c\u8bc1\u4e66\u5df2\u5b58\u5728\uff09 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u4ece\u7ba1\u7406\u8282\u70b9\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip","title":"2.3.3 MHA\u8282\u70b9\u95f4\u514d\u5bc6\u767b\u5f55"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#234-mha","text":"touch /data/mha_workdir/ ${ mha_app } / ${ mha_app } .cnf","title":"2.3.4 MHA\u914d\u7f6e\u6587\u4ef6\u521b\u5efa"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#235-mha","text":"\u9700\u8981\u5728\u4e0b\u5217\u811a\u672c\u4e2d\u65b0\u589evip\u548c\u7f51\u5361\u7684\u53c2\u6570\uff0c\u4e24\u4e2a\u811a\u672c\u4e2d\uff0c\u4fee\u6539\u65f6\u4e00\u6837\u7684 # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u5b9e\u73b0\u5728\u7ebf\u5207\u6362master\u8282\u70b9 master_ip_online_change # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u6458\u9664vip master_ip_failover","title":"2.3.5 MHA\u76f8\u5173\u811a\u672c\u5b9a\u4e49"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#3mha","text":"\u5728\u4e4b\u524d\u7684\u6240\u6709\u6b65\u9aa4\u51c6\u786e\u65e0\u8bef\u7684\u5b8c\u6210\u540e\uff0c\u53ef\u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u5bf9MHA\u8fdb\u884c\u4e0b\u5217\u68c0\u67e5","title":"3\u3001MHA\u8fd0\u884c\u72b6\u6001\u786e\u8ba4"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#31","text":"masterha_check_ssh --conf = /data/mha_workdir/ ${ mha_app } / ${ mha_app } .cnf","title":"3.1 \u514d\u5bc6\u767b\u5f55\u68c0\u67e5"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#32","text":"masterha_check_repl --conf = /data/mha_workdir/ ${ mha_app } / ${ mha_app } .cnf","title":"3.2 \u4e3b\u4ece\u590d\u5236\u68c0\u67e5"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#4mha","text":"\u5728\u7b2c3\u6b65\u9aa4\u4e2d\u4e24\u9879\u68c0\u67e5\u90fd\u901a\u8fc7\u4ee5\u540e\uff0c\u53ef\u4ee5\u542f\u52a8MHA\uff0c\u63a8\u8350\u4f7f\u7528screen\u521b\u5efa\u4f1a\u8bdd\uff0c\u7136\u540e\u5728\u91cc\u9762\u8fdb\u884c\u542f\u52a8 # \u8fd0\u884c\u4e0b\u5217\u8bed\u53e5\u521b\u5efa\u5e76\u8fdb\u5165\u8be5\u4f1a\u8bdd\u7a97\u53e3 screen -S ${ mha_app } # \u8fd0\u884c\u4e0b\u5217\u8bed\u53e5\u542f\u52a8MHA\uff0c\u7136\u540e\u76f4\u63a5\u5173\u95ed\u4f1a\u8bdd\u7a97\u53e3 masterha_manager --conf = /data/mha_workdir/ ${ mha_app } / ${ mha_app } .cnf --ignore_fail_on_start --ignore_last_failover >>/data/mha_workdir/ ${ mha_app } / ${ mha_app } .log 2 > & 1 & # \u8fd0\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u68c0\u67e5MHA\u8fd0\u884c\u72b6\u6001,\u8f93\u51fa:${mha_app}is running\u8bf4\u660eMHA\u5df2\u6b63\u5e38\u542f\u52a8 masterha_check_status --conf = /data/mha_workdir/ ${ mha_app } / ${ mha_app } .cnf","title":"4\u3001\u542f\u52a8MHA"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#5mha","text":"","title":"5\u3001MHA\u76f8\u5173\u76d1\u63a7\u6dfb\u52a0"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#51","text":"","title":"5.1 \u4e3b\u673a\u4f4d\u7f6e\u76d1\u63a7"},{"location":"mysql/ha/202112/1.MHA%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#52-mha","text":"","title":"5.2 mha\u8fdb\u7a0b\u76d1\u63a7"},{"location":"mysql/ha/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html","text":"\u57fa\u4e8eGTID\u7684\u7a7a\u4e8b\u52a1\u6ce8\u5165 \u00b6 1\u3001gtid\u6982\u5ff5 \u00b6 \u5728MySQL\u5b98\u65b9\u5b9a\u4e49\u4e2d\uff0cGTID\u662f **G**lobal **T**ransaction **ID**entifier (GTID)\u7684\u7f29\u5199\uff0c 2\u3001GTID\u5f02\u5e38\u573a\u666f\u6a21\u62df \u00b6 2.1 GTID\u6b63\u5e38\u65f6 \u00b6 \u53ef\u4ee5\u8bbf\u95ee MHA\u7684github\u4e3b\u9875 \u4e0b\u8f7d\u6e90\u7801\u81ea\u884c\u7f16\u8bd1\u5b89\u88c5\uff0c\u6b64\u5904\u76f4\u63a5\u4e0b\u8f7d\u7f16\u8bd1\u597d\u7684rpm\u5305,\u9700\u8981\u6ce8\u610f\u5b89\u88c5\u5305\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u7684\u5339\u914d # \u4e0b\u8f7d MHA Manager\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-manager/releases/download/v0.58/mha4mysql-manager-0.58-0.el7.centos.noarch.rpm # \u4e0b\u8f7d MHA Node\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-node/releases/download/v0.58/mha4mysql-node-0.58-0.el7.centos.noarch.rpm 2.2 GTID\u6b63\u5e38\u65f6 \u00b6 MHA\u7531 MHA-node\u548cMHA-manger\u4e24\u90e8\u5206\u7ec4\u6210\uff0c\u5176\u4e2dMHA-node\u9700\u8981\u90e8\u7f72\u5728\u53c2\u4e0e\u6784\u5efaMHA\u7684\u6bcf\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0cMHA-manger\u53ea\u9700\u8981\u5728\u7ba1\u7406\u5b9e\u4f8b\u4e0a\u90e8\u7f72\u5373\u53ef # \u5728\u9700\u8981\u53c2\u4e0eMHA\u90e8\u7f72\u7684MySQL\u5b9e\u4f8b\u4e0a\u5b89\u88c5\u5bf9\u5e94\u7684\u4f9d\u8d56\u5305\u548cMHA Node yum install perl-DBD-MySQL yum install perl-devel rpm -ivh mha4mysql-node-X.Y-0.noarch. # \u5728MHA\u7ba1\u7406\u8282\u70b9\u4e0a\u5b89\u88c5\u6240\u9700\u4f9d\u8d56\u548cMHA Manager\uff0cMHA Node \u53ea\u662f\u4e00\u4e2a\u53ef\u9009\u9879\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u662f\u591a\u5957MHA\u5171\u7528\u7684 yum install perl-DBD-MySQL yum install perl-devel yum install perl-Config-Tiny yum install perl-Log-Dispatch yum install perl-Parallel-ForkManager rpm -ivh mha4mysql-node-X.Y-0.noarch.rpm rpm -ivh mha4mysql-manager-X.Y-0.noarch.rpm 2.3 \u4fee\u590dgtid\u5f02\u5e38\u95ee\u9898 \u00b6 \u5b89\u88c5\u5b8cMHA\u7684\u5404\u4e2a\u7ec4\u4ef6\u540e\uff0c\u9700\u8981\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e: 2.3.3 \u68c0\u67e5\u4e3b\u3001\u4ece\u5b9e\u4f8bgitd\u503c \u00b6 # \u4f9d\u6b21\u5728\u6bcf\u4e2aMySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip # \u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66\uff08\u53ef\u9009\uff0c\u591a\u5957MHA\u5171\u7528\u7ba1\u7406\u8282\u70b9\u7684\u8bdd\uff0c\u8bc1\u4e66\u5df2\u5b58\u5728\uff09 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u4ece\u7ba1\u7406\u8282\u70b9\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip 2.3.4 \u62bd\u53d6\u51fa\u591a\u4f59\u7684gtid \u00b6 touch /data/mha_workdir/ ${ mha_app } / ${ mha_app } .cnf 2.3.5 MHA\u76f8\u5173\u811a\u672c\u5b9a\u4e49 \u00b6 \u9700\u8981\u5728\u4e0b\u5217\u811a\u672c\u4e2d\u65b0\u589evip\u548c\u7f51\u5361\u7684\u53c2\u6570\uff0c\u4e24\u4e2a\u811a\u672c\u4e2d\uff0c\u4fee\u6539\u65f6\u4e00\u6837\u7684 # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u5b9e\u73b0\u5728\u7ebf\u5207\u6362master\u8282\u70b9 master_ip_online_change # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u6458\u9664vip master_ip_failover","title":"\u57fa\u4e8eGTID\u7684\u7a7a\u4e8b\u52a1\u6ce8\u5165"},{"location":"mysql/ha/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#gtid","text":"","title":"\u57fa\u4e8eGTID\u7684\u7a7a\u4e8b\u52a1\u6ce8\u5165"},{"location":"mysql/ha/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#1gtid","text":"\u5728MySQL\u5b98\u65b9\u5b9a\u4e49\u4e2d\uff0cGTID\u662f **G**lobal **T**ransaction **ID**entifier (GTID)\u7684\u7f29\u5199\uff0c","title":"1\u3001gtid\u6982\u5ff5"},{"location":"mysql/ha/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#2gtid","text":"","title":"2\u3001GTID\u5f02\u5e38\u573a\u666f\u6a21\u62df"},{"location":"mysql/ha/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#21-gtid","text":"\u53ef\u4ee5\u8bbf\u95ee MHA\u7684github\u4e3b\u9875 \u4e0b\u8f7d\u6e90\u7801\u81ea\u884c\u7f16\u8bd1\u5b89\u88c5\uff0c\u6b64\u5904\u76f4\u63a5\u4e0b\u8f7d\u7f16\u8bd1\u597d\u7684rpm\u5305,\u9700\u8981\u6ce8\u610f\u5b89\u88c5\u5305\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u7684\u5339\u914d # \u4e0b\u8f7d MHA Manager\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-manager/releases/download/v0.58/mha4mysql-manager-0.58-0.el7.centos.noarch.rpm # \u4e0b\u8f7d MHA Node\u7ec4\u4ef6 wget https://github.com/yoshinorim/mha4mysql-node/releases/download/v0.58/mha4mysql-node-0.58-0.el7.centos.noarch.rpm","title":"2.1 GTID\u6b63\u5e38\u65f6"},{"location":"mysql/ha/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#22-gtid","text":"MHA\u7531 MHA-node\u548cMHA-manger\u4e24\u90e8\u5206\u7ec4\u6210\uff0c\u5176\u4e2dMHA-node\u9700\u8981\u90e8\u7f72\u5728\u53c2\u4e0e\u6784\u5efaMHA\u7684\u6bcf\u4e00\u4e2a\u5b9e\u4f8b\u4e0a\uff0cMHA-manger\u53ea\u9700\u8981\u5728\u7ba1\u7406\u5b9e\u4f8b\u4e0a\u90e8\u7f72\u5373\u53ef # \u5728\u9700\u8981\u53c2\u4e0eMHA\u90e8\u7f72\u7684MySQL\u5b9e\u4f8b\u4e0a\u5b89\u88c5\u5bf9\u5e94\u7684\u4f9d\u8d56\u5305\u548cMHA Node yum install perl-DBD-MySQL yum install perl-devel rpm -ivh mha4mysql-node-X.Y-0.noarch. # \u5728MHA\u7ba1\u7406\u8282\u70b9\u4e0a\u5b89\u88c5\u6240\u9700\u4f9d\u8d56\u548cMHA Manager\uff0cMHA Node \u53ea\u662f\u4e00\u4e2a\u53ef\u9009\u9879\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u662f\u591a\u5957MHA\u5171\u7528\u7684 yum install perl-DBD-MySQL yum install perl-devel yum install perl-Config-Tiny yum install perl-Log-Dispatch yum install perl-Parallel-ForkManager rpm -ivh mha4mysql-node-X.Y-0.noarch.rpm rpm -ivh mha4mysql-manager-X.Y-0.noarch.rpm","title":"2.2 GTID\u6b63\u5e38\u65f6"},{"location":"mysql/ha/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#23-gtid","text":"\u5b89\u88c5\u5b8cMHA\u7684\u5404\u4e2a\u7ec4\u4ef6\u540e\uff0c\u9700\u8981\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e:","title":"2.3 \u4fee\u590dgtid\u5f02\u5e38\u95ee\u9898"},{"location":"mysql/ha/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#233-gitd","text":"# \u4f9d\u6b21\u5728\u6bcf\u4e2aMySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip # \u5728\u7ba1\u7406\u8282\u70b9\u4e0a\u6267\u884c\u4e0b\u5217\u64cd\u4f5c # \u751f\u6210\u8bc1\u4e66\uff08\u53ef\u9009\uff0c\u591a\u5957MHA\u5171\u7528\u7ba1\u7406\u8282\u70b9\u7684\u8bdd\uff0c\u8bc1\u4e66\u5df2\u5b58\u5728\uff09 ssh-keygen -t rsa # \u5c06\u8bc1\u4e66\u4ece\u7ba1\u7406\u8282\u70b9\u53d1\u9001\u5230\u5176\u4ed6MySQL\u5b9e\u4f8b ssh-copy-id -i /root/.ssh/id_rsa.pub user@target_ip","title":"2.3.3 \u68c0\u67e5\u4e3b\u3001\u4ece\u5b9e\u4f8bgitd\u503c"},{"location":"mysql/ha/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#234-gtid","text":"touch /data/mha_workdir/ ${ mha_app } / ${ mha_app } .cnf","title":"2.3.4 \u62bd\u53d6\u51fa\u591a\u4f59\u7684gtid"},{"location":"mysql/ha/202112/2.%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E7%A9%BA%E4%BA%8B%E5%8A%A1%E6%B3%A8%E5%85%A5.html#235-mha","text":"\u9700\u8981\u5728\u4e0b\u5217\u811a\u672c\u4e2d\u65b0\u589evip\u548c\u7f51\u5361\u7684\u53c2\u6570\uff0c\u4e24\u4e2a\u811a\u672c\u4e2d\uff0c\u4fee\u6539\u65f6\u4e00\u6837\u7684 # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u5b9e\u73b0\u5728\u7ebf\u5207\u6362master\u8282\u70b9 master_ip_online_change # \u4fee\u6539\u4e0b\u5217\u811a\u672c\u6458\u9664vip master_ip_failover","title":"2.3.5 MHA\u76f8\u5173\u811a\u672c\u5b9a\u4e49"},{"location":"mysql/ha/202201/index.html","text":"MySQL\u76f8\u5173 \u00b6 202112 via the PMM Settings page. 202201 PMM Server via the user interface.","title":"MySQL\u76f8\u5173"},{"location":"mysql/ha/202201/index.html#mysql","text":"202112 via the PMM Settings page. 202201 PMM Server via the user interface.","title":"MySQL\u76f8\u5173"},{"location":"mysql/ha/202201/1.%E5%9C%A8%E7%BA%BF%E5%88%87%E6%8D%A2gtid%E6%A8%A1%E5%BC%8F.html","text":"\u5728\u7ebf\u5207\u6362gtid\u6a21\u5f0f \u00b6 MySQL\u57285.6\u7248\u672c\u4e4b\u540e\u63a8\u51fa\u7684gtid\u7279\u6027\uff0c\u53ef\u4ee5\u6709\u6548\u7b80\u5316\u4e3b\u4ece\u90e8\u7f72\u3001\u548c\u5207\u6362\u7684\u6d41\u7a0b\uff0c\u6b64\u535a\u5ba2\u5206\u4eab\u5c06MySQL\u4e3b\u4ece\u4ece\u4f20\u7edf\u7684(binlog_file,position) \u7684\u65b9\u5f0f\u5207\u6362\u5230\u57fa\u4e8egtid\u7684\u590d\u5236\u6a21\u5f0f\uff0c\u5728MySQL5.7.6\u4e4b\u540e\uff0c\u53ef\u4ee5\u5728\u7ebf\u5207\u6362gtid\u6a21\u5f0f 1\u3001\u91cd\u8981\u6982\u5ff5 \u00b6 \u5728\u6b63\u5f0f\u5207\u6362\u524d\uff0c\u4ee5\u4e0b\u6982\u5ff5\u975e\u5e38\u91cd\u8981\uff0c\u9700\u8981\u63d0\u524d\u719f\u6089\uff1a 1)\u3001\u4e8b\u52a1\u7c7b\u578b GTID transactions : \u4f7f\u7528server_uuid:trx_id\u7684\u65b9\u5f0f\u6765\u6807\u8bc6\u6bcf\u4e00\u4e2a\u4e8b\u52a1\uff0c\u5728binlog/relaylog \u91cc\u9762\u767b\u8bb0\u65f6\uff0c\u6bcf\u4e2aGTID \u4e8b\u52a1\u4e4b\u524d\u4f1a\u6709\u4e00\u4e2a Gtid_log_event\u6765\u8bb0\u5f55\u5bf9\u5e94\u7684\u5143\u6570\u636e\uff1bGTID\u4e8b\u52a1\u53ef\u4ee5\u4f7f\u7528 gtid\u6216\u8005(binlog_file,pos)\u6765\u8fdb\u884c\u5b9a\u4f4d Anonymous transactions : \u4e0d\u4f7f\u7528gtid\u6765\u6807\u8bc6\u4e8b\u52a1\uff0c\u5728binlog/relaylog\u91cc\u9762\u8bb0\u5f55\u533f\u540d\u4e8b\u52a1\u65f6\uff0c\u4f1a\u5728 \u5bf9\u5e94\u4e8b\u52a1\u4e4b\u524d\u901a\u8fc7Anonymous_gtid_log_event\u6765\u63d0\u4f9b\u5bf9\u5e94\u7684\u5143\u6570\u636e\uff1b\u533f\u540d\u4e8b\u52a1\u53ea\u80fd\u4f7f\u7528(binlog_file,pos)\u6765 \u8fdb\u884c\u5b9a\u4f4d 2)\u3001gtid_mode\u7684\u53ef\u9009\u503c\u5305\u542b\u4ee5\u4e0b\u56db\u4e2a\uff0c\u5728\u5207\u6362\u7684\u65f6\u5019\uff0c\u4e0d\u80fd\u8df3\u8fc7\u5176\u4e2d\u4e00\u4e2a\u6a21\u5f0f\uff1a OFF : \u53ea\u80fd\u590d\u5236\u533f\u540d\u4e8b\u52a1 OFF_PERMISSIVE : \u53ef\u4ee5\u590d\u5236GTID\u4e8b\u52a1\u548c\u533f\u540d\u4e8b\u52a1\uff0c\u4f46\u65b0\u589e\u7684\u4e8b\u52a1\u662f\u533f\u540d\u4e8b\u52a1 ON_PERMISSIVE : \u53ef\u4ee5\u590d\u5236GTID\u4e8b\u52a1\u548c\u533f\u540d\u4e8b\u52a1\uff0c\u4f46\u65b0\u589e\u7684\u4e8b\u52a1\u662fGTID\u4e8b\u52a1 ON : \u53ea\u80fd\u590d\u5236GTID\u4e8b\u52a1 gtid\u6a21\u5f0f\u5728\u542f\u7528\u65f6\uff0c\u6309\u5982\u4e0b\u987a\u5e8f\uff1aOFF \u2192 OFF_PERMISSIVE \u2192 ON_PERMISSIVE \u2192 ON gtid\u6a21\u5f0f\u5728\u5173\u95ed\u65f6\uff0c\u6309\u5982\u4e0b\u987a\u5e8f\uff1aON \u2192 ON_PERMISSIVE \u2192 OFF_PERMISSIVE \u2192 OFF 3)\u3001\u4e3a\u4e86\u786e\u4fdd\u5728\u7ebf\u542f\u7528GTID\u6210\u529f\uff0c\u9700\u8981\u786e\u4fdd\u4ee5\u4e0b\u4e24\u4e2a\u4e8b\u9879\uff1a \u5728\u4e3b\u4ece\u62d3\u6251\u91cc\u9762\u7684\u6240\u6709MySQL\u5b9e\u4f8b\u90fd\u662fMySQL5.7.6\u6216\u8005\u4e4b\u540e\u7684\u7248\u672c \u5728\u4e3b\u4ece\u62d3\u6251\u91cc\u9762\u7684\u6240\u6709MySQL\u5b9e\u4f8b\u7684**gtid_mode=off** 2\u3001\u6574\u4f53\u7684\u5207\u6362\u6d41\u7a0b\u5982\u4e0b\uff1a \u00b6 1)\u3001\u5728\u6bcf\u4e2a\u53c2\u4e0e\u5207\u6362\u7684MySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5,\u5b9e\u4f8b\u65e0\u5148\u540e,\u7b49\u5230\u6240\u6709\u5b9e\u4f8b\u7684\u9519\u8bef\u65e5\u5fd7\u6ca1\u6709warnning\u544a\u8b66\u65f6\uff0c\u8fdb\u5165\u4e0b\u4e00\u6b65: mysql> SET @@GLOBAL.ENFORCE_GTID_CONSISTENCY = WARN ; 2)\u3001\u5728\u6bcf\u4e2a\u53c2\u4e0e\u5207\u6362\u7684MySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u5148\u4e3b\u540e\u4ece: mysql> SET @@GLOBAL.ENFORCE_GTID_CONSISTENCY = ON ; 3)\u3001\u5728\u6bcf\u4e2a\u53c2\u4e0e\u5207\u6362\u7684MySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u5b9e\u4f8b\u65e0\u5148\u540e,\u4f46\u5728\u8fdb\u884c\u4e0b\u4e00\u6b65\u64cd\u4f5c\u4e4b\u524d\uff0c\u9700\u8981\u786e\u4fdd\u6240\u6709MySQL\u5b9e\u4f8b\u90fd\u5df2\u6267\u884c\u5b8c: mysql> SET @@GLOBAL.GTID_MODE = OFF_PERMISSIVE ; 4)\u3001\u5728\u6bcf\u4e2a\u53c2\u4e0e\u5207\u6362\u7684MySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u5b9e\u4f8b\u65e0\u5148\u540e: mysql> SET @@GLOBAL.GTID_MODE = ON_PERMISSIVE ; 5)\u3001\u5728\u6bcf\u4e2a\u53c2\u4e0e\u5207\u6362\u7684MySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u8fd0\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u67e5\u770b\u5bf9\u5e94\u7684\u503c\u662f\u5426\u4e3a0\uff1a mysql> show global status like 'ONGOING_ANONYMOUS_TRANSACTION_COUNT' ; 6)\u3001\u5728\u4e3b\u5e93\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u8f6c\u50a8binlog mysql> flsuh logs ; 7)\u3001\u5728\u6bcf\u4e2a\u53c2\u4e0e\u5207\u6362\u7684MySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u5207\u6362\u5230gtid\u6a21\u5f0f, \u5148\u4e3b\u540e\u4ece mysql> SET @@GLOBAL.GTID_MODE = ON ; 9)\u3001\u5728\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u4fee\u6539/etc/my.cnf,\u65b0\u589e\u6216\u4fee\u6539\u4e0b\u5217\u914d\u7f6e\u9879 gtid_mode = ON enforce_gtid_consistency = ON transaction_write_set_extraction = XXHASH64 10)\u3001\u5728slave\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u4f7f\u7528MASTER_AUTO_POSITION=1 \u66ff\u4ee3\u3010binlog_file,position\u3011 mysql> stop slave ; mysql> CHANGE MASTER TO MASTER_HOST = '192.168.32.102' ,MASTER_USER = 'repl' ,MASTER_PASSWORD = 'Repl_Pass_321' ,MASTER_AUTO_POSITION = 1 ; mysql> start slave ;","title":"1.\u5728\u7ebf\u5207\u6362gtid\u6a21\u5f0f"},{"location":"mysql/ha/202201/1.%E5%9C%A8%E7%BA%BF%E5%88%87%E6%8D%A2gtid%E6%A8%A1%E5%BC%8F.html#gtid","text":"MySQL\u57285.6\u7248\u672c\u4e4b\u540e\u63a8\u51fa\u7684gtid\u7279\u6027\uff0c\u53ef\u4ee5\u6709\u6548\u7b80\u5316\u4e3b\u4ece\u90e8\u7f72\u3001\u548c\u5207\u6362\u7684\u6d41\u7a0b\uff0c\u6b64\u535a\u5ba2\u5206\u4eab\u5c06MySQL\u4e3b\u4ece\u4ece\u4f20\u7edf\u7684(binlog_file,position) \u7684\u65b9\u5f0f\u5207\u6362\u5230\u57fa\u4e8egtid\u7684\u590d\u5236\u6a21\u5f0f\uff0c\u5728MySQL5.7.6\u4e4b\u540e\uff0c\u53ef\u4ee5\u5728\u7ebf\u5207\u6362gtid\u6a21\u5f0f","title":"\u5728\u7ebf\u5207\u6362gtid\u6a21\u5f0f"},{"location":"mysql/ha/202201/1.%E5%9C%A8%E7%BA%BF%E5%88%87%E6%8D%A2gtid%E6%A8%A1%E5%BC%8F.html#1","text":"\u5728\u6b63\u5f0f\u5207\u6362\u524d\uff0c\u4ee5\u4e0b\u6982\u5ff5\u975e\u5e38\u91cd\u8981\uff0c\u9700\u8981\u63d0\u524d\u719f\u6089\uff1a 1)\u3001\u4e8b\u52a1\u7c7b\u578b GTID transactions : \u4f7f\u7528server_uuid:trx_id\u7684\u65b9\u5f0f\u6765\u6807\u8bc6\u6bcf\u4e00\u4e2a\u4e8b\u52a1\uff0c\u5728binlog/relaylog \u91cc\u9762\u767b\u8bb0\u65f6\uff0c\u6bcf\u4e2aGTID \u4e8b\u52a1\u4e4b\u524d\u4f1a\u6709\u4e00\u4e2a Gtid_log_event\u6765\u8bb0\u5f55\u5bf9\u5e94\u7684\u5143\u6570\u636e\uff1bGTID\u4e8b\u52a1\u53ef\u4ee5\u4f7f\u7528 gtid\u6216\u8005(binlog_file,pos)\u6765\u8fdb\u884c\u5b9a\u4f4d Anonymous transactions : \u4e0d\u4f7f\u7528gtid\u6765\u6807\u8bc6\u4e8b\u52a1\uff0c\u5728binlog/relaylog\u91cc\u9762\u8bb0\u5f55\u533f\u540d\u4e8b\u52a1\u65f6\uff0c\u4f1a\u5728 \u5bf9\u5e94\u4e8b\u52a1\u4e4b\u524d\u901a\u8fc7Anonymous_gtid_log_event\u6765\u63d0\u4f9b\u5bf9\u5e94\u7684\u5143\u6570\u636e\uff1b\u533f\u540d\u4e8b\u52a1\u53ea\u80fd\u4f7f\u7528(binlog_file,pos)\u6765 \u8fdb\u884c\u5b9a\u4f4d 2)\u3001gtid_mode\u7684\u53ef\u9009\u503c\u5305\u542b\u4ee5\u4e0b\u56db\u4e2a\uff0c\u5728\u5207\u6362\u7684\u65f6\u5019\uff0c\u4e0d\u80fd\u8df3\u8fc7\u5176\u4e2d\u4e00\u4e2a\u6a21\u5f0f\uff1a OFF : \u53ea\u80fd\u590d\u5236\u533f\u540d\u4e8b\u52a1 OFF_PERMISSIVE : \u53ef\u4ee5\u590d\u5236GTID\u4e8b\u52a1\u548c\u533f\u540d\u4e8b\u52a1\uff0c\u4f46\u65b0\u589e\u7684\u4e8b\u52a1\u662f\u533f\u540d\u4e8b\u52a1 ON_PERMISSIVE : \u53ef\u4ee5\u590d\u5236GTID\u4e8b\u52a1\u548c\u533f\u540d\u4e8b\u52a1\uff0c\u4f46\u65b0\u589e\u7684\u4e8b\u52a1\u662fGTID\u4e8b\u52a1 ON : \u53ea\u80fd\u590d\u5236GTID\u4e8b\u52a1 gtid\u6a21\u5f0f\u5728\u542f\u7528\u65f6\uff0c\u6309\u5982\u4e0b\u987a\u5e8f\uff1aOFF \u2192 OFF_PERMISSIVE \u2192 ON_PERMISSIVE \u2192 ON gtid\u6a21\u5f0f\u5728\u5173\u95ed\u65f6\uff0c\u6309\u5982\u4e0b\u987a\u5e8f\uff1aON \u2192 ON_PERMISSIVE \u2192 OFF_PERMISSIVE \u2192 OFF 3)\u3001\u4e3a\u4e86\u786e\u4fdd\u5728\u7ebf\u542f\u7528GTID\u6210\u529f\uff0c\u9700\u8981\u786e\u4fdd\u4ee5\u4e0b\u4e24\u4e2a\u4e8b\u9879\uff1a \u5728\u4e3b\u4ece\u62d3\u6251\u91cc\u9762\u7684\u6240\u6709MySQL\u5b9e\u4f8b\u90fd\u662fMySQL5.7.6\u6216\u8005\u4e4b\u540e\u7684\u7248\u672c \u5728\u4e3b\u4ece\u62d3\u6251\u91cc\u9762\u7684\u6240\u6709MySQL\u5b9e\u4f8b\u7684**gtid_mode=off**","title":"1\u3001\u91cd\u8981\u6982\u5ff5"},{"location":"mysql/ha/202201/1.%E5%9C%A8%E7%BA%BF%E5%88%87%E6%8D%A2gtid%E6%A8%A1%E5%BC%8F.html#2","text":"1)\u3001\u5728\u6bcf\u4e2a\u53c2\u4e0e\u5207\u6362\u7684MySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5,\u5b9e\u4f8b\u65e0\u5148\u540e,\u7b49\u5230\u6240\u6709\u5b9e\u4f8b\u7684\u9519\u8bef\u65e5\u5fd7\u6ca1\u6709warnning\u544a\u8b66\u65f6\uff0c\u8fdb\u5165\u4e0b\u4e00\u6b65: mysql> SET @@GLOBAL.ENFORCE_GTID_CONSISTENCY = WARN ; 2)\u3001\u5728\u6bcf\u4e2a\u53c2\u4e0e\u5207\u6362\u7684MySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u5148\u4e3b\u540e\u4ece: mysql> SET @@GLOBAL.ENFORCE_GTID_CONSISTENCY = ON ; 3)\u3001\u5728\u6bcf\u4e2a\u53c2\u4e0e\u5207\u6362\u7684MySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u5b9e\u4f8b\u65e0\u5148\u540e,\u4f46\u5728\u8fdb\u884c\u4e0b\u4e00\u6b65\u64cd\u4f5c\u4e4b\u524d\uff0c\u9700\u8981\u786e\u4fdd\u6240\u6709MySQL\u5b9e\u4f8b\u90fd\u5df2\u6267\u884c\u5b8c: mysql> SET @@GLOBAL.GTID_MODE = OFF_PERMISSIVE ; 4)\u3001\u5728\u6bcf\u4e2a\u53c2\u4e0e\u5207\u6362\u7684MySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u5b9e\u4f8b\u65e0\u5148\u540e: mysql> SET @@GLOBAL.GTID_MODE = ON_PERMISSIVE ; 5)\u3001\u5728\u6bcf\u4e2a\u53c2\u4e0e\u5207\u6362\u7684MySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u8fd0\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u67e5\u770b\u5bf9\u5e94\u7684\u503c\u662f\u5426\u4e3a0\uff1a mysql> show global status like 'ONGOING_ANONYMOUS_TRANSACTION_COUNT' ; 6)\u3001\u5728\u4e3b\u5e93\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u8f6c\u50a8binlog mysql> flsuh logs ; 7)\u3001\u5728\u6bcf\u4e2a\u53c2\u4e0e\u5207\u6362\u7684MySQL\u5b9e\u4f8b\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u5207\u6362\u5230gtid\u6a21\u5f0f, \u5148\u4e3b\u540e\u4ece mysql> SET @@GLOBAL.GTID_MODE = ON ; 9)\u3001\u5728\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u4fee\u6539/etc/my.cnf,\u65b0\u589e\u6216\u4fee\u6539\u4e0b\u5217\u914d\u7f6e\u9879 gtid_mode = ON enforce_gtid_consistency = ON transaction_write_set_extraction = XXHASH64 10)\u3001\u5728slave\u4e0a\u6267\u884c\u4e0b\u5217\u8bed\u53e5\uff0c\u4f7f\u7528MASTER_AUTO_POSITION=1 \u66ff\u4ee3\u3010binlog_file,position\u3011 mysql> stop slave ; mysql> CHANGE MASTER TO MASTER_HOST = '192.168.32.102' ,MASTER_USER = 'repl' ,MASTER_PASSWORD = 'Repl_Pass_321' ,MASTER_AUTO_POSITION = 1 ; mysql> start slave ;","title":"2\u3001\u6574\u4f53\u7684\u5207\u6362\u6d41\u7a0b\u5982\u4e0b\uff1a"},{"location":"mysql/ha/202201/10.MySQL%E4%B8%BB%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E6%96%B9%E5%BC%8F.html","text":"MySQL\u4e3b\u5e93\u670d\u52a1\u53d1\u73b0\u65b9\u5f0f \u00b6 MySQL\u5728\u90e8\u7f72\u9ad8\u53ef\u7528\u67b6\u6784\u65f6\uff0c\u5e94\u7528\u9700\u8981\u5148\u83b7\u53d6\u5230\u4e3b\u5e93\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u7136\u540e\u5728\u53d1\u8d77\u8fde\u63a5\u3002\u76ee\u524d\u5e38\u89c1\u7684\u65b9\u5f0f\u6709\u5982\u4e0b\u51e0\u79cd\uff0c\u5404\u6709\u4f18\u7f3a\u70b9\u3002\u9488\u5bf9\u6ca1\u6709\u505a \u66b4\u9732\u4e3b\u5e93\u7684\u65b9\u5f0f\uff0c\u540e\u7eed\u5c06\u7528\u4e13\u95e8\u7684\u535a\u5ba2\u6765\u8fdb\u884c\u5206\u4eab\u3002\u6b64\u7cfb\u5217\u535a\u5ba2\u6839\u636eShlomi Noach\u7684\u535a\u6587\u8fdb\u884c\u6574\u7406 1\u3001DNS \u00b6 \u5e94\u7528\u7a0b\u5e8f\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u7684\u57df\u540d\u53bbDNS\u91cc\u9762\u89e3\u6790\uff0c\u7136\u540e\u901a\u8fc7\u89e3\u6790\u4e4b\u540e\u7684IP\u5730\u5740\u53bb\u8fde\u63a5\u6570\u636e\u5e93\u3002\u6bd4\u5982\u5e94\u7528\u901a\u8fc7 cluster1.example.com\u6765\u8fde\u63a5\u5230cluster1\u96c6\u7fa4\uff0c\u901a\u8fc7cluster2.example.com\u6765\u8fde\u63a5\u5230\u901a\u8fc7cluster2\u3002\u5728\u53d1\u751f\u6545\u969c\u8f6c\u79fb\u6216\u8005 \u4e3b\u5e93 \u89d2\u8272\u53d1\u5c55\u5207\u6362\u4ee5\u540e\uff0c\u901a\u8fc7\u4fee\u6539DNS\u6765\u5b9e\u73b0\u6d41\u91cf\u8def\u7531\u3002 2\u3001VIP & DNS \u00b6 \u4e0e\u4e0a\u4e00\u79cd\u65b9\u6cd5\u7c7b\u578b\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u7684DNS\u89e3\u6790\u5f97\u5230\u7684\u662f\u4e00\u4e2a\u6d6e\u52a8IP\u5730\u5740\uff0c\u8fd9\u4e2a\u5730\u5740\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u6570\u636e\u5e93\u5b9e\u4f8b\u95f4\u6f02\u79fb\u3002\u9664\u4e86vip\u4e4b\u5916\uff0c\u5728\u540c\u4e00\u4e2a\u62d3\u6251 \u91cc\u9762\u7684\u6bcf\u4e00\u4e2aMySQL\u90fd\u6709\u81ea\u5df1\u7684\u7269\u7406IP\u3002\u5728\u6545\u969c\u8f6c\u79fb\u6216\u8005\u6709\u8ba1\u5212\u7684\u5207\u6362\u65f6\uff0c\u53ea\u9700\u8981\u79fb\u52a8vip\u5373\u53ef\uff0c\u4e0d\u9700\u8981\u518d\u53bb\u4fee\u6539DNS\u3002 3\u3001APP & \u670d\u52a1\u53d1\u73b0 \u00b6 4\u3001Proxy \u00b6 5\u3001Proxy & \u670d\u52a1\u53d1\u73b0 \u00b6 6\u3001\u5176\u4ed6\u65b9\u6cd5 \u00b6","title":"MySQL\u4e3b\u5e93\u670d\u52a1\u53d1\u73b0\u65b9\u5f0f"},{"location":"mysql/ha/202201/10.MySQL%E4%B8%BB%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E6%96%B9%E5%BC%8F.html#mysql","text":"MySQL\u5728\u90e8\u7f72\u9ad8\u53ef\u7528\u67b6\u6784\u65f6\uff0c\u5e94\u7528\u9700\u8981\u5148\u83b7\u53d6\u5230\u4e3b\u5e93\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u7136\u540e\u5728\u53d1\u8d77\u8fde\u63a5\u3002\u76ee\u524d\u5e38\u89c1\u7684\u65b9\u5f0f\u6709\u5982\u4e0b\u51e0\u79cd\uff0c\u5404\u6709\u4f18\u7f3a\u70b9\u3002\u9488\u5bf9\u6ca1\u6709\u505a \u66b4\u9732\u4e3b\u5e93\u7684\u65b9\u5f0f\uff0c\u540e\u7eed\u5c06\u7528\u4e13\u95e8\u7684\u535a\u5ba2\u6765\u8fdb\u884c\u5206\u4eab\u3002\u6b64\u7cfb\u5217\u535a\u5ba2\u6839\u636eShlomi Noach\u7684\u535a\u6587\u8fdb\u884c\u6574\u7406","title":"MySQL\u4e3b\u5e93\u670d\u52a1\u53d1\u73b0\u65b9\u5f0f"},{"location":"mysql/ha/202201/10.MySQL%E4%B8%BB%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E6%96%B9%E5%BC%8F.html#1dns","text":"\u5e94\u7528\u7a0b\u5e8f\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u7684\u57df\u540d\u53bbDNS\u91cc\u9762\u89e3\u6790\uff0c\u7136\u540e\u901a\u8fc7\u89e3\u6790\u4e4b\u540e\u7684IP\u5730\u5740\u53bb\u8fde\u63a5\u6570\u636e\u5e93\u3002\u6bd4\u5982\u5e94\u7528\u901a\u8fc7 cluster1.example.com\u6765\u8fde\u63a5\u5230cluster1\u96c6\u7fa4\uff0c\u901a\u8fc7cluster2.example.com\u6765\u8fde\u63a5\u5230\u901a\u8fc7cluster2\u3002\u5728\u53d1\u751f\u6545\u969c\u8f6c\u79fb\u6216\u8005 \u4e3b\u5e93 \u89d2\u8272\u53d1\u5c55\u5207\u6362\u4ee5\u540e\uff0c\u901a\u8fc7\u4fee\u6539DNS\u6765\u5b9e\u73b0\u6d41\u91cf\u8def\u7531\u3002","title":"1\u3001DNS"},{"location":"mysql/ha/202201/10.MySQL%E4%B8%BB%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E6%96%B9%E5%BC%8F.html#2vip-dns","text":"\u4e0e\u4e0a\u4e00\u79cd\u65b9\u6cd5\u7c7b\u578b\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u7684DNS\u89e3\u6790\u5f97\u5230\u7684\u662f\u4e00\u4e2a\u6d6e\u52a8IP\u5730\u5740\uff0c\u8fd9\u4e2a\u5730\u5740\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u6570\u636e\u5e93\u5b9e\u4f8b\u95f4\u6f02\u79fb\u3002\u9664\u4e86vip\u4e4b\u5916\uff0c\u5728\u540c\u4e00\u4e2a\u62d3\u6251 \u91cc\u9762\u7684\u6bcf\u4e00\u4e2aMySQL\u90fd\u6709\u81ea\u5df1\u7684\u7269\u7406IP\u3002\u5728\u6545\u969c\u8f6c\u79fb\u6216\u8005\u6709\u8ba1\u5212\u7684\u5207\u6362\u65f6\uff0c\u53ea\u9700\u8981\u79fb\u52a8vip\u5373\u53ef\uff0c\u4e0d\u9700\u8981\u518d\u53bb\u4fee\u6539DNS\u3002","title":"2\u3001VIP &amp; DNS"},{"location":"mysql/ha/202201/10.MySQL%E4%B8%BB%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E6%96%B9%E5%BC%8F.html#3app","text":"","title":"3\u3001APP &amp; \u670d\u52a1\u53d1\u73b0"},{"location":"mysql/ha/202201/10.MySQL%E4%B8%BB%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E6%96%B9%E5%BC%8F.html#4proxy","text":"","title":"4\u3001Proxy"},{"location":"mysql/ha/202201/10.MySQL%E4%B8%BB%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E6%96%B9%E5%BC%8F.html#5proxy","text":"","title":"5\u3001Proxy &amp; \u670d\u52a1\u53d1\u73b0"},{"location":"mysql/ha/202201/10.MySQL%E4%B8%BB%E5%BA%93%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E6%96%B9%E5%BC%8F.html#6","text":"","title":"6\u3001\u5176\u4ed6\u65b9\u6cd5"},{"location":"mysql/ha/202201/2.%E9%87%8D%E5%BB%BA%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84Slave.html","text":"MySQL\u5907\u5e93\u91cd\u5efa\u64cd\u4f5c\u6b65\u9aa4 \u00b6 MySQL\u4ece\u5e93\u53ef\u80fd\u4f1a\u56e0\u4e3a\u5f88\u591a\u539f\u56e0\u5bfc\u81f4\u4e3b\u4ece\u4e0d\u4e00\u81f4,\u6211\u4eec\u53ef\u4ee5\u5c06\u4ece\u5e93\u8bbe\u7f6e\u4e3aread_only\u6216\u8005super_read_only,\u5e76\u4e14\u4f7f\u7528RBR\u6765\u907f\u514d\u5728\u4ece\u5e93\u6267\u884c\u66f4\u65b0\u5bfc\u81f4\u7684\u4e3b\u4ece\u4e0d\u4e00\u81f4\uff0c\u4f46\u8fd9 \u4e9b\u9009\u9879\u4e5f\u65e0\u6cd5\u5b8c\u5168\u907f\u514d\u4e3b\u4ece\u4e0d\u4e00\u81f4\u3002\u5f53\u4e3b\u4ece\u4e0d\u4e00\u81f4\u65e0\u6cd5\u901a\u8fc7\u5e38\u89c4\u65b9\u6cd5\u4fee\u590d\u65f6\uff0c\u6211\u4eec\u53ea\u80fd\u901a\u8fc7\u91cd\u5efaSlave\u7684\u65b9\u5f0f\u6765\u4fee\u590d\u4e3b\u4ece\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002 \u4e3a\u4e86\u91cd\u5efaSlave\uff0c\u9700\u8981\u6709\u4e24\u65b9\u9762\u7684\u4fe1\u606f\u3002\u9996\u5148\uff0c\u9700\u8981\u6709\u4e00\u4e2a\u5904\u4e8e\u4e00\u81f4\u6027\u7684\u5907\u4efd\u96c6\uff1b\u5176\u6b21\uff0c\u4e3a\u4e86\u91cd\u5efa\u4e0e\u539f\u4e3b\u7684\u4e3b\u4ece\u5173\u7cfb\uff0c\u8fd8\u9700\u8981binlog\u7684\u4f4d\u70b9\u4fe1\u606f\u6216\u8005gtid\u3002 \u4e3a\u4e86\u6ee1\u8db3\u4ee5\u4e0a\u4e24\u70b9\u8981\u6c42\uff0c\u53ef\u4ee5\u91c7\u7528\u4e0b\u5217\u65b9\u6cd5\u6765\u83b7\u5f97\u4e00\u81f4\u6027\u7684\u5907\u4efd\u96c6\u548c\u4e3b\u4ece\u4f4d\u70b9\u4fe1\u606f: 1.1 \u4f7f\u7528mysqldump\u6765\u91cd\u5efaSlave \u00b6 1.2 \u4f7f\u7528mydumper\u6765\u91cd\u5efaSlave \u00b6 1.3 \u4f7f\u7528snapshot\u6765\u91cd\u5efaSlave \u00b6 1.4 \u4f7f\u7528xtarbackup\u6765\u91cd\u5efaSlave \u00b6 1\u3001\u786e\u5b9a\u96c6\u7fa4\u62d3\u6251\u7ed3\u6784 \u00b6 \u7b80\u5355\u4e3b\u4ece\u540c\u6b65(\u4e00\u4e3b\u591a\u4ece)\uff1a \u7ea7\u8054\u590d\u5236(\u4e3b-\u4ece-\u4ece)\uff1a \u591a\u6e90\u590d\u5236\uff1a\u9488\u5bf9\u591a\u6e90\u590d\u5236\uff0c\u91cd\u5efa\u7684\u5219\u662f\u67d0\u4e2a\u590d\u5236\u901a\u9053\u3002\u5728\u64cd\u4f5c\u65f6\u9700\u8981\u52a0\u4e0a\"for channel 'channel_name';\" 2\u3001\u786e\u5b9a\u6570\u636e\u540c\u6b65\u65b9\u5f0f \u00b6 \u8fdb\u884c\u6570\u636e\u540c\u6b65\u65f6\uff0c\u53ef\u4ee5\u9009\u62e9\u5728master\u8282\u70b9\u4e0a\u505a\u5feb\u7167\uff0c\u4e5f\u53ef\u4ee5\u9009\u62e9\u5728slave\u8282\u70b9\u505a\u5feb\u7167\u3002\u4f46\u4e3a\u4e86\u51cf\u5c11\u5bf9\u7ebf\u4e0a\u4e1a\u52a1\u7684\u5f71\u54cd\uff0c\u5f3a\u70c8\u63a8\u8350\u5728slave\u8282\u70b9\u505a\u5feb\u7167. \u903b\u8f91\u5907\u4efd \u5907\u5e93\u91cd\u5efa\u6ee1\u8db3\u4e0b\u5217\u573a\u666f\u65f6\uff0c\u53ef\u4ee5\u9009\u62e9 mysqldump \u505a\u903b\u8f91\u5907\u4efd\uff1a \u6570\u636e\u91cf\u5c0f \u53ef\u79fb\u690d\u6027\u8981\u6c42\u9ad8\uff0c\u6bd4\u5982\u4e3b\u3001\u4ece\u8de8\u4e3b\u7248\u672c \u5bf9\u6062\u590d\u65f6\u95f4\u8981\u6c42\u4e0d\u9ad8\uff0cRTO\u53ef\u4ee5\u5f88\u5927 \u5907\u4efd\u7684\u7c92\u5ea6\uff1a\u5b9e\u4f8b\u7ea7\u3001\u5e93\u7ea7\u3001\u8868\u7ea7 \u5728\u7ebf\u5907\u4efd \u66f4\u591a\u573a\u666f\u5f85\u8865\u5145... \u4f7f\u7528\u8bed\u53e5\u5982\u4e0b. -- master \u8282\u70b9\u505a\u5feb\u7167\uff0c\u52a0\u4e0amaster-data=2\u9009\u9879\uff0c\u5c06\u5f53\u524dmaster\u8282\u70b9\u7684binlog\u4f4d\u3001\u70b9\u4fe1\u606f\u4ee5\u6ce8\u91ca\u7684\u5f62\u5f0f\u5199\u5165\u5230\u5907\u4efd\u6587\u4ef6\u5f00\u5934 mysqldump - u root - p --single-transaction --master-data=2 --databases db1 db2 ...dbn > dumpfile_yyyymmdd.sql -- slave\u8282\u70b9\u505a\u5feb\u7167\uff0c\u52a0\u4e0adump-slave=2\u9009\u9879\uff0c\u5c06\u5f53\u524d\u4ece\u8282\u70b9\u5bf9\u5e94\u7684master\u7684binlog\u4f4d\u3001\u70b9\u4fe1\u606f\u4ee5\u6ce8\u91ca\u7684\u5f62\u5f0f\u5199\u5165\u5230\u5907\u4efd\u6587\u4ef6\u5f00\u5934 mysqldump - u root - p --single-transaction --dump-slave=2 --databases db1 db2 ...dbn > dumpfile_yyyymmdd.sql \u7269\u7406\u5907\u4efd \u5907\u5e93\u91cd\u5efa\u6ee1\u8db3\u4e0b\u5217\u6761\u4ef6\u8bd5\uff0c\u53ef\u4ee5\u9009\u7528 xtrabackup \u5de5\u5177\u505a\u7269\u7406\u5907\u4efd\uff1a \u6570\u636e\u91cf\u5927 \u9700\u8981\u5feb\u901f\u6062\u590d \u5728\u7ebf\u70ed\u5907\uff0c\u5907\u4efd\u671f\u95f4\u4e0d\u963b\u585eDML\u8bed\u53e5 \u66f4\u591a\u573a\u666f\u5f85\u8865\u5145... -- \u4e3b\u8282\u70b9\u505a\u5feb\u7167 xtrabackup --user=root --password --parallel=4 --backup --target-dir=full_path_to_backupdir -- \u4ece\u8282\u70b9\u505a\u5feb\u7167\uff0c\u6b64\u65f6\u9700\u8981\u52a0\u4e0aslave-info\u9009\u9879\uff0c\u5c06\u5f53\u524dslave\u8282\u70b9\u5bf9\u5e94\u7684master\u8282\u70b9\u7684binlog\u4f4d\u70b9\u4fe1\u606f\u767b\u8bb0\u5230\u5355\u72ec\u7684\u6587\u4ef6\u5185 xtrabackup --user=root --password --parallel=4 --slave-info --backup --target-dir=full_path_to_backupdir 3\u3001\u5907\u4efd\u96c6\u6062\u590d \u00b6 \u4f7f\u7528scp\u3001rsync\u7b49\u5de5\u5177\u5c06\u5feb\u7167\u6587\u4ef6\u8f6c\u79fb\u5230\u5f85\u91cd\u5efa\u7684\u673a\u5668\u4e0a -- \u903b\u8f91\u5907\u4efd\u6587\u4ef6 scp /src_dir/dumpfile_yyyymmdd.sql root@hostname:/dest_dir -- \u5728\u7ec8\u7aef\u6389\u7528mysql\u5ba2\u6237\u7aef\u7a0b\u5e8f\u5c06\u5feb\u7167\u6570\u636e\u5bfc\u5165 mysql -u root -p < dumpfile_yyyymmdd.sql -- \u7269\u7406\u5907\u4efd\u6587\u4ef6 scp -r src_dir root@hostname:/dest_dir -- \u5728\u6062\u590d\u5feb\u7167\u4e4b\u524d\uff0c\u9700\u8981\u5148\u8fdb\u884cprepare\u64cd\u4f5c\uff0c\u5c06\u5907\u4efd\u6587\u4ef6\u53d8\u6210\u4e00\u81f4\u6027\u7684\u5feb\u7167\uff0c\u5728\u6700\u540e\u770b\u5230 \"completed OK!\" \u8868\u660eprepare\u64cd\u4f5c\u6210\u529f xtarback --prepare --target-dir = full_path_to_backup_dir -- \u6267\u884c\u6062\u590d\u64cd\u4f5c xtarbackup --copy-back --target-dir = full_path_to_backup_dir \u5982\u679c\u9009\u7528\u903b\u8f91\u5907\u4efd\u7684\u65b9\u5f0f\u505a\u5feb\u7167\uff0c\u8fd8\u9700\u8981\u6267\u884c\u4e0b\u9762\u7684\u8bed\u53e5\uff0c\u5c06\u539fslave\u8282\u70b9\u7684\u4e3b\u4ece\u590d\u5236\u72b6\u6001\u4fe1\u606f\u91cd\u7f6e STOP SLAVE [ for channel 'channel_name' ]; RESET SLAVE [ for channel 'channel_name' ]; 4\u3001\u590d\u5236\u6e90\u6307\u5b9a \u00b6 \u9488\u5bf9\u903b\u8f91\u5907\u4efd\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u5f0f\u67e5\u770bbinlog\u4f4d\u70b9\u4fe1\u606f less dumpfile_yyyymmdd.sql | grep \"CHANGE\" \u9488\u5bf9\u7269\u7406\u5907\u4efd\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u5f0f\u83b7\u53d6binlog\u4f4d\u70b9\u4fe1\u606f cat ${ target -dir } /xtrabackup_slave_info \u901a\u8fc7\u4ee5\u4e0a\u4e24\u6b65\uff0c\u83b7\u53d6\u5230binlog\u4f4d\u70b9\u540e\uff0c\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u8bed\u53e5\u6307\u5b9a\u590d\u5236\u6e90 change master to master_log_file = 'mysql-bin.000003' , master_log_pos = 154 [ for channel 'channel_name' ] ; 5\u3001\u5f85\u4ee5\u4e0a\u6b65\u9aa4\u786e\u8ba4\u65e0\u8bef\u540e\uff0c\u91cd\u542f\u4e3b\u4ece\u590d\u5236 \u00b6 start slave [ for channel 'channel_name' ]; -- \u67e5\u770b\u590d\u5236\u72b6\u6001,IO_thread \u548csql_thread\u7684\u8fd0\u884c\u72b6\u6001\u5747\u4e3ayes\uff0c\u590d\u5236\u6b63\u5e38 show slave status [ for channel 'channel_name' ] \\ G","title":"MySQL\u5907\u5e93\u91cd\u5efa\u64cd\u4f5c\u6b65\u9aa4"},{"location":"mysql/ha/202201/2.%E9%87%8D%E5%BB%BA%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84Slave.html#mysql","text":"MySQL\u4ece\u5e93\u53ef\u80fd\u4f1a\u56e0\u4e3a\u5f88\u591a\u539f\u56e0\u5bfc\u81f4\u4e3b\u4ece\u4e0d\u4e00\u81f4,\u6211\u4eec\u53ef\u4ee5\u5c06\u4ece\u5e93\u8bbe\u7f6e\u4e3aread_only\u6216\u8005super_read_only,\u5e76\u4e14\u4f7f\u7528RBR\u6765\u907f\u514d\u5728\u4ece\u5e93\u6267\u884c\u66f4\u65b0\u5bfc\u81f4\u7684\u4e3b\u4ece\u4e0d\u4e00\u81f4\uff0c\u4f46\u8fd9 \u4e9b\u9009\u9879\u4e5f\u65e0\u6cd5\u5b8c\u5168\u907f\u514d\u4e3b\u4ece\u4e0d\u4e00\u81f4\u3002\u5f53\u4e3b\u4ece\u4e0d\u4e00\u81f4\u65e0\u6cd5\u901a\u8fc7\u5e38\u89c4\u65b9\u6cd5\u4fee\u590d\u65f6\uff0c\u6211\u4eec\u53ea\u80fd\u901a\u8fc7\u91cd\u5efaSlave\u7684\u65b9\u5f0f\u6765\u4fee\u590d\u4e3b\u4ece\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002 \u4e3a\u4e86\u91cd\u5efaSlave\uff0c\u9700\u8981\u6709\u4e24\u65b9\u9762\u7684\u4fe1\u606f\u3002\u9996\u5148\uff0c\u9700\u8981\u6709\u4e00\u4e2a\u5904\u4e8e\u4e00\u81f4\u6027\u7684\u5907\u4efd\u96c6\uff1b\u5176\u6b21\uff0c\u4e3a\u4e86\u91cd\u5efa\u4e0e\u539f\u4e3b\u7684\u4e3b\u4ece\u5173\u7cfb\uff0c\u8fd8\u9700\u8981binlog\u7684\u4f4d\u70b9\u4fe1\u606f\u6216\u8005gtid\u3002 \u4e3a\u4e86\u6ee1\u8db3\u4ee5\u4e0a\u4e24\u70b9\u8981\u6c42\uff0c\u53ef\u4ee5\u91c7\u7528\u4e0b\u5217\u65b9\u6cd5\u6765\u83b7\u5f97\u4e00\u81f4\u6027\u7684\u5907\u4efd\u96c6\u548c\u4e3b\u4ece\u4f4d\u70b9\u4fe1\u606f:","title":"MySQL\u5907\u5e93\u91cd\u5efa\u64cd\u4f5c\u6b65\u9aa4"},{"location":"mysql/ha/202201/2.%E9%87%8D%E5%BB%BA%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84Slave.html#11-mysqldumpslave","text":"","title":"1.1 \u4f7f\u7528mysqldump\u6765\u91cd\u5efaSlave"},{"location":"mysql/ha/202201/2.%E9%87%8D%E5%BB%BA%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84Slave.html#12-mydumperslave","text":"","title":"1.2 \u4f7f\u7528mydumper\u6765\u91cd\u5efaSlave"},{"location":"mysql/ha/202201/2.%E9%87%8D%E5%BB%BA%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84Slave.html#13-snapshotslave","text":"","title":"1.3 \u4f7f\u7528snapshot\u6765\u91cd\u5efaSlave"},{"location":"mysql/ha/202201/2.%E9%87%8D%E5%BB%BA%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84Slave.html#14-xtarbackupslave","text":"","title":"1.4 \u4f7f\u7528xtarbackup\u6765\u91cd\u5efaSlave"},{"location":"mysql/ha/202201/2.%E9%87%8D%E5%BB%BA%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84Slave.html#1","text":"\u7b80\u5355\u4e3b\u4ece\u540c\u6b65(\u4e00\u4e3b\u591a\u4ece)\uff1a \u7ea7\u8054\u590d\u5236(\u4e3b-\u4ece-\u4ece)\uff1a \u591a\u6e90\u590d\u5236\uff1a\u9488\u5bf9\u591a\u6e90\u590d\u5236\uff0c\u91cd\u5efa\u7684\u5219\u662f\u67d0\u4e2a\u590d\u5236\u901a\u9053\u3002\u5728\u64cd\u4f5c\u65f6\u9700\u8981\u52a0\u4e0a\"for channel 'channel_name';\"","title":"1\u3001\u786e\u5b9a\u96c6\u7fa4\u62d3\u6251\u7ed3\u6784"},{"location":"mysql/ha/202201/2.%E9%87%8D%E5%BB%BA%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84Slave.html#2","text":"\u8fdb\u884c\u6570\u636e\u540c\u6b65\u65f6\uff0c\u53ef\u4ee5\u9009\u62e9\u5728master\u8282\u70b9\u4e0a\u505a\u5feb\u7167\uff0c\u4e5f\u53ef\u4ee5\u9009\u62e9\u5728slave\u8282\u70b9\u505a\u5feb\u7167\u3002\u4f46\u4e3a\u4e86\u51cf\u5c11\u5bf9\u7ebf\u4e0a\u4e1a\u52a1\u7684\u5f71\u54cd\uff0c\u5f3a\u70c8\u63a8\u8350\u5728slave\u8282\u70b9\u505a\u5feb\u7167. \u903b\u8f91\u5907\u4efd \u5907\u5e93\u91cd\u5efa\u6ee1\u8db3\u4e0b\u5217\u573a\u666f\u65f6\uff0c\u53ef\u4ee5\u9009\u62e9 mysqldump \u505a\u903b\u8f91\u5907\u4efd\uff1a \u6570\u636e\u91cf\u5c0f \u53ef\u79fb\u690d\u6027\u8981\u6c42\u9ad8\uff0c\u6bd4\u5982\u4e3b\u3001\u4ece\u8de8\u4e3b\u7248\u672c \u5bf9\u6062\u590d\u65f6\u95f4\u8981\u6c42\u4e0d\u9ad8\uff0cRTO\u53ef\u4ee5\u5f88\u5927 \u5907\u4efd\u7684\u7c92\u5ea6\uff1a\u5b9e\u4f8b\u7ea7\u3001\u5e93\u7ea7\u3001\u8868\u7ea7 \u5728\u7ebf\u5907\u4efd \u66f4\u591a\u573a\u666f\u5f85\u8865\u5145... \u4f7f\u7528\u8bed\u53e5\u5982\u4e0b. -- master \u8282\u70b9\u505a\u5feb\u7167\uff0c\u52a0\u4e0amaster-data=2\u9009\u9879\uff0c\u5c06\u5f53\u524dmaster\u8282\u70b9\u7684binlog\u4f4d\u3001\u70b9\u4fe1\u606f\u4ee5\u6ce8\u91ca\u7684\u5f62\u5f0f\u5199\u5165\u5230\u5907\u4efd\u6587\u4ef6\u5f00\u5934 mysqldump - u root - p --single-transaction --master-data=2 --databases db1 db2 ...dbn > dumpfile_yyyymmdd.sql -- slave\u8282\u70b9\u505a\u5feb\u7167\uff0c\u52a0\u4e0adump-slave=2\u9009\u9879\uff0c\u5c06\u5f53\u524d\u4ece\u8282\u70b9\u5bf9\u5e94\u7684master\u7684binlog\u4f4d\u3001\u70b9\u4fe1\u606f\u4ee5\u6ce8\u91ca\u7684\u5f62\u5f0f\u5199\u5165\u5230\u5907\u4efd\u6587\u4ef6\u5f00\u5934 mysqldump - u root - p --single-transaction --dump-slave=2 --databases db1 db2 ...dbn > dumpfile_yyyymmdd.sql \u7269\u7406\u5907\u4efd \u5907\u5e93\u91cd\u5efa\u6ee1\u8db3\u4e0b\u5217\u6761\u4ef6\u8bd5\uff0c\u53ef\u4ee5\u9009\u7528 xtrabackup \u5de5\u5177\u505a\u7269\u7406\u5907\u4efd\uff1a \u6570\u636e\u91cf\u5927 \u9700\u8981\u5feb\u901f\u6062\u590d \u5728\u7ebf\u70ed\u5907\uff0c\u5907\u4efd\u671f\u95f4\u4e0d\u963b\u585eDML\u8bed\u53e5 \u66f4\u591a\u573a\u666f\u5f85\u8865\u5145... -- \u4e3b\u8282\u70b9\u505a\u5feb\u7167 xtrabackup --user=root --password --parallel=4 --backup --target-dir=full_path_to_backupdir -- \u4ece\u8282\u70b9\u505a\u5feb\u7167\uff0c\u6b64\u65f6\u9700\u8981\u52a0\u4e0aslave-info\u9009\u9879\uff0c\u5c06\u5f53\u524dslave\u8282\u70b9\u5bf9\u5e94\u7684master\u8282\u70b9\u7684binlog\u4f4d\u70b9\u4fe1\u606f\u767b\u8bb0\u5230\u5355\u72ec\u7684\u6587\u4ef6\u5185 xtrabackup --user=root --password --parallel=4 --slave-info --backup --target-dir=full_path_to_backupdir","title":"2\u3001\u786e\u5b9a\u6570\u636e\u540c\u6b65\u65b9\u5f0f"},{"location":"mysql/ha/202201/2.%E9%87%8D%E5%BB%BA%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84Slave.html#3","text":"\u4f7f\u7528scp\u3001rsync\u7b49\u5de5\u5177\u5c06\u5feb\u7167\u6587\u4ef6\u8f6c\u79fb\u5230\u5f85\u91cd\u5efa\u7684\u673a\u5668\u4e0a -- \u903b\u8f91\u5907\u4efd\u6587\u4ef6 scp /src_dir/dumpfile_yyyymmdd.sql root@hostname:/dest_dir -- \u5728\u7ec8\u7aef\u6389\u7528mysql\u5ba2\u6237\u7aef\u7a0b\u5e8f\u5c06\u5feb\u7167\u6570\u636e\u5bfc\u5165 mysql -u root -p < dumpfile_yyyymmdd.sql -- \u7269\u7406\u5907\u4efd\u6587\u4ef6 scp -r src_dir root@hostname:/dest_dir -- \u5728\u6062\u590d\u5feb\u7167\u4e4b\u524d\uff0c\u9700\u8981\u5148\u8fdb\u884cprepare\u64cd\u4f5c\uff0c\u5c06\u5907\u4efd\u6587\u4ef6\u53d8\u6210\u4e00\u81f4\u6027\u7684\u5feb\u7167\uff0c\u5728\u6700\u540e\u770b\u5230 \"completed OK!\" \u8868\u660eprepare\u64cd\u4f5c\u6210\u529f xtarback --prepare --target-dir = full_path_to_backup_dir -- \u6267\u884c\u6062\u590d\u64cd\u4f5c xtarbackup --copy-back --target-dir = full_path_to_backup_dir \u5982\u679c\u9009\u7528\u903b\u8f91\u5907\u4efd\u7684\u65b9\u5f0f\u505a\u5feb\u7167\uff0c\u8fd8\u9700\u8981\u6267\u884c\u4e0b\u9762\u7684\u8bed\u53e5\uff0c\u5c06\u539fslave\u8282\u70b9\u7684\u4e3b\u4ece\u590d\u5236\u72b6\u6001\u4fe1\u606f\u91cd\u7f6e STOP SLAVE [ for channel 'channel_name' ]; RESET SLAVE [ for channel 'channel_name' ];","title":"3\u3001\u5907\u4efd\u96c6\u6062\u590d"},{"location":"mysql/ha/202201/2.%E9%87%8D%E5%BB%BA%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84Slave.html#4","text":"\u9488\u5bf9\u903b\u8f91\u5907\u4efd\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u5f0f\u67e5\u770bbinlog\u4f4d\u70b9\u4fe1\u606f less dumpfile_yyyymmdd.sql | grep \"CHANGE\" \u9488\u5bf9\u7269\u7406\u5907\u4efd\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u5f0f\u83b7\u53d6binlog\u4f4d\u70b9\u4fe1\u606f cat ${ target -dir } /xtrabackup_slave_info \u901a\u8fc7\u4ee5\u4e0a\u4e24\u6b65\uff0c\u83b7\u53d6\u5230binlog\u4f4d\u70b9\u540e\uff0c\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u8bed\u53e5\u6307\u5b9a\u590d\u5236\u6e90 change master to master_log_file = 'mysql-bin.000003' , master_log_pos = 154 [ for channel 'channel_name' ] ;","title":"4\u3001\u590d\u5236\u6e90\u6307\u5b9a"},{"location":"mysql/ha/202201/2.%E9%87%8D%E5%BB%BA%E4%B8%8D%E4%B8%80%E8%87%B4%E7%9A%84Slave.html#5","text":"start slave [ for channel 'channel_name' ]; -- \u67e5\u770b\u590d\u5236\u72b6\u6001,IO_thread \u548csql_thread\u7684\u8fd0\u884c\u72b6\u6001\u5747\u4e3ayes\uff0c\u590d\u5236\u6b63\u5e38 show slave status [ for channel 'channel_name' ] \\ G","title":"5\u3001\u5f85\u4ee5\u4e0a\u6b65\u9aa4\u786e\u8ba4\u65e0\u8bef\u540e\uff0c\u91cd\u542f\u4e3b\u4ece\u590d\u5236"},{"location":"mysql/ha/202201/3.%E6%97%A0%E6%8D%9F%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html","text":"MySQL\u65e0\u635f\u534a\u540c\u6b65\u6700\u4f73\u5b9e\u8df5 \u00b6 \u6b64\u6587\u7ae0\u5c5e\u4e8e\u7ffb\u8bd1\uff0c \u5355\u51fb\u67e5\u770b\u539f\u6587 1\u3001\u5de5\u4f5c\u539f\u7406 \u00b6 2\u3001\u65e0\u635f\u534a\u540c\u6b65\u90e8\u7f72 \u00b6 \u5728\u90e8\u7f72\u65e0\u635f\u534a\u540c\u6b65\u4e4b\u524d\uff0c\u9700\u8981\u51c6\u5907\u597dMySQL\u7684\u4e3b\u4ece\u590d\u5236\u73af\u5883\u3002\u4ee5\u4e0b\u4ecb\u7ecd\u6b63\u662f\u57fa\u4e8e\u5df2\u7ecf\u5b58\u5728\u7684\u5f02\u6b65\u590d\u5236\u73af\u5883\u8fdb\u884c\u6539\u9020 2.1 \u4e3b\u5e93\u5b89\u88c5\u63d2\u4ef6 \u00b6 2.2 \u4ece\u5e93\u5b89\u88c5\u63d2\u4ef6 \u00b6 2.3 \u4e3b\u5e93\u542f\u52a8\u534a\u540c\u6b65\u63d2\u4ef6\u5e76\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 \u00b6 2.4 \u4ece\u5e93\u542f\u52a8\u534a\u540c\u6b65\u63d2\u4ef6\u5e76\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 \u00b6 2.5 \u786e\u8ba4\u534a\u540c\u6b65\u590d\u5236\u662f\u5426\u6b63\u5e38\u5de5\u4f5c \u00b6 3\u3001\u65e0\u635f\u534a\u540c\u6b65\u590d\u5236\u9677\u9631 \u00b6 \u5728\u914d\u7f6e\u65e0\u635f\u534a\u540c\u6b65\u590d\u5236\u65f6\uff0c\u6709\u51e0\u79cd\u573a\u666f\u5bb9\u6613\u5bfc\u81f4\u4e8b\u52a1\u4e22\u5931\uff0c\u9700\u8981\u91cd\u70b9\u5173\u6ce8 3.1\u3001\u534a\u540c\u6b65\u56de\u9000\u5230\u5f02\u6b65\uff0c\u5bfc\u81f4\u7684\u4e8b\u6545 \u00b6 3.2\u3001\u534a\u540c\u6b65\u56de\u9000\u5230\u5f02\u6b65\uff0c\u5bfc\u81f4\u4e8b\u52a1\u4e22\u5931 \u00b6 3.3\u3001\u91cd\u7528\u6545\u969c\u540e\u7684master \u00b6 4\u3001failover\u7684\u9677\u9631 \u00b6","title":"MySQL\u65e0\u635f\u534a\u540c\u6b65\u6700\u4f73\u5b9e\u8df5"},{"location":"mysql/ha/202201/3.%E6%97%A0%E6%8D%9F%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#mysql","text":"\u6b64\u6587\u7ae0\u5c5e\u4e8e\u7ffb\u8bd1\uff0c \u5355\u51fb\u67e5\u770b\u539f\u6587","title":"MySQL\u65e0\u635f\u534a\u540c\u6b65\u6700\u4f73\u5b9e\u8df5"},{"location":"mysql/ha/202201/3.%E6%97%A0%E6%8D%9F%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#1","text":"","title":"1\u3001\u5de5\u4f5c\u539f\u7406"},{"location":"mysql/ha/202201/3.%E6%97%A0%E6%8D%9F%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#2","text":"\u5728\u90e8\u7f72\u65e0\u635f\u534a\u540c\u6b65\u4e4b\u524d\uff0c\u9700\u8981\u51c6\u5907\u597dMySQL\u7684\u4e3b\u4ece\u590d\u5236\u73af\u5883\u3002\u4ee5\u4e0b\u4ecb\u7ecd\u6b63\u662f\u57fa\u4e8e\u5df2\u7ecf\u5b58\u5728\u7684\u5f02\u6b65\u590d\u5236\u73af\u5883\u8fdb\u884c\u6539\u9020","title":"2\u3001\u65e0\u635f\u534a\u540c\u6b65\u90e8\u7f72"},{"location":"mysql/ha/202201/3.%E6%97%A0%E6%8D%9F%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#21","text":"","title":"2.1 \u4e3b\u5e93\u5b89\u88c5\u63d2\u4ef6"},{"location":"mysql/ha/202201/3.%E6%97%A0%E6%8D%9F%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#22","text":"","title":"2.2 \u4ece\u5e93\u5b89\u88c5\u63d2\u4ef6"},{"location":"mysql/ha/202201/3.%E6%97%A0%E6%8D%9F%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#23","text":"","title":"2.3 \u4e3b\u5e93\u542f\u52a8\u534a\u540c\u6b65\u63d2\u4ef6\u5e76\u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},{"location":"mysql/ha/202201/3.%E6%97%A0%E6%8D%9F%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#24","text":"","title":"2.4 \u4ece\u5e93\u542f\u52a8\u534a\u540c\u6b65\u63d2\u4ef6\u5e76\u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},{"location":"mysql/ha/202201/3.%E6%97%A0%E6%8D%9F%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#25","text":"","title":"2.5 \u786e\u8ba4\u534a\u540c\u6b65\u590d\u5236\u662f\u5426\u6b63\u5e38\u5de5\u4f5c"},{"location":"mysql/ha/202201/3.%E6%97%A0%E6%8D%9F%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#3","text":"\u5728\u914d\u7f6e\u65e0\u635f\u534a\u540c\u6b65\u590d\u5236\u65f6\uff0c\u6709\u51e0\u79cd\u573a\u666f\u5bb9\u6613\u5bfc\u81f4\u4e8b\u52a1\u4e22\u5931\uff0c\u9700\u8981\u91cd\u70b9\u5173\u6ce8","title":"3\u3001\u65e0\u635f\u534a\u540c\u6b65\u590d\u5236\u9677\u9631"},{"location":"mysql/ha/202201/3.%E6%97%A0%E6%8D%9F%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#31","text":"","title":"3.1\u3001\u534a\u540c\u6b65\u56de\u9000\u5230\u5f02\u6b65\uff0c\u5bfc\u81f4\u7684\u4e8b\u6545"},{"location":"mysql/ha/202201/3.%E6%97%A0%E6%8D%9F%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#32","text":"","title":"3.2\u3001\u534a\u540c\u6b65\u56de\u9000\u5230\u5f02\u6b65\uff0c\u5bfc\u81f4\u4e8b\u52a1\u4e22\u5931"},{"location":"mysql/ha/202201/3.%E6%97%A0%E6%8D%9F%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#33master","text":"","title":"3.3\u3001\u91cd\u7528\u6545\u969c\u540e\u7684master"},{"location":"mysql/ha/202201/3.%E6%97%A0%E6%8D%9F%E5%8D%8A%E5%90%8C%E6%AD%A5%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#4failover","text":"","title":"4\u3001failover\u7684\u9677\u9631"},{"location":"mysql/ha/202201/4.MHA%E5%9C%A8%E7%BA%BF%E5%88%87%E6%8D%A2%E4%B8%BB%E8%8A%82%E7%82%B9.html","text":"MHA\u5728\u7ebf\u5207\u6362\u4e3b\u8282\u70b9\u64cd\u4f5c\u6b65\u9aa4 \u00b6 1\u3001\u524d\u671f\u68c0\u67e5\u9879 \u00b6 \u7f51\u5361\u540d \uff1a\u751f\u4ea7\u73af\u5883\u7edf\u4e00\u5c06vip\u548c\u7269\u7406ip\u7ed1\u5b9a\u5230\u4e00\u5f20\u7f51\u5361\u4e0a\uff0c\u5e76\u91cd\u547d\u540d\u4e3abond0\u7f51\u5361\u91cd\u547d\u540d \u5207\u6362\u811a\u672c \uff1amha\u5207\u6362\u65f6\uff0c\u6d89\u53ca\u4e0b\u5217\u4e24\u4e2a\u811a\u672c\uff0c\u9700\u8981\u68c0\u67e5\u5176\u4e2d\u7684\u7f51\u5361\u540d\u548cvip\u914d\u7f6e\u4fe1\u606f: master_ip_online_change : \u5728\u7ebf\u53d8\u66f4\u65f6\u8c03\u7528 master_ip_failover \uff1a \u6545\u969c\u81ea\u52a8\u8f6c\u79fb\u65f6\u8c03\u7528 MHA\u914d\u7f6e\u6587\u4ef6 \uff1a/data/mha_workdir/testmha/testmha.cnf 2\u3001\u5207\u6362\u6d41\u7a0b \u00b6 2.1\u3001\u505cMHA\u670d\u52a1 \u00b6 \u5728\u5f00\u59cbswitchover\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5c06mha\u670d\u52a1\u505c\u6389\uff0c\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u5373\u53ef masterha_stop --conf = /data/mha_workdir/testmha/testmha.cnf 2.2\u3001\u5207\u6362\u4e3b\u5e93 \u00b6 \u5f85\u4e0a\u4e00\u6b65\u6267\u884c\u6210\u529f\u540e\uff0c\u8fd0\u884c\u4e0b\u9762\u7684\u8bed\u53e5\u5207\u4e3b masterha_master_switch --master_state = alive --conf = /data/mha_workdir/testmha/testmha.cnf --new_master_host = 192 .168.100.48 --orig_master_is_new_slave 2.3\u3001\u5230\u4e3b\u5e93\u4e0a\u5e7f\u64advip \u00b6 # \u9700\u8981\u6839\u636e\u5b9e\u9645\u60c5\u51b5\uff0c\u4fee\u6539vip\u548c\u7f51\u5173 arping -I bond0 -c 5 -s 192 .168.100.40 192 .168.100.200 3\u3001\u540e\u7eed\u5904\u7406 \u00b6 \u5728\u5207\u6362\u5b8c\u4e3b\u8282\u70b9\u4e4b\u540e\uff0c\u9700\u8981\u5c06mha\u670d\u52a1\u62c9\u8d77\u6765 /usr/local/bin/masterha_manager --conf = /data/mha_workdir/testmha/testmha.cnf --ignore_fail_on_start --ignore_last_failover >> /data/mha_workdir/testmha/testmha.log 2 > & 1 &","title":"MHA\u5728\u7ebf\u5207\u6362\u4e3b\u8282\u70b9\u64cd\u4f5c\u6b65\u9aa4"},{"location":"mysql/ha/202201/4.MHA%E5%9C%A8%E7%BA%BF%E5%88%87%E6%8D%A2%E4%B8%BB%E8%8A%82%E7%82%B9.html#mha","text":"","title":"MHA\u5728\u7ebf\u5207\u6362\u4e3b\u8282\u70b9\u64cd\u4f5c\u6b65\u9aa4"},{"location":"mysql/ha/202201/4.MHA%E5%9C%A8%E7%BA%BF%E5%88%87%E6%8D%A2%E4%B8%BB%E8%8A%82%E7%82%B9.html#1","text":"\u7f51\u5361\u540d \uff1a\u751f\u4ea7\u73af\u5883\u7edf\u4e00\u5c06vip\u548c\u7269\u7406ip\u7ed1\u5b9a\u5230\u4e00\u5f20\u7f51\u5361\u4e0a\uff0c\u5e76\u91cd\u547d\u540d\u4e3abond0\u7f51\u5361\u91cd\u547d\u540d \u5207\u6362\u811a\u672c \uff1amha\u5207\u6362\u65f6\uff0c\u6d89\u53ca\u4e0b\u5217\u4e24\u4e2a\u811a\u672c\uff0c\u9700\u8981\u68c0\u67e5\u5176\u4e2d\u7684\u7f51\u5361\u540d\u548cvip\u914d\u7f6e\u4fe1\u606f: master_ip_online_change : \u5728\u7ebf\u53d8\u66f4\u65f6\u8c03\u7528 master_ip_failover \uff1a \u6545\u969c\u81ea\u52a8\u8f6c\u79fb\u65f6\u8c03\u7528 MHA\u914d\u7f6e\u6587\u4ef6 \uff1a/data/mha_workdir/testmha/testmha.cnf","title":"1\u3001\u524d\u671f\u68c0\u67e5\u9879"},{"location":"mysql/ha/202201/4.MHA%E5%9C%A8%E7%BA%BF%E5%88%87%E6%8D%A2%E4%B8%BB%E8%8A%82%E7%82%B9.html#2","text":"","title":"2\u3001\u5207\u6362\u6d41\u7a0b"},{"location":"mysql/ha/202201/4.MHA%E5%9C%A8%E7%BA%BF%E5%88%87%E6%8D%A2%E4%B8%BB%E8%8A%82%E7%82%B9.html#21mha","text":"\u5728\u5f00\u59cbswitchover\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5c06mha\u670d\u52a1\u505c\u6389\uff0c\u8fd0\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u5373\u53ef masterha_stop --conf = /data/mha_workdir/testmha/testmha.cnf","title":"2.1\u3001\u505cMHA\u670d\u52a1"},{"location":"mysql/ha/202201/4.MHA%E5%9C%A8%E7%BA%BF%E5%88%87%E6%8D%A2%E4%B8%BB%E8%8A%82%E7%82%B9.html#22","text":"\u5f85\u4e0a\u4e00\u6b65\u6267\u884c\u6210\u529f\u540e\uff0c\u8fd0\u884c\u4e0b\u9762\u7684\u8bed\u53e5\u5207\u4e3b masterha_master_switch --master_state = alive --conf = /data/mha_workdir/testmha/testmha.cnf --new_master_host = 192 .168.100.48 --orig_master_is_new_slave","title":"2.2\u3001\u5207\u6362\u4e3b\u5e93"},{"location":"mysql/ha/202201/4.MHA%E5%9C%A8%E7%BA%BF%E5%88%87%E6%8D%A2%E4%B8%BB%E8%8A%82%E7%82%B9.html#23vip","text":"# \u9700\u8981\u6839\u636e\u5b9e\u9645\u60c5\u51b5\uff0c\u4fee\u6539vip\u548c\u7f51\u5173 arping -I bond0 -c 5 -s 192 .168.100.40 192 .168.100.200","title":"2.3\u3001\u5230\u4e3b\u5e93\u4e0a\u5e7f\u64advip"},{"location":"mysql/ha/202201/4.MHA%E5%9C%A8%E7%BA%BF%E5%88%87%E6%8D%A2%E4%B8%BB%E8%8A%82%E7%82%B9.html#3","text":"\u5728\u5207\u6362\u5b8c\u4e3b\u8282\u70b9\u4e4b\u540e\uff0c\u9700\u8981\u5c06mha\u670d\u52a1\u62c9\u8d77\u6765 /usr/local/bin/masterha_manager --conf = /data/mha_workdir/testmha/testmha.cnf --ignore_fail_on_start --ignore_last_failover >> /data/mha_workdir/testmha/testmha.log 2 > & 1 &","title":"3\u3001\u540e\u7eed\u5904\u7406"},{"location":"mysql/ha/202201/5.MySQL%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html","text":"MySQL\u4e3b\u4ece\u90e8\u7f72\u6700\u4f73\u5b9e\u8df5 \u00b6 1\u3001\u786e\u5b9a\u96c6\u7fa4\u62d3\u6251 \u00b6 2\u3001\u786e\u5b9a\u590d\u5236\u6a21\u5f0f \u00b6 MySQL\u7684binlog\u652f\u6301\u591a\u79cd\u6a21\u5f0f\uff0c\u5206\u522b\u4e3a ROW \u3001 STATEMENT \u3001 MIX 3\u3001\u4ece\u5e93\u5f00\u542f\u53ea\u8bfb \u00b6 \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u5728MySQL\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u5f00\u542f read_only=on \uff1b\u5bf9\u4e8e\u4e3b\u5e93\uff0c\u8bfb\u5199\u6a21\u5f0f\u5e94\u8be5\u7531\u9ad8\u53ef\u7528\u7ba1\u7406\u5de5\u5177\u6765\u7ba1\u7406\u3002 4\u3001\u542f\u7528GTID \u00b6 MySQL5.6\u63a8\u51fa\u4e86GTID\u7684\u6982\u5ff5\uff0c\u7528\u6765\u6807\u8bc6\u4e8b\u52a1 5\u3001\u542f\u7528semi-sync \u00b6 6\u3001\u4ece\u5e93crash-safe \u00b6 Crash-safe\u610f\u5473\u7740\u5728MySQL\u6216\u8005OS\u5b95\u673a\u4ee5\u540e\uff0c\u4f9d\u7136\u53ef\u4ee5\u76f4\u63a5\u6062\u590dMySQL\u4e3b\u4ece\u540c\u6b65\uff0c\u800c\u4e0d\u662f\u5229\u7528\u5907\u4efd\u6765\u91cd\u5efa\u4ece\u5e93\u3002 \u4e3a\u4e86\u786e\u4fddcrash-safe\uff0c\u9700\u8981\u786e\u4fdd\u4ee5\u4e0b\u51e0\u70b9\uff1a \u53ea\u4f7f\u7528InnoDB\u5b58\u50a8\u5f15\u64ce \u57285.6\u7248\u672c\u4ee5\u540e\uff0c\u9700\u8981\u8bbe\u7f6e\u4ee5\u4e0b\u9009\u9879 bash relay_log_info_repository=TABLE; relay_log_recovery=1; 7\u3001\u7ed3\u8bba \u00b6","title":"MySQL\u4e3b\u4ece\u90e8\u7f72\u6700\u4f73\u5b9e\u8df5"},{"location":"mysql/ha/202201/5.MySQL%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#mysql","text":"","title":"MySQL\u4e3b\u4ece\u90e8\u7f72\u6700\u4f73\u5b9e\u8df5"},{"location":"mysql/ha/202201/5.MySQL%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#1","text":"","title":"1\u3001\u786e\u5b9a\u96c6\u7fa4\u62d3\u6251"},{"location":"mysql/ha/202201/5.MySQL%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#2","text":"MySQL\u7684binlog\u652f\u6301\u591a\u79cd\u6a21\u5f0f\uff0c\u5206\u522b\u4e3a ROW \u3001 STATEMENT \u3001 MIX","title":"2\u3001\u786e\u5b9a\u590d\u5236\u6a21\u5f0f"},{"location":"mysql/ha/202201/5.MySQL%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#3","text":"\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u5728MySQL\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u5f00\u542f read_only=on \uff1b\u5bf9\u4e8e\u4e3b\u5e93\uff0c\u8bfb\u5199\u6a21\u5f0f\u5e94\u8be5\u7531\u9ad8\u53ef\u7528\u7ba1\u7406\u5de5\u5177\u6765\u7ba1\u7406\u3002","title":"3\u3001\u4ece\u5e93\u5f00\u542f\u53ea\u8bfb"},{"location":"mysql/ha/202201/5.MySQL%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#4gtid","text":"MySQL5.6\u63a8\u51fa\u4e86GTID\u7684\u6982\u5ff5\uff0c\u7528\u6765\u6807\u8bc6\u4e8b\u52a1","title":"4\u3001\u542f\u7528GTID"},{"location":"mysql/ha/202201/5.MySQL%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#5semi-sync","text":"","title":"5\u3001\u542f\u7528semi-sync"},{"location":"mysql/ha/202201/5.MySQL%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#6crash-safe","text":"Crash-safe\u610f\u5473\u7740\u5728MySQL\u6216\u8005OS\u5b95\u673a\u4ee5\u540e\uff0c\u4f9d\u7136\u53ef\u4ee5\u76f4\u63a5\u6062\u590dMySQL\u4e3b\u4ece\u540c\u6b65\uff0c\u800c\u4e0d\u662f\u5229\u7528\u5907\u4efd\u6765\u91cd\u5efa\u4ece\u5e93\u3002 \u4e3a\u4e86\u786e\u4fddcrash-safe\uff0c\u9700\u8981\u786e\u4fdd\u4ee5\u4e0b\u51e0\u70b9\uff1a \u53ea\u4f7f\u7528InnoDB\u5b58\u50a8\u5f15\u64ce \u57285.6\u7248\u672c\u4ee5\u540e\uff0c\u9700\u8981\u8bbe\u7f6e\u4ee5\u4e0b\u9009\u9879 bash relay_log_info_repository=TABLE; relay_log_recovery=1;","title":"6\u3001\u4ece\u5e93crash-safe"},{"location":"mysql/ha/202201/5.MySQL%E4%B8%BB%E4%BB%8E%E9%83%A8%E7%BD%B2%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#7","text":"","title":"7\u3001\u7ed3\u8bba"},{"location":"mysql/ha/202201/6.MGR%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html","text":"MGR\u90e8\u7f72\u5b9e\u8df5 \u00b6 1\u3001\u5355\u5b9e\u4f8bMySQL\u90e8\u7f72 \u00b6 \u7f51\u5361\u540d \uff1a\u751f\u4ea7\u73af\u5883\u7edf\u4e00\u5c06vip\u548c\u7269\u7406ip\u7ed1\u5b9a\u5230\u4e00\u5f20\u7f51\u5361\u4e0a\uff0c\u5e76\u91cd\u547d\u540d\u4e3abond0\u7f51\u5361\u91cd\u547d\u540d \u5207\u6362\u811a\u672c \uff1amha\u5207\u6362\u65f6\uff0c\u6d89\u53ca\u4e0b\u5217\u4e24\u4e2a\u811a\u672c\uff0c\u9700\u8981\u68c0\u67e5\u5176\u4e2d\u7684\u7f51\u5361\u540d\u548cvip\u914d\u7f6e\u4fe1\u606f: master_ip_online_change : \u5728\u7ebf\u53d8\u66f4\u65f6\u8c03\u7528 master_ip_failover \uff1a \u6545\u969c\u81ea\u52a8\u8f6c\u79fb\u65f6\u8c03\u7528 MHA\u914d\u7f6e\u6587\u4ef6 \uff1a/data/mha_workdir/testmha/testmha.cnf 2\u3001\u4e3b\u4ece\u5173\u7cfb\u6784\u5efa \u00b6 3\u3001\u4e3b\u4ece\u72b6\u6001\u786e\u8ba4 \u00b6 \u5728\u5207\u6362\u5b8c\u4e3b\u8282\u70b9\u4e4b\u540e\uff0c\u9700\u8981\u5c06mha\u670d\u52a1\u62c9\u8d77\u6765 /usr/local/bin/masterha_manager --conf = /data/mha_workdir/testmha/testmha.cnf --ignore_fail_on_start --ignore_last_failover >> /data/mha_workdir/testmha/testmha.log 2 > & 1 &","title":"MGR\u90e8\u7f72\u5b9e\u8df5"},{"location":"mysql/ha/202201/6.MGR%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#mgr","text":"","title":"MGR\u90e8\u7f72\u5b9e\u8df5"},{"location":"mysql/ha/202201/6.MGR%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#1mysql","text":"\u7f51\u5361\u540d \uff1a\u751f\u4ea7\u73af\u5883\u7edf\u4e00\u5c06vip\u548c\u7269\u7406ip\u7ed1\u5b9a\u5230\u4e00\u5f20\u7f51\u5361\u4e0a\uff0c\u5e76\u91cd\u547d\u540d\u4e3abond0\u7f51\u5361\u91cd\u547d\u540d \u5207\u6362\u811a\u672c \uff1amha\u5207\u6362\u65f6\uff0c\u6d89\u53ca\u4e0b\u5217\u4e24\u4e2a\u811a\u672c\uff0c\u9700\u8981\u68c0\u67e5\u5176\u4e2d\u7684\u7f51\u5361\u540d\u548cvip\u914d\u7f6e\u4fe1\u606f: master_ip_online_change : \u5728\u7ebf\u53d8\u66f4\u65f6\u8c03\u7528 master_ip_failover \uff1a \u6545\u969c\u81ea\u52a8\u8f6c\u79fb\u65f6\u8c03\u7528 MHA\u914d\u7f6e\u6587\u4ef6 \uff1a/data/mha_workdir/testmha/testmha.cnf","title":"1\u3001\u5355\u5b9e\u4f8bMySQL\u90e8\u7f72"},{"location":"mysql/ha/202201/6.MGR%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#2","text":"","title":"2\u3001\u4e3b\u4ece\u5173\u7cfb\u6784\u5efa"},{"location":"mysql/ha/202201/6.MGR%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#3","text":"\u5728\u5207\u6362\u5b8c\u4e3b\u8282\u70b9\u4e4b\u540e\uff0c\u9700\u8981\u5c06mha\u670d\u52a1\u62c9\u8d77\u6765 /usr/local/bin/masterha_manager --conf = /data/mha_workdir/testmha/testmha.cnf --ignore_fail_on_start --ignore_last_failover >> /data/mha_workdir/testmha/testmha.log 2 > & 1 &","title":"3\u3001\u4e3b\u4ece\u72b6\u6001\u786e\u8ba4"},{"location":"mysql/ha/202201/7.MySQL%E6%8B%93%E6%89%91%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E5%AF%B9%E6%AF%94.html","text":"MySQL\u9ad8\u53ef\u7528\u62d3\u6251\u7ba1\u7406\u5de5\u5177\u5bf9\u6bd4 \u00b6 1\u3001\u5b58\u5728\u7684\u5de5\u5177 \u00b6 MHA MRM orchestrator [] 2\u3001\u529f\u80fd\u5bf9\u6bd4 \u00b6 2.1 MHA failover \u00b6 2.2 MHA switchover \u00b6 2.3 MHA lost transactions \u00b6","title":"MySQL\u9ad8\u53ef\u7528\u62d3\u6251\u7ba1\u7406\u5de5\u5177\u5bf9\u6bd4"},{"location":"mysql/ha/202201/7.MySQL%E6%8B%93%E6%89%91%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E5%AF%B9%E6%AF%94.html#mysql","text":"","title":"MySQL\u9ad8\u53ef\u7528\u62d3\u6251\u7ba1\u7406\u5de5\u5177\u5bf9\u6bd4"},{"location":"mysql/ha/202201/7.MySQL%E6%8B%93%E6%89%91%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E5%AF%B9%E6%AF%94.html#1","text":"MHA MRM orchestrator []","title":"1\u3001\u5b58\u5728\u7684\u5de5\u5177"},{"location":"mysql/ha/202201/7.MySQL%E6%8B%93%E6%89%91%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E5%AF%B9%E6%AF%94.html#2","text":"","title":"2\u3001\u529f\u80fd\u5bf9\u6bd4"},{"location":"mysql/ha/202201/7.MySQL%E6%8B%93%E6%89%91%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E5%AF%B9%E6%AF%94.html#21-mha-failover","text":"","title":"2.1 MHA failover"},{"location":"mysql/ha/202201/7.MySQL%E6%8B%93%E6%89%91%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E5%AF%B9%E6%AF%94.html#22-mha-switchover","text":"","title":"2.2 MHA switchover"},{"location":"mysql/ha/202201/7.MySQL%E6%8B%93%E6%89%91%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E5%AF%B9%E6%AF%94.html#23-mha-lost-transactions","text":"","title":"2.3 MHA lost transactions"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html","text":"MySQL\u5728Github\u7684\u9ad8\u53ef\u7528\u5b9e\u8df5 \u00b6 \u8fd9\u7bc7\u535a\u5ba2\u7ffb\u8bd1\u81eaGithub\u535a\u5ba2\u5e73\u53f0\uff0c \u539f\u6587\u5728\u6b64 Github\u4f7f\u7528MySQL\u4f5c\u4e3a\u5176\u6240\u6709\u975egit\u4e8b\u7269\u7684\u4e3b\u8981\u6570\u636e\u5b58\u50a8\uff0c\u4ed6\u7684\u53ef\u7528\u6027\u5bf9Github\u7684\u8fd0\u7528\u81f3\u5173\u91cd\u8981\u3002 1\u3001\u9ad8\u53ef\u7528\u6027\u76ee\u6807 \u00b6 2\u3001\u4eceVIP\u548cDNS\u5207\u6362\u5230\u670d\u52a1\u53d1\u73b0 \u00b6 3\u3001Github\u7684\u9ad8\u53ef\u7528\u89e3\u51b3\u65b9\u6848: orchestrator, Consul, GLB \u00b6 3.1\u3001\u5e38\u89c4\u5207\u6362\u6d41\u7a0b \u00b6 3.2\u3001\u57fa\u4e8eConsul\u7684\u670d\u52a1\u53d1\u73b0 \u00b6 3.3\u3001\u57fa\u4e8eraft\u7684orchestrator\u9ad8\u53ef\u7528\u5b9e\u73b0 \u00b6 3.4\u3001\u57fa\u4e8eConsul\u548corchestrator\u7684\u5207\u6362\u6d41\u7a0b \u00b6 4\u3001\u989d\u5916\u8865\u5145 \u00b6 5\u3001orchestrator/raft\u7684\u5931\u8d25\u63a2\u6d4b \u00b6 6\u3001\u5feb\u901f\u901a\u544a \u00b6 7\u3001\u534a\u540c\u6b65\u590d\u5236\u5e94\u7528 \u00b6 8\u3001\u5fc3\u8df3\u6ce8\u5165 \u00b6 9\u3001orchestrator ownership delegation \u00b6 10\u3001\u65b9\u6848\u5b58\u5728\u7684\u9650\u5236\u548c\u7f3a\u70b9 \u00b6 11\u3001\u89e3\u51b3\u65b9\u6848\u73b0\u72b6 \u00b6 12\u3001\u7ed3\u8bba \u00b6","title":"MySQL\u5728Github\u7684\u9ad8\u53ef\u7528\u5b9e\u8df5"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#mysqlgithub","text":"\u8fd9\u7bc7\u535a\u5ba2\u7ffb\u8bd1\u81eaGithub\u535a\u5ba2\u5e73\u53f0\uff0c \u539f\u6587\u5728\u6b64 Github\u4f7f\u7528MySQL\u4f5c\u4e3a\u5176\u6240\u6709\u975egit\u4e8b\u7269\u7684\u4e3b\u8981\u6570\u636e\u5b58\u50a8\uff0c\u4ed6\u7684\u53ef\u7528\u6027\u5bf9Github\u7684\u8fd0\u7528\u81f3\u5173\u91cd\u8981\u3002","title":"MySQL\u5728Github\u7684\u9ad8\u53ef\u7528\u5b9e\u8df5"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#1","text":"","title":"1\u3001\u9ad8\u53ef\u7528\u6027\u76ee\u6807"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#2vipdns","text":"","title":"2\u3001\u4eceVIP\u548cDNS\u5207\u6362\u5230\u670d\u52a1\u53d1\u73b0"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#3github-orchestrator-consul-glb","text":"","title":"3\u3001Github\u7684\u9ad8\u53ef\u7528\u89e3\u51b3\u65b9\u6848: orchestrator, Consul, GLB"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#31","text":"","title":"3.1\u3001\u5e38\u89c4\u5207\u6362\u6d41\u7a0b"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#32consul","text":"","title":"3.2\u3001\u57fa\u4e8eConsul\u7684\u670d\u52a1\u53d1\u73b0"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#33raftorchestrator","text":"","title":"3.3\u3001\u57fa\u4e8eraft\u7684orchestrator\u9ad8\u53ef\u7528\u5b9e\u73b0"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#34consulorchestrator","text":"","title":"3.4\u3001\u57fa\u4e8eConsul\u548corchestrator\u7684\u5207\u6362\u6d41\u7a0b"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#4","text":"","title":"4\u3001\u989d\u5916\u8865\u5145"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#5orchestratorraft","text":"","title":"5\u3001orchestrator/raft\u7684\u5931\u8d25\u63a2\u6d4b"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#6","text":"","title":"6\u3001\u5feb\u901f\u901a\u544a"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#7","text":"","title":"7\u3001\u534a\u540c\u6b65\u590d\u5236\u5e94\u7528"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#8","text":"","title":"8\u3001\u5fc3\u8df3\u6ce8\u5165"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#9orchestrator-ownership-delegation","text":"","title":"9\u3001orchestrator ownership delegation"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#10","text":"","title":"10\u3001\u65b9\u6848\u5b58\u5728\u7684\u9650\u5236\u548c\u7f3a\u70b9"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#11","text":"","title":"11\u3001\u89e3\u51b3\u65b9\u6848\u73b0\u72b6"},{"location":"mysql/ha/202201/8.MySQ%E5%9C%A8Github%E7%9A%84%E9%AB%98%E5%8F%AF%E7%94%A8%E5%AE%9E%E8%B7%B5.html#12","text":"","title":"12\u3001\u7ed3\u8bba"},{"location":"mysql/ha/202201/9.MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E5%92%8C%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%9A%84%E6%9B%B4%E5%A4%9A%E6%83%B3%E6%B3%95.html","text":"MySQL\u9ad8\u53ef\u7528\u548c\u6545\u969c\u8f6c\u79fb\u7684\u66f4\u591a\u60f3\u6cd5 \u00b6 \u8fd9\u7bc7\u535a\u5ba2\u7ffb\u8bd1\u81eaJ-F Gagnes\u7684\u535a\u5ba2\uff0c \u539f\u6587\u5728\u6b64 \u51e0\u4e2a\u6708\u524d\uff0cShlomi Noach \u53d1\u5e03\u4e86 \u4e00\u7cfb\u5217\u5173\u4e8e\u670d\u52a1\u53d1\u73b0\u7684\u535a\u5ba2 \u3002 \u5728\u4ed6\u7684\u535a\u6587\u91cc\u9762\uff0cShlomi \u4ecb\u7ecd\u4e86\u591a\u79cd\u5e94\u7528\u53d1\u73b0Master\u5b9e\u4f8b\u7684\u65b9\u6cd5\uff0c\u4ed6\u4e5f\u63d0\u4f9b\u4e86\u5982\u4f55\u5e94\u5bf9\u6545\u969c\u8f6c\u79fb\u7684\u8be6\u7ec6\u6b65\u9aa4\uff0c\u5305\u62ec\u4ed6\u4eec\u4e0e Orchestrator \u7684\u96c6\u6210\u65b9\u6cd5. \u8fd9\u662f\u5f88\u4f18\u79c0\u7684\u7cfb\u5217\u535a\u6587\uff0c 1\u3001\u5931\u8d25\u65f6\u7684\u54cd\u5e94 \u00b6 2\u3001\u5931\u8d25\u63a2\u6d4b \u00b6 3\u3001\u670d\u52a1\u53d1\u73b0 \u00b6 4\u3001\u670d\u52a1\u9694\u79bb \u00b6 5\u3001\u4fee\u590d\u8111\u88c2\u4e4b\u540e\u7684\u6570\u636e \u00b6","title":"MySQL\u9ad8\u53ef\u7528\u548c\u6545\u969c\u8f6c\u79fb\u7684\u66f4\u591a\u60f3\u6cd5"},{"location":"mysql/ha/202201/9.MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E5%92%8C%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%9A%84%E6%9B%B4%E5%A4%9A%E6%83%B3%E6%B3%95.html#mysql","text":"\u8fd9\u7bc7\u535a\u5ba2\u7ffb\u8bd1\u81eaJ-F Gagnes\u7684\u535a\u5ba2\uff0c \u539f\u6587\u5728\u6b64 \u51e0\u4e2a\u6708\u524d\uff0cShlomi Noach \u53d1\u5e03\u4e86 \u4e00\u7cfb\u5217\u5173\u4e8e\u670d\u52a1\u53d1\u73b0\u7684\u535a\u5ba2 \u3002 \u5728\u4ed6\u7684\u535a\u6587\u91cc\u9762\uff0cShlomi \u4ecb\u7ecd\u4e86\u591a\u79cd\u5e94\u7528\u53d1\u73b0Master\u5b9e\u4f8b\u7684\u65b9\u6cd5\uff0c\u4ed6\u4e5f\u63d0\u4f9b\u4e86\u5982\u4f55\u5e94\u5bf9\u6545\u969c\u8f6c\u79fb\u7684\u8be6\u7ec6\u6b65\u9aa4\uff0c\u5305\u62ec\u4ed6\u4eec\u4e0e Orchestrator \u7684\u96c6\u6210\u65b9\u6cd5. \u8fd9\u662f\u5f88\u4f18\u79c0\u7684\u7cfb\u5217\u535a\u6587\uff0c","title":"MySQL\u9ad8\u53ef\u7528\u548c\u6545\u969c\u8f6c\u79fb\u7684\u66f4\u591a\u60f3\u6cd5"},{"location":"mysql/ha/202201/9.MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E5%92%8C%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%9A%84%E6%9B%B4%E5%A4%9A%E6%83%B3%E6%B3%95.html#1","text":"","title":"1\u3001\u5931\u8d25\u65f6\u7684\u54cd\u5e94"},{"location":"mysql/ha/202201/9.MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E5%92%8C%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%9A%84%E6%9B%B4%E5%A4%9A%E6%83%B3%E6%B3%95.html#2","text":"","title":"2\u3001\u5931\u8d25\u63a2\u6d4b"},{"location":"mysql/ha/202201/9.MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E5%92%8C%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%9A%84%E6%9B%B4%E5%A4%9A%E6%83%B3%E6%B3%95.html#3","text":"","title":"3\u3001\u670d\u52a1\u53d1\u73b0"},{"location":"mysql/ha/202201/9.MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E5%92%8C%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%9A%84%E6%9B%B4%E5%A4%9A%E6%83%B3%E6%B3%95.html#4","text":"","title":"4\u3001\u670d\u52a1\u9694\u79bb"},{"location":"mysql/ha/202201/9.MySQL%E9%AB%98%E5%8F%AF%E7%94%A8%E5%92%8C%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E7%9A%84%E6%9B%B4%E5%A4%9A%E6%83%B3%E6%B3%95.html#5","text":"","title":"5\u3001\u4fee\u590d\u8111\u88c2\u4e4b\u540e\u7684\u6570\u636e"},{"location":"mysql/ha/202202/index.html","text":"MySQL\u76f8\u5173 \u00b6 202112 via the PMM Settings page. 202201 PMM Server via the user interface.","title":"MySQL\u76f8\u5173"},{"location":"mysql/ha/202202/index.html#mysql","text":"202112 via the PMM Settings page. 202201 PMM Server via the user interface.","title":"MySQL\u76f8\u5173"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html","text":"MHA\u6301\u7eed\u76d1\u63a7\u548cfailover \u00b6 \u6b64\u535a\u5ba2\u6839\u636eMHA\u5b98\u65b9\u624b\u518c\u6574\u7406 MHA\u5728\u6301\u7eed\u76d1\u63a7\u548c\u6545\u969c\u8f6c\u79fb\u65f6\uff0c\u4f1a\u6309\u7167\u4ee5\u4e0b\u6d41\u7a0b\u8fdb\u884c 1\u3001\u68c0\u67e5\u4e3b\u4ece\u8bbe\u7f6e\u548c\u8bc6\u522bMaster \u00b6 \u8fde\u63a5\u5230mha\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u6307\u5b9a\u7684\u6240\u6709\u673a\u5668\u4e0a\uff0c\u8bc6\u522b\u51fa\u4e3b\u8282\u70b9\u7684\u673a\u5668\u4fe1\u606f\u3002\u5728\u914d\u7f6eMHA\u65f6\uff0c\u65e0\u9700\u624b\u52a8\u6307\u5b9aMaster\u5b9e\u4f8b\u7684\u673a\u5668\u4fe1\u606f\u3002MHA\u5728 \u68c0\u67e5\u4e3b\u4ece\u914d\u7f6e\u7684\u540c\u65f6\uff0c\u5c06read_only=On\u7684\u5b9e\u4f8b\u6807\u8bc6\u4e3aMaster \u5728\u6b64\u9636\u6bb5\uff0c\u5982\u679c\u53d1\u73b0\u6709\u4ece\u5e93\u5b95\u673a\uff0c\u4e3a\u4e86\u786e\u4fdd\u5b89\u5168\uff0c\u811a\u672c\u4f1a\u9000\u51fa\u6267\u884c \u68c0\u67e5\u5fc5\u8981\u7684\u811a\u672c\u3002\u5728\u6b64\u9636\u6bb5\uff0c\u5982\u679c\u90a3\u4e9b\u786e\u4fddMHA\u6b63\u5e38\u5de5\u4f5c\u7684\u811a\u672c\u6ca1\u6709\u5b89\u88c5\uff0c\u5219MHA\u4f1a\u4e2d\u65ad\u8fdb\u7a0b\u5e76\u505c\u6b62\u6301\u7eed\u76d1\u63a7 2\u3001\u6301\u7eed\u76d1\u63a7Master\u5b9e\u4f8b \u00b6 \u901a\u8fc7\u7b2c\u4e00\u9636\u6bb5\u7684\u68c0\u67e5\u4ee5\u540e\uff0cMHA\u4f1a\u6301\u7eed\u76d1\u63a7Master\u5b9e\u4f8b\u7684\u5065\u5eb7\u72b6\u6001\u3002MHA\u4e0d\u4f1a\u76d1\u63a7Slave\u7684\u72b6\u6001\uff0c\u505c\u6b62/\u91cd\u542f/\u65b0\u589e/\u79fb\u9664Slave\u4e0d\u4f1a\u5f71\u54cd \u5f53\u524d\u7684MHA\u76d1\u63a7\u8fdb\u7a0b\uff0c\u4f46\u662f\u4ece\u62d3\u6251\u91cc\u9762\u65b0\u589e\u6216\u79fb\u9664Slave\u5b9e\u4f8b\u65f6\uff0c\u9700\u8981\u66f4\u65b0MHA\u914d\u7f6e\u6587\u4ef6\u5e76\u91cd\u542fMHA 3\u3001\u63a2\u6d4bMaster\u5b9e\u4f8b\u72b6\u6001 \u00b6 \u5f53MHA\u8fde\u63a5\u4e3b\u5e93\u8054\u7cfb\u5931\u8d253\u6b21\u4ee5\u540e\uff0c\u8fdb\u5165\u8fd9\u4e00\u9636\u6bb5 \u5982\u679c\u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u5b9a\u4e49**secondary_check_script**\uff0cMHA\u4f1a\u8c03\u7528\u8be5\u811a\u672c\u518d\u6b21\u68c0\u67e5Master\u662f\u5426\u771f\u7684\u5b95\u673a\uff0c\u4ece\u800c\u907f\u514d\u8bef\u5224 4\u3001\u518d\u6b21\u786e\u8ba4\u4e3b\u4ece\u914d\u7f6e\u4fe1\u606f \u00b6 \u4eceMHA\u914d\u7f6e\u6587\u4ef6\u91cc\u8bfb\u53d6\u5185\u5bb9\uff0c\u8fde\u63a5\u5230\u91cc\u9762\u6307\u5b9a\u7684\u6240\u6709\u6570\u636e\u5e93\u4e0a\u9762\uff0c\u518d\u6b21\u786e\u8ba4\u662f\u5426\u6240\u6709Slave\u5b9e\u4f8b\u90fd\u4ece\u5df2\u7ecf\u5b95\u673a\u7684MAster\u590d\u5236\u3002\u5982\u679c\u6709\u4e0d\u5408\u6cd5\u7684 \u590d\u5236\u914d\u7f6e\u88ab\u63a2\u6d4b\u5230\u3010eg\uff1a\u6709Slave\u4ece\u5176\u4ed6Master\u8fdb\u884c\u590d\u5236\u3011\uff0cMHA\u5230\u6b64\u9000\u51fa\u6267\u884c\u3002\u5982\u679c\u9700\u8981\u907f\u514d\u56e0\u4e3a\u4ece\u5e93\u7684\u9519\u8bef\u5bfc\u81f4\u6545\u969c\u8f6c\u79fb\u5931\u8d25\uff0c\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6 \u5bf9\u5e94\u6570\u636e\u5e93\u5b9e\u4f8b\u540e\u9762\u6dfb\u52a0**ignore_fail**\u53c2\u6570 \u68c0\u67e5\u4e0a\u4e00\u6b21\u6545\u969c\u8f6c\u79fb\u662f\u5426\u6210\u529f\u3002\u5982\u679c\u4e0a\u4e00\u6b21\u6545\u969c\u8f6c\u79fb\u5931\u8d25\u6216\u8005\u76f8\u9694\u65f6\u95f4\u8f83\u77ed\uff0cMHA\u5728\u6b64\u505c\u6b62\u8fd0\u884c\u5e76\u4e14\u4e2d\u65ad\u6545\u969c\u8f6c\u79fb\u6d41\u7a0b\u3002\u5982\u679c\u9700\u8981\u8df3\u8fc7\u4ee5\u4e0a\u68c0\u67e5\uff0c\u53ef\u4ee5 \u5728**masterha_manger**\u547d\u4ee4\u884c\u53c2\u6570\u91cc\u9762\u6307\u5b9a**ignore_last_failover**\u548c**wait_on_failover_error** 5\u3001\u5173\u95ed\u5df2\u5b95\u673aMaster\u670d\u52a1\u5668\u3010\u53ef\u9009\u3011 \u00b6 \u5982\u679c\u5df2\u7ecf\u5728MHA\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u6307\u5b9a**master_ip_failover_script**\u6216\u8005**shutdown_script**,MHA\u8c03\u7528\u5bf9\u5e94\u7684\u811a\u672c \u6ce8\u9500\u539f\u4e3b\u4e0a\u9762\u7684VIP \u4e3a\u4e86\u907f\u514d\u539f\u4e3b\u7a81\u7136\u6062\u590d\uff0c\u9020\u6210\u8111\u88c2\uff0c\u5efa\u8bae\u5c06\u539f\u4e3b\u5173\u673a 6\u3001\u6062\u590d\u65b0\u4e3b \u00b6 \u5728\u5b8c\u6210\u4ee5\u4e0a\u64cd\u4f5c\u4ee5\u540e\uff0c\u5f00\u59cb\u6062\u590d\u65b0\u4e3b\u7684\u6d41\u7a0b 6.1\u3001\u4ece\u6240\u6709Slave\u4e2d\u8bc6\u522b\u51fa\u6700\u65b0\u7684Slave \u00b6 Master\u5b9e\u4f8b\u7684binlog\u4f4d\u70b9\u4fe1\u606f\u4f1a\u8bb0\u5f55\u5230Slave\u5b9e\u4f8b\u7684Relay-log\u4e2d\uff0cend_log_pos\u7684\u503c\u8d8a\u5927\uff0c\u8bf4\u660e\u5176\u63a5\u6536\u5230\u7684binlog\u8d8a\u591a\uff0cMHA\u5c06end_log_pos\u6700\u5927 \u503c\u7684Slave\u6807\u8bc6\u4e3a\u6700\u65b0\u7684 6.2\u3001\u4ece\u5df2\u5b95\u673a\u7684MAster\u8282\u70b9\u62f7\u8d1dbinlog \u00b6 \u5982\u679c\u5df2\u7ecf\u5b95\u673a\u7684Master\u8282\u70b9\u8fd8\u80fd\u901a\u8fc7ssh\u8fde\u63a5\uff0cMHA\u5c06\u6700\u65b0Slave\u7684end_log_pos\u3010Read_Master_Log_Pos\u3011\u4e00\u76f4\u5230\u6700\u540e\u7684binlog\u5185\u5b58\u4fdd\u5b58\u4e0b\u6765\uff0c\u65b9\u4fbf\u540e \u7eed\u4f7f\u7528 6.3\u3001\u4ece\u5b58\u6d3b\u7684Slave\u91cc\u9762\u9009\u51fa\u65b0\u4e3b \u00b6 \u57fa\u4e8eMHA\u914d\u7f6e\u6587\u4ef6\u548cMySQL\u914d\u7f6e \u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u662f\u5426\u5b58\u5728**candidate_master=1**\u7684\u5b9e\u4f8b,\u8fd9\u7c7b\u5b9e\u4f8b\u4f18\u5148\u88ab\u9009\u4e3a\u4e3b \u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u662f\u5426\u5b58\u5728**no_master=1**\u7684\u5b9e\u4f8b\uff0c\u8fd9\u7c7b\u5b9e\u4f8b\u4e0d\u80fd\u88ab\u9009\u4e3a\u4e3b 6.4\u3001\u6062\u590d\u5e76\u63d0\u5347\u4e0a\u4e00\u6b65\u9009\u51fa\u7684\u4e3b\u8282\u70b9 \u00b6 \u4ecebinlog\u6216\u8005relaylog\u751f\u6210\u5dee\u5f02event \u5c06\u4e0a\u8ff0event\u5e94\u7528\u5230\u65b0\u4e3b \u5982\u679c\u5728\u6b64\u8fc7\u7a0b\u4e2d\u9047\u5230\u9519\u8bef\u3010eg.\u952e\u91cd\u590d\u3011,MHA\u4e2d\u65ad\u6267\u884c\uff0c\u5e76\u4e14\u540e\u7eed\u7684\u6062\u590d\u6d41\u7a0b\u4e5f\u505c\u6b62 7\u3001\u6fc0\u6d3b\u65b0\u4e3b \u00b6 \u5982\u679c\u5728MHA\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u6307\u5b9a**master_ip_failover_script** \uff0cMHA\u8c03\u7528\u8be5\u811a\u672c\uff1a\u5728\u811a\u672c\u91cc\u9762\u91cc\u9762\u53ef\u4ee5\u505a\u6240\u6709\u6545\u969c\u8f6c\u79fb\u7684\u540e\u7eed\u4e8b\u60c5\uff0c\u6bd4\u5982\u6fc0\u6d3bVIP\u3001\u521b\u5efa\u7279\u6743\u8d26\u53f7\u7b49 8\u3001\u6062\u590d\u5269\u4f59\u4ece\u5e93 \u00b6 \u4ecebinlog\u6216\u8005relaylog\u751f\u6210\u5dee\u5f02event\uff0c\u6b64\u6b65\u9aa4\u5728\u5269\u4f59\u7684\u4ece\u5e93\u4e0a\u5e76\u884c\u6267\u884c \u5e94\u7528\u5dee\u5f02event\u5230\u5bf9\u5e94Slave\u5b9e\u4f8b\uff0c\u6b64\u6b65\u9aa4\u5728\u5269\u4f59\u7684\u4ece\u5e93\u4e0a\u5e76\u884c\u6267\u884c \u5c06Slave\u6307\u5411\u65b0\u4e3b 9\u3001\u6e05\u7406\u65b0\u4e3b \u00b6 \u5728\u65b0\u4e3b\u4e0a\u6267\u884creset slave all,\u6e05\u7406\u6389\u539f\u6765\u7684\u4e3b\u4ece\u590d\u5236\u4fe1\u606f 10\u3001\u53d1\u9001\u901a\u77e5\u3010\u53ef\u9009\u3011 \u00b6 \u5982\u679c\u5728MHA\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a**report_script**\u811a\u672c\uff0cMHA\u8c03\u7528\u6b64\u811a\u672c\u3002\u5728\u811a\u672c\u91cc\u53ef\u4ee5\u5b8c\u6210\u4ee5\u4e0b\u64cd\u4f5c: \u53d1\u9001\u90ae\u4ef6\u8c03\u6574\u6545\u969c\u8f6c\u79fb\u4fe1\u606f \u5728\u65b0\u4e3b\u4e0a\u6682\u505c\u5907\u4efd\u4efb\u52a1 \u66f4\u65b0\u5185\u90e8\u8fd0\u7ef4\u7ba1\u7406\u811a\u672c\u7684\u72b6\u6001\u7b49","title":"1.MHA failover\u6d41\u7a0b"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#mhafailover","text":"\u6b64\u535a\u5ba2\u6839\u636eMHA\u5b98\u65b9\u624b\u518c\u6574\u7406 MHA\u5728\u6301\u7eed\u76d1\u63a7\u548c\u6545\u969c\u8f6c\u79fb\u65f6\uff0c\u4f1a\u6309\u7167\u4ee5\u4e0b\u6d41\u7a0b\u8fdb\u884c","title":"MHA\u6301\u7eed\u76d1\u63a7\u548cfailover"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#1master","text":"\u8fde\u63a5\u5230mha\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u6307\u5b9a\u7684\u6240\u6709\u673a\u5668\u4e0a\uff0c\u8bc6\u522b\u51fa\u4e3b\u8282\u70b9\u7684\u673a\u5668\u4fe1\u606f\u3002\u5728\u914d\u7f6eMHA\u65f6\uff0c\u65e0\u9700\u624b\u52a8\u6307\u5b9aMaster\u5b9e\u4f8b\u7684\u673a\u5668\u4fe1\u606f\u3002MHA\u5728 \u68c0\u67e5\u4e3b\u4ece\u914d\u7f6e\u7684\u540c\u65f6\uff0c\u5c06read_only=On\u7684\u5b9e\u4f8b\u6807\u8bc6\u4e3aMaster \u5728\u6b64\u9636\u6bb5\uff0c\u5982\u679c\u53d1\u73b0\u6709\u4ece\u5e93\u5b95\u673a\uff0c\u4e3a\u4e86\u786e\u4fdd\u5b89\u5168\uff0c\u811a\u672c\u4f1a\u9000\u51fa\u6267\u884c \u68c0\u67e5\u5fc5\u8981\u7684\u811a\u672c\u3002\u5728\u6b64\u9636\u6bb5\uff0c\u5982\u679c\u90a3\u4e9b\u786e\u4fddMHA\u6b63\u5e38\u5de5\u4f5c\u7684\u811a\u672c\u6ca1\u6709\u5b89\u88c5\uff0c\u5219MHA\u4f1a\u4e2d\u65ad\u8fdb\u7a0b\u5e76\u505c\u6b62\u6301\u7eed\u76d1\u63a7","title":"1\u3001\u68c0\u67e5\u4e3b\u4ece\u8bbe\u7f6e\u548c\u8bc6\u522bMaster"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#2master","text":"\u901a\u8fc7\u7b2c\u4e00\u9636\u6bb5\u7684\u68c0\u67e5\u4ee5\u540e\uff0cMHA\u4f1a\u6301\u7eed\u76d1\u63a7Master\u5b9e\u4f8b\u7684\u5065\u5eb7\u72b6\u6001\u3002MHA\u4e0d\u4f1a\u76d1\u63a7Slave\u7684\u72b6\u6001\uff0c\u505c\u6b62/\u91cd\u542f/\u65b0\u589e/\u79fb\u9664Slave\u4e0d\u4f1a\u5f71\u54cd \u5f53\u524d\u7684MHA\u76d1\u63a7\u8fdb\u7a0b\uff0c\u4f46\u662f\u4ece\u62d3\u6251\u91cc\u9762\u65b0\u589e\u6216\u79fb\u9664Slave\u5b9e\u4f8b\u65f6\uff0c\u9700\u8981\u66f4\u65b0MHA\u914d\u7f6e\u6587\u4ef6\u5e76\u91cd\u542fMHA","title":"2\u3001\u6301\u7eed\u76d1\u63a7Master\u5b9e\u4f8b"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#3master","text":"\u5f53MHA\u8fde\u63a5\u4e3b\u5e93\u8054\u7cfb\u5931\u8d253\u6b21\u4ee5\u540e\uff0c\u8fdb\u5165\u8fd9\u4e00\u9636\u6bb5 \u5982\u679c\u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u5b9a\u4e49**secondary_check_script**\uff0cMHA\u4f1a\u8c03\u7528\u8be5\u811a\u672c\u518d\u6b21\u68c0\u67e5Master\u662f\u5426\u771f\u7684\u5b95\u673a\uff0c\u4ece\u800c\u907f\u514d\u8bef\u5224","title":"3\u3001\u63a2\u6d4bMaster\u5b9e\u4f8b\u72b6\u6001"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#4","text":"\u4eceMHA\u914d\u7f6e\u6587\u4ef6\u91cc\u8bfb\u53d6\u5185\u5bb9\uff0c\u8fde\u63a5\u5230\u91cc\u9762\u6307\u5b9a\u7684\u6240\u6709\u6570\u636e\u5e93\u4e0a\u9762\uff0c\u518d\u6b21\u786e\u8ba4\u662f\u5426\u6240\u6709Slave\u5b9e\u4f8b\u90fd\u4ece\u5df2\u7ecf\u5b95\u673a\u7684MAster\u590d\u5236\u3002\u5982\u679c\u6709\u4e0d\u5408\u6cd5\u7684 \u590d\u5236\u914d\u7f6e\u88ab\u63a2\u6d4b\u5230\u3010eg\uff1a\u6709Slave\u4ece\u5176\u4ed6Master\u8fdb\u884c\u590d\u5236\u3011\uff0cMHA\u5230\u6b64\u9000\u51fa\u6267\u884c\u3002\u5982\u679c\u9700\u8981\u907f\u514d\u56e0\u4e3a\u4ece\u5e93\u7684\u9519\u8bef\u5bfc\u81f4\u6545\u969c\u8f6c\u79fb\u5931\u8d25\uff0c\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6 \u5bf9\u5e94\u6570\u636e\u5e93\u5b9e\u4f8b\u540e\u9762\u6dfb\u52a0**ignore_fail**\u53c2\u6570 \u68c0\u67e5\u4e0a\u4e00\u6b21\u6545\u969c\u8f6c\u79fb\u662f\u5426\u6210\u529f\u3002\u5982\u679c\u4e0a\u4e00\u6b21\u6545\u969c\u8f6c\u79fb\u5931\u8d25\u6216\u8005\u76f8\u9694\u65f6\u95f4\u8f83\u77ed\uff0cMHA\u5728\u6b64\u505c\u6b62\u8fd0\u884c\u5e76\u4e14\u4e2d\u65ad\u6545\u969c\u8f6c\u79fb\u6d41\u7a0b\u3002\u5982\u679c\u9700\u8981\u8df3\u8fc7\u4ee5\u4e0a\u68c0\u67e5\uff0c\u53ef\u4ee5 \u5728**masterha_manger**\u547d\u4ee4\u884c\u53c2\u6570\u91cc\u9762\u6307\u5b9a**ignore_last_failover**\u548c**wait_on_failover_error**","title":"4\u3001\u518d\u6b21\u786e\u8ba4\u4e3b\u4ece\u914d\u7f6e\u4fe1\u606f"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#5master","text":"\u5982\u679c\u5df2\u7ecf\u5728MHA\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u6307\u5b9a**master_ip_failover_script**\u6216\u8005**shutdown_script**,MHA\u8c03\u7528\u5bf9\u5e94\u7684\u811a\u672c \u6ce8\u9500\u539f\u4e3b\u4e0a\u9762\u7684VIP \u4e3a\u4e86\u907f\u514d\u539f\u4e3b\u7a81\u7136\u6062\u590d\uff0c\u9020\u6210\u8111\u88c2\uff0c\u5efa\u8bae\u5c06\u539f\u4e3b\u5173\u673a","title":"5\u3001\u5173\u95ed\u5df2\u5b95\u673aMaster\u670d\u52a1\u5668\u3010\u53ef\u9009\u3011"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#6","text":"\u5728\u5b8c\u6210\u4ee5\u4e0a\u64cd\u4f5c\u4ee5\u540e\uff0c\u5f00\u59cb\u6062\u590d\u65b0\u4e3b\u7684\u6d41\u7a0b","title":"6\u3001\u6062\u590d\u65b0\u4e3b"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#61slaveslave","text":"Master\u5b9e\u4f8b\u7684binlog\u4f4d\u70b9\u4fe1\u606f\u4f1a\u8bb0\u5f55\u5230Slave\u5b9e\u4f8b\u7684Relay-log\u4e2d\uff0cend_log_pos\u7684\u503c\u8d8a\u5927\uff0c\u8bf4\u660e\u5176\u63a5\u6536\u5230\u7684binlog\u8d8a\u591a\uff0cMHA\u5c06end_log_pos\u6700\u5927 \u503c\u7684Slave\u6807\u8bc6\u4e3a\u6700\u65b0\u7684","title":"6.1\u3001\u4ece\u6240\u6709Slave\u4e2d\u8bc6\u522b\u51fa\u6700\u65b0\u7684Slave"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#62masterbinlog","text":"\u5982\u679c\u5df2\u7ecf\u5b95\u673a\u7684Master\u8282\u70b9\u8fd8\u80fd\u901a\u8fc7ssh\u8fde\u63a5\uff0cMHA\u5c06\u6700\u65b0Slave\u7684end_log_pos\u3010Read_Master_Log_Pos\u3011\u4e00\u76f4\u5230\u6700\u540e\u7684binlog\u5185\u5b58\u4fdd\u5b58\u4e0b\u6765\uff0c\u65b9\u4fbf\u540e \u7eed\u4f7f\u7528","title":"6.2\u3001\u4ece\u5df2\u5b95\u673a\u7684MAster\u8282\u70b9\u62f7\u8d1dbinlog"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#63slave","text":"\u57fa\u4e8eMHA\u914d\u7f6e\u6587\u4ef6\u548cMySQL\u914d\u7f6e \u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u662f\u5426\u5b58\u5728**candidate_master=1**\u7684\u5b9e\u4f8b,\u8fd9\u7c7b\u5b9e\u4f8b\u4f18\u5148\u88ab\u9009\u4e3a\u4e3b \u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u662f\u5426\u5b58\u5728**no_master=1**\u7684\u5b9e\u4f8b\uff0c\u8fd9\u7c7b\u5b9e\u4f8b\u4e0d\u80fd\u88ab\u9009\u4e3a\u4e3b","title":"6.3\u3001\u4ece\u5b58\u6d3b\u7684Slave\u91cc\u9762\u9009\u51fa\u65b0\u4e3b"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#64","text":"\u4ecebinlog\u6216\u8005relaylog\u751f\u6210\u5dee\u5f02event \u5c06\u4e0a\u8ff0event\u5e94\u7528\u5230\u65b0\u4e3b \u5982\u679c\u5728\u6b64\u8fc7\u7a0b\u4e2d\u9047\u5230\u9519\u8bef\u3010eg.\u952e\u91cd\u590d\u3011,MHA\u4e2d\u65ad\u6267\u884c\uff0c\u5e76\u4e14\u540e\u7eed\u7684\u6062\u590d\u6d41\u7a0b\u4e5f\u505c\u6b62","title":"6.4\u3001\u6062\u590d\u5e76\u63d0\u5347\u4e0a\u4e00\u6b65\u9009\u51fa\u7684\u4e3b\u8282\u70b9"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#7","text":"\u5982\u679c\u5728MHA\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u6307\u5b9a**master_ip_failover_script** \uff0cMHA\u8c03\u7528\u8be5\u811a\u672c\uff1a\u5728\u811a\u672c\u91cc\u9762\u91cc\u9762\u53ef\u4ee5\u505a\u6240\u6709\u6545\u969c\u8f6c\u79fb\u7684\u540e\u7eed\u4e8b\u60c5\uff0c\u6bd4\u5982\u6fc0\u6d3bVIP\u3001\u521b\u5efa\u7279\u6743\u8d26\u53f7\u7b49","title":"7\u3001\u6fc0\u6d3b\u65b0\u4e3b"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#8","text":"\u4ecebinlog\u6216\u8005relaylog\u751f\u6210\u5dee\u5f02event\uff0c\u6b64\u6b65\u9aa4\u5728\u5269\u4f59\u7684\u4ece\u5e93\u4e0a\u5e76\u884c\u6267\u884c \u5e94\u7528\u5dee\u5f02event\u5230\u5bf9\u5e94Slave\u5b9e\u4f8b\uff0c\u6b64\u6b65\u9aa4\u5728\u5269\u4f59\u7684\u4ece\u5e93\u4e0a\u5e76\u884c\u6267\u884c \u5c06Slave\u6307\u5411\u65b0\u4e3b","title":"8\u3001\u6062\u590d\u5269\u4f59\u4ece\u5e93"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#9","text":"\u5728\u65b0\u4e3b\u4e0a\u6267\u884creset slave all,\u6e05\u7406\u6389\u539f\u6765\u7684\u4e3b\u4ece\u590d\u5236\u4fe1\u606f","title":"9\u3001\u6e05\u7406\u65b0\u4e3b"},{"location":"mysql/ha/202202/1.MHA-failover%E6%B5%81%E7%A8%8B.html#10","text":"\u5982\u679c\u5728MHA\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a**report_script**\u811a\u672c\uff0cMHA\u8c03\u7528\u6b64\u811a\u672c\u3002\u5728\u811a\u672c\u91cc\u53ef\u4ee5\u5b8c\u6210\u4ee5\u4e0b\u64cd\u4f5c: \u53d1\u9001\u90ae\u4ef6\u8c03\u6574\u6545\u969c\u8f6c\u79fb\u4fe1\u606f \u5728\u65b0\u4e3b\u4e0a\u6682\u505c\u5907\u4efd\u4efb\u52a1 \u66f4\u65b0\u5185\u90e8\u8fd0\u7ef4\u7ba1\u7406\u811a\u672c\u7684\u72b6\u6001\u7b49","title":"10\u3001\u53d1\u9001\u901a\u77e5\u3010\u53ef\u9009\u3011"},{"location":"mysql/ha/202202/2.MHA-switchover%E6%B5%81%E7%A8%8B.html","text":"MHA\u7684switchover\u6d41\u7a0b \u00b6 \u6b64\u535a\u5ba2\u6839\u636eMHA\u5b98\u65b9\u624b\u518c\u6574\u7406 \u5728\u6267\u884cswitchover\u547d\u4ee4\u7684\u65f6\u5019\uff0cMHA\u6309\u4ee5\u4e0b\u6d41\u7a0b\u6765\u5207\u6362\u4e3b\u5e93\u5230\u65b0\u7684\u6570\u636e\u5e93\u5b9e\u4f8b 1\u3001\u68c0\u67e5\u4e3b\u4ece\u8bbe\u7f6e\u548c\u8bc6\u522bMaster \u00b6 \u8fde\u63a5\u5230mha\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u6307\u5b9a\u7684\u6240\u6709\u673a\u5668\u4e0a\uff0c\u8bc6\u522b\u51fa\u4e3b\u8282\u70b9\u7684\u673a\u5668\u4fe1\u606f\u3002\u5728\u914d\u7f6eMHA\u65f6\uff0c\u65e0\u9700\u624b\u52a8\u6307\u5b9aMaster\u5b9e\u4f8b\u7684\u673a\u5668\u4fe1\u606f\u3002MHA\u5728 \u68c0\u67e5\u4e3b\u4ece\u914d\u7f6e\u7684\u540c\u65f6\uff0c\u5c06read_only=On\u7684\u5b9e\u4f8b\u6807\u8bc6\u4e3aMaster \u5728\u4e3b\u5e93\u6267\u884c FLUSH TABLES \u5237\u65b0 \u68c0\u67e5\u662f\u5426\u6709monitoring\u6216\u8005failover\u7684\u8fdb\u7a0b\u5b58\u5728 \u68c0\u67e5\u4ee5\u4e0b\u6761\u4ef6\u662f\u5426\u6ee1\u8db3\uff1a \u6240\u6709Slave\u7684IO\u7ebf\u7a0b\u6b63\u5e38\u8fd0\u884c \u6240\u6709Slave\u7684SQL\u7ebf\u7a0b\u6b63\u5e38\u8fd0\u884c \u6240\u6709Slave\u7684**Seconds_Behind_Master**\u72b6\u6001\u503c\u5c0f\u4e8e2\u79d2 \u5728\u5f53\u524d\u4e3b\u8282\u70b9\u7684 show processlist \u8f93\u51fa\u7684\u5217\u8868\u91cc\u9762\uff0c\u6ca1\u6709\u67e5\u8be2\u6267\u884c\u65f6\u95f4\u8d85\u8fc72\u79d2 2\u3001\u9009\u51fa\u65b0\u4e3b \u00b6 \u53ef\u4ee5\u901a\u8fc7 --new_master_host \u547d\u4ee4\u884c\u53c2\u6570\u663e\u5f0f\u6307\u5b9a\u65b0\u4e3b\uff1b\u5982\u679c\u6ca1\u6709\u663e\u5f0f\u6307\u5b9a\u7684\u8bdd\uff0cMHA\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u81ea\u52a8\u9009\u51fa\u65b0\u4e3b \u539f\u4e3b\u548c\u65b0\u4e3b\u5fc5\u987b\u786e\u4fddbinlog\u8fc7\u6ee4\u89c4\u5219\u4e00\u81f4\uff0c(binlog-do-db and binlog-ignore-db) 3\u3001\u539f\u4e3b\u62d2\u7edd\u5199\u5165 \u00b6 \u5982\u679c\u5728MHA\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u5b9a\u4e49 master_ip_online_change_script ,MHA\u8c03\u7528\u6307\u5b9a\u7684\u811a\u672c\uff1a\u53ef\u4ee5\u5728\u811a\u672c\u91cc\u9762\u79fb\u9664\u53ef\u8bfb\u5199\u8d26\u53f7\uff0c\u6216\u8005 set global read_only=on \u5728\u539f\u4e3b\u6267\u884c FLUSH TABLES WITH READ LOCK \u9501\u5b9a\u6574\u4e2a\u5b9e\u4f8b\u6765\u963b\u6b62\u6570\u636e\u5199\u5165\u3002\u4e5f\u53ef\u4ee5\u8bbe\u7f6e --skip_lock_all_tables \u53c2\u6570\u8df3\u8fc7\u6b64\u6b65\u9aa4 4\u3001\u7b49\u65b0\u4e3b\u8ffd\u5e73\u6570\u636e \u00b6 \u5728\u539f\u4e3b\u62d2\u7edd\u5199\u5165\u540e\uff0c\u901a\u8fc7 SHOW MASTER STATUS \u62ff\u5230\u6700\u65b0\u7684binlog\u4f4d\u70b9\uff0c\u901a\u8fc7 MASTER_LOG_POS() \u6765\u5224\u65ad\u65b0\u4e3b\u662f\u5426\u8ffd\u5e73\u6570\u636e\u3002 5\u3001\u5728\u65b0\u4e3b\u5f00\u542f\u8bfb\u5199 \u00b6 \u5728\u65b0\u4e3b\u4e0a\u6267\u884c SHOW MASTER STATUS \u83b7\u53d6\u5230binlog\u4f4d\u70b9\uff0c\u65b9\u4fbf\u540e\u7eed\u91cd\u5b9a\u5411\u5269\u4f59\u4ece\u5e93\u548c\u539f\u4e3b \u5982\u679c\u5728MHA\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u5b9a\u4e49 master_ip_online_change_script ,MHA\u8c03\u7528\u6307\u5b9a\u7684\u811a\u672c\uff1a\u53ef\u4ee5\u5728\u811a\u672c\u91cc\u9762\u521b\u5efa\u8bfb\u5199\u8d26\u53f7\u3001\u6302\u8f7dVIP\u3001\u6216\u8005 set global read_only=off 6\u3001\u91cd\u4ece\u5e93\u65b0\u6307\u5411\u65b0\u4e3b \u00b6 \u6839\u636e\u6b65\u9aa45\u83b7\u53d6\u7684\u4f4d\u70b9\u4fe1\u606f\uff0c\u5728\u5176\u4ed6\u4ece\u5e93\u4e0a\u5e76\u884c\u6267\u884c CHANGE MASTER \u548c START SLAVE \u91cd\u5b9a\u5411\u5b8c\u6240\u6709\u4ece\u5e93\u4ee5\u540e\uff0c\u5728\u539f\u4e3b\u4e0a\u6267\u884c RESET SLAVE ALL \u6e05\u7406\u539f\u6765\u7684\u4e3b\u4ece\u4fe1\u606f \u5728\u539f\u4e3b\u4e0a\u6267\u884c CHANGE MASTER \u548c START SLAVE \uff0c\u5c06\u539f\u4e3b\u5207\u6362\u4e3a\u4ece\u5e93","title":"2.MHA switchover\u6d41\u7a0b"},{"location":"mysql/ha/202202/2.MHA-switchover%E6%B5%81%E7%A8%8B.html#mhaswitchover","text":"\u6b64\u535a\u5ba2\u6839\u636eMHA\u5b98\u65b9\u624b\u518c\u6574\u7406 \u5728\u6267\u884cswitchover\u547d\u4ee4\u7684\u65f6\u5019\uff0cMHA\u6309\u4ee5\u4e0b\u6d41\u7a0b\u6765\u5207\u6362\u4e3b\u5e93\u5230\u65b0\u7684\u6570\u636e\u5e93\u5b9e\u4f8b","title":"MHA\u7684switchover\u6d41\u7a0b"},{"location":"mysql/ha/202202/2.MHA-switchover%E6%B5%81%E7%A8%8B.html#1master","text":"\u8fde\u63a5\u5230mha\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u6307\u5b9a\u7684\u6240\u6709\u673a\u5668\u4e0a\uff0c\u8bc6\u522b\u51fa\u4e3b\u8282\u70b9\u7684\u673a\u5668\u4fe1\u606f\u3002\u5728\u914d\u7f6eMHA\u65f6\uff0c\u65e0\u9700\u624b\u52a8\u6307\u5b9aMaster\u5b9e\u4f8b\u7684\u673a\u5668\u4fe1\u606f\u3002MHA\u5728 \u68c0\u67e5\u4e3b\u4ece\u914d\u7f6e\u7684\u540c\u65f6\uff0c\u5c06read_only=On\u7684\u5b9e\u4f8b\u6807\u8bc6\u4e3aMaster \u5728\u4e3b\u5e93\u6267\u884c FLUSH TABLES \u5237\u65b0 \u68c0\u67e5\u662f\u5426\u6709monitoring\u6216\u8005failover\u7684\u8fdb\u7a0b\u5b58\u5728 \u68c0\u67e5\u4ee5\u4e0b\u6761\u4ef6\u662f\u5426\u6ee1\u8db3\uff1a \u6240\u6709Slave\u7684IO\u7ebf\u7a0b\u6b63\u5e38\u8fd0\u884c \u6240\u6709Slave\u7684SQL\u7ebf\u7a0b\u6b63\u5e38\u8fd0\u884c \u6240\u6709Slave\u7684**Seconds_Behind_Master**\u72b6\u6001\u503c\u5c0f\u4e8e2\u79d2 \u5728\u5f53\u524d\u4e3b\u8282\u70b9\u7684 show processlist \u8f93\u51fa\u7684\u5217\u8868\u91cc\u9762\uff0c\u6ca1\u6709\u67e5\u8be2\u6267\u884c\u65f6\u95f4\u8d85\u8fc72\u79d2","title":"1\u3001\u68c0\u67e5\u4e3b\u4ece\u8bbe\u7f6e\u548c\u8bc6\u522bMaster"},{"location":"mysql/ha/202202/2.MHA-switchover%E6%B5%81%E7%A8%8B.html#2","text":"\u53ef\u4ee5\u901a\u8fc7 --new_master_host \u547d\u4ee4\u884c\u53c2\u6570\u663e\u5f0f\u6307\u5b9a\u65b0\u4e3b\uff1b\u5982\u679c\u6ca1\u6709\u663e\u5f0f\u6307\u5b9a\u7684\u8bdd\uff0cMHA\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u81ea\u52a8\u9009\u51fa\u65b0\u4e3b \u539f\u4e3b\u548c\u65b0\u4e3b\u5fc5\u987b\u786e\u4fddbinlog\u8fc7\u6ee4\u89c4\u5219\u4e00\u81f4\uff0c(binlog-do-db and binlog-ignore-db)","title":"2\u3001\u9009\u51fa\u65b0\u4e3b"},{"location":"mysql/ha/202202/2.MHA-switchover%E6%B5%81%E7%A8%8B.html#3","text":"\u5982\u679c\u5728MHA\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u5b9a\u4e49 master_ip_online_change_script ,MHA\u8c03\u7528\u6307\u5b9a\u7684\u811a\u672c\uff1a\u53ef\u4ee5\u5728\u811a\u672c\u91cc\u9762\u79fb\u9664\u53ef\u8bfb\u5199\u8d26\u53f7\uff0c\u6216\u8005 set global read_only=on \u5728\u539f\u4e3b\u6267\u884c FLUSH TABLES WITH READ LOCK \u9501\u5b9a\u6574\u4e2a\u5b9e\u4f8b\u6765\u963b\u6b62\u6570\u636e\u5199\u5165\u3002\u4e5f\u53ef\u4ee5\u8bbe\u7f6e --skip_lock_all_tables \u53c2\u6570\u8df3\u8fc7\u6b64\u6b65\u9aa4","title":"3\u3001\u539f\u4e3b\u62d2\u7edd\u5199\u5165"},{"location":"mysql/ha/202202/2.MHA-switchover%E6%B5%81%E7%A8%8B.html#4","text":"\u5728\u539f\u4e3b\u62d2\u7edd\u5199\u5165\u540e\uff0c\u901a\u8fc7 SHOW MASTER STATUS \u62ff\u5230\u6700\u65b0\u7684binlog\u4f4d\u70b9\uff0c\u901a\u8fc7 MASTER_LOG_POS() \u6765\u5224\u65ad\u65b0\u4e3b\u662f\u5426\u8ffd\u5e73\u6570\u636e\u3002","title":"4\u3001\u7b49\u65b0\u4e3b\u8ffd\u5e73\u6570\u636e"},{"location":"mysql/ha/202202/2.MHA-switchover%E6%B5%81%E7%A8%8B.html#5","text":"\u5728\u65b0\u4e3b\u4e0a\u6267\u884c SHOW MASTER STATUS \u83b7\u53d6\u5230binlog\u4f4d\u70b9\uff0c\u65b9\u4fbf\u540e\u7eed\u91cd\u5b9a\u5411\u5269\u4f59\u4ece\u5e93\u548c\u539f\u4e3b \u5982\u679c\u5728MHA\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u5b9a\u4e49 master_ip_online_change_script ,MHA\u8c03\u7528\u6307\u5b9a\u7684\u811a\u672c\uff1a\u53ef\u4ee5\u5728\u811a\u672c\u91cc\u9762\u521b\u5efa\u8bfb\u5199\u8d26\u53f7\u3001\u6302\u8f7dVIP\u3001\u6216\u8005 set global read_only=off","title":"5\u3001\u5728\u65b0\u4e3b\u5f00\u542f\u8bfb\u5199"},{"location":"mysql/ha/202202/2.MHA-switchover%E6%B5%81%E7%A8%8B.html#6","text":"\u6839\u636e\u6b65\u9aa45\u83b7\u53d6\u7684\u4f4d\u70b9\u4fe1\u606f\uff0c\u5728\u5176\u4ed6\u4ece\u5e93\u4e0a\u5e76\u884c\u6267\u884c CHANGE MASTER \u548c START SLAVE \u91cd\u5b9a\u5411\u5b8c\u6240\u6709\u4ece\u5e93\u4ee5\u540e\uff0c\u5728\u539f\u4e3b\u4e0a\u6267\u884c RESET SLAVE ALL \u6e05\u7406\u539f\u6765\u7684\u4e3b\u4ece\u4fe1\u606f \u5728\u539f\u4e3b\u4e0a\u6267\u884c CHANGE MASTER \u548c START SLAVE \uff0c\u5c06\u539f\u4e3b\u5207\u6362\u4e3a\u4ece\u5e93","title":"6\u3001\u91cd\u4ece\u5e93\u65b0\u6307\u5411\u65b0\u4e3b"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html","text":"\u6570\u636e\u5e93\u6269\u5c55\u6700\u4f73\u5b9e\u8df5 \u00b6 \u6b64\u535a\u5ba2\u6574\u7406\u81eaSeveralnines\uff0c\u5355\u51fb\u67e5\u770b\u539f\u6587 \u5728\u6267\u884cswitchover\u547d\u4ee4\u7684\u65f6\u5019\uff0cMHA\u6309\u4ee5\u4e0b\u6d41\u7a0b\u6765\u5207\u6362\u4e3b\u5e93\u5230\u65b0\u7684\u6570\u636e\u5e93\u5b9e\u4f8b 1\u3001\u4e3a\u4ec0\u4e48\u9700\u8981\u6269\u5c55 \u00b6 1.1\u3001\u786c\u4ef6\u8d44\u6e90\u6d88\u8017\u589e\u957f \u00b6 \u8fde\u63a5\u5230mha\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u6307\u5b9a\u7684\u6240\u6709\u673a\u5668\u4e0a\uff0c\u8bc6\u522b\u51fa\u4e3b\u8282\u70b9\u7684\u673a\u5668\u4fe1\u606f\u3002\u5728\u914d\u7f6eMHA\u65f6\uff0c\u65e0\u9700\u624b\u52a8\u6307\u5b9aMaster\u5b9e\u4f8b\u7684\u673a\u5668\u4fe1\u606f\u3002MHA\u5728 1.2\u3001\u5de5\u4f5c\u8d1f\u8f7d\u7a81\u7136\u589e\u957f \u00b6 1.3\u3001\u6709\u8ba1\u5212\u7684\u8fd0\u7ef4 \u00b6 2\u3001\u6269\u5c55\u65b9\u5f0f \u00b6 \u76ee\u524d\u4e3b\u8981\u6709\u4e24\u79cd\u6269\u5c55\u65b9\u5f0f\uff0c\u5206\u522b\u4e3a**\u5782\u76f4\u6269\u5c55**\u548c**\u6c34\u5e73\u6269\u5c55**\u3002\u6bcf\u4e00\u79cd\u6269\u5c55\u65b9\u5f0f\u90fd\u6709\u5176\u4f18\u52bf\u548c\u52a3\u52bf\uff0c\u5206\u522b\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u573a\u666f\uff0c\u63a5\u4e0b\u6765\u5c06\u5206\u522b \u4ecb\u7ecd\u3002 2.1\u3001\u5782\u76f4\u6269\u5c55 \u00b6 \u53ef\u4ee5\u901a\u8fc7 --new_master_host \u547d\u4ee4\u884c\u53c2\u6570\u663e\u5f0f\u6307\u5b9a\u65b0\u4e3b\uff1b\u5982\u679c\u6ca1\u6709\u663e\u5f0f\u6307\u5b9a\u7684\u8bdd\uff0cMHA\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u81ea\u52a8\u9009\u51fa\u65b0\u4e3b 2.1.1\u3001\u5782\u76f4\u6269\u5c55\u7684\u4f18\u52bf \u00b6 \u539f\u4e3b\u548c\u65b0\u4e3b\u5fc5\u987b\u786e\u4fddbinlog\u8fc7\u6ee4\u89c4\u5219\u4e00\u81f4\uff0c(binlog-do-db and binlog-ignore-db) 2.1.1\u3001\u5782\u76f4\u6269\u5c55\u7684\u52a3\u52bf \u00b6 2.2\u3001\u6c34\u5e73\u6269\u5c55 \u00b6 \u53ef\u4ee5\u901a\u8fc7 --new_master_host \u547d\u4ee4\u884c\u53c2\u6570\u663e\u5f0f\u6307\u5b9a\u65b0\u4e3b\uff1b\u5982\u679c\u6ca1\u6709\u663e\u5f0f\u6307\u5b9a\u7684\u8bdd\uff0cMHA\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u81ea\u52a8\u9009\u51fa\u65b0\u4e3b 2.2.1\u3001\u6c34\u5e73\u6269\u5c55\u7684\u4f18\u52bf \u00b6 \u539f\u4e3b\u548c\u65b0\u4e3b\u5fc5\u987b\u786e\u4fddbinlog\u8fc7\u6ee4\u89c4\u5219\u4e00\u81f4\uff0c(binlog-do-db and binlog-ignore-db) 2.2.1\u3001\u6c34\u5e73\u6269\u5c55\u7684\u52a3\u52bf \u00b6 3\u3001\u6269\u5c55\u7684\u524d\u63d0\u6761\u4ef6 \u00b6 3.1\u3001\u6570\u636e\u590d\u5236 \u00b6 \u5982\u679c\u5728MHA\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u5b9a\u4e49 master_ip_online_change_script ,MHA\u8c03\u7528\u6307\u5b9a\u7684\u811a\u672c\uff1a\u53ef\u4ee5\u5728\u811a\u672c\u91cc\u9762\u79fb\u9664\u53ef\u8bfb\u5199\u8d26\u53f7\uff0c\u6216\u8005 set global read_only=on \u5728\u539f\u4e3b\u6267\u884c FLUSH TABLES WITH READ LOCK \u9501\u5b9a\u6574\u4e2a\u5b9e\u4f8b\u6765\u963b\u6b62\u6570\u636e\u5199\u5165\u3002\u4e5f\u53ef\u4ee5\u8bbe\u7f6e --skip_lock_all_tables \u53c2\u6570\u8df3\u8fc7\u6b64\u6b65\u9aa4 3.2\u3001\u8d1f\u8f7d\u5747\u8861\u548c\u8bfb\u3001\u5199\u5206\u79bb \u00b6 3.2.1\u3001\u5e94\u7528\u5c42\u8bfb\u5199\u5206\u79bb \u00b6 3.2.2\u3001\u8fde\u63a5\u5668\u5c42\u8bfb\u5199\u5206\u79bb \u00b6 3.2.3\u3001\u8d1f\u8f7d\u5747\u8861\u5c42\u8bfb\u5199\u5206\u79bb \u00b6","title":"3.\u6570\u636e\u5e93\u6269\u5c55\u6700\u4f73\u5b9e\u8df5"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#_1","text":"\u6b64\u535a\u5ba2\u6574\u7406\u81eaSeveralnines\uff0c\u5355\u51fb\u67e5\u770b\u539f\u6587 \u5728\u6267\u884cswitchover\u547d\u4ee4\u7684\u65f6\u5019\uff0cMHA\u6309\u4ee5\u4e0b\u6d41\u7a0b\u6765\u5207\u6362\u4e3b\u5e93\u5230\u65b0\u7684\u6570\u636e\u5e93\u5b9e\u4f8b","title":"\u6570\u636e\u5e93\u6269\u5c55\u6700\u4f73\u5b9e\u8df5"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#1","text":"","title":"1\u3001\u4e3a\u4ec0\u4e48\u9700\u8981\u6269\u5c55"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#11","text":"\u8fde\u63a5\u5230mha\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u6307\u5b9a\u7684\u6240\u6709\u673a\u5668\u4e0a\uff0c\u8bc6\u522b\u51fa\u4e3b\u8282\u70b9\u7684\u673a\u5668\u4fe1\u606f\u3002\u5728\u914d\u7f6eMHA\u65f6\uff0c\u65e0\u9700\u624b\u52a8\u6307\u5b9aMaster\u5b9e\u4f8b\u7684\u673a\u5668\u4fe1\u606f\u3002MHA\u5728","title":"1.1\u3001\u786c\u4ef6\u8d44\u6e90\u6d88\u8017\u589e\u957f"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#12","text":"","title":"1.2\u3001\u5de5\u4f5c\u8d1f\u8f7d\u7a81\u7136\u589e\u957f"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#13","text":"","title":"1.3\u3001\u6709\u8ba1\u5212\u7684\u8fd0\u7ef4"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#2","text":"\u76ee\u524d\u4e3b\u8981\u6709\u4e24\u79cd\u6269\u5c55\u65b9\u5f0f\uff0c\u5206\u522b\u4e3a**\u5782\u76f4\u6269\u5c55**\u548c**\u6c34\u5e73\u6269\u5c55**\u3002\u6bcf\u4e00\u79cd\u6269\u5c55\u65b9\u5f0f\u90fd\u6709\u5176\u4f18\u52bf\u548c\u52a3\u52bf\uff0c\u5206\u522b\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u573a\u666f\uff0c\u63a5\u4e0b\u6765\u5c06\u5206\u522b \u4ecb\u7ecd\u3002","title":"2\u3001\u6269\u5c55\u65b9\u5f0f"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#21","text":"\u53ef\u4ee5\u901a\u8fc7 --new_master_host \u547d\u4ee4\u884c\u53c2\u6570\u663e\u5f0f\u6307\u5b9a\u65b0\u4e3b\uff1b\u5982\u679c\u6ca1\u6709\u663e\u5f0f\u6307\u5b9a\u7684\u8bdd\uff0cMHA\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u81ea\u52a8\u9009\u51fa\u65b0\u4e3b","title":"2.1\u3001\u5782\u76f4\u6269\u5c55"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#211","text":"\u539f\u4e3b\u548c\u65b0\u4e3b\u5fc5\u987b\u786e\u4fddbinlog\u8fc7\u6ee4\u89c4\u5219\u4e00\u81f4\uff0c(binlog-do-db and binlog-ignore-db)","title":"2.1.1\u3001\u5782\u76f4\u6269\u5c55\u7684\u4f18\u52bf"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#211_1","text":"","title":"2.1.1\u3001\u5782\u76f4\u6269\u5c55\u7684\u52a3\u52bf"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#22","text":"\u53ef\u4ee5\u901a\u8fc7 --new_master_host \u547d\u4ee4\u884c\u53c2\u6570\u663e\u5f0f\u6307\u5b9a\u65b0\u4e3b\uff1b\u5982\u679c\u6ca1\u6709\u663e\u5f0f\u6307\u5b9a\u7684\u8bdd\uff0cMHA\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u81ea\u52a8\u9009\u51fa\u65b0\u4e3b","title":"2.2\u3001\u6c34\u5e73\u6269\u5c55"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#221","text":"\u539f\u4e3b\u548c\u65b0\u4e3b\u5fc5\u987b\u786e\u4fddbinlog\u8fc7\u6ee4\u89c4\u5219\u4e00\u81f4\uff0c(binlog-do-db and binlog-ignore-db)","title":"2.2.1\u3001\u6c34\u5e73\u6269\u5c55\u7684\u4f18\u52bf"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#221_1","text":"","title":"2.2.1\u3001\u6c34\u5e73\u6269\u5c55\u7684\u52a3\u52bf"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#3","text":"","title":"3\u3001\u6269\u5c55\u7684\u524d\u63d0\u6761\u4ef6"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#31","text":"\u5982\u679c\u5728MHA\u914d\u7f6e\u6587\u4ef6\u91cc\u9762\u5b9a\u4e49 master_ip_online_change_script ,MHA\u8c03\u7528\u6307\u5b9a\u7684\u811a\u672c\uff1a\u53ef\u4ee5\u5728\u811a\u672c\u91cc\u9762\u79fb\u9664\u53ef\u8bfb\u5199\u8d26\u53f7\uff0c\u6216\u8005 set global read_only=on \u5728\u539f\u4e3b\u6267\u884c FLUSH TABLES WITH READ LOCK \u9501\u5b9a\u6574\u4e2a\u5b9e\u4f8b\u6765\u963b\u6b62\u6570\u636e\u5199\u5165\u3002\u4e5f\u53ef\u4ee5\u8bbe\u7f6e --skip_lock_all_tables \u53c2\u6570\u8df3\u8fc7\u6b64\u6b65\u9aa4","title":"3.1\u3001\u6570\u636e\u590d\u5236"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#32","text":"","title":"3.2\u3001\u8d1f\u8f7d\u5747\u8861\u548c\u8bfb\u3001\u5199\u5206\u79bb"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#321","text":"","title":"3.2.1\u3001\u5e94\u7528\u5c42\u8bfb\u5199\u5206\u79bb"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#322","text":"","title":"3.2.2\u3001\u8fde\u63a5\u5668\u5c42\u8bfb\u5199\u5206\u79bb"},{"location":"mysql/ha/202202/3.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5.html#323","text":"","title":"3.2.3\u3001\u8d1f\u8f7d\u5747\u8861\u5c42\u8bfb\u5199\u5206\u79bb"},{"location":"mysql/ha/202202/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E7%BB%AD.html","text":"\u6570\u636e\u5e93\u6269\u5c55\u6700\u4f73\u5b9e\u8df5-\u7eed \u00b6 \u6b64\u535a\u5ba2\u7ffb\u8bd1\u81eaSeveralnines\uff0c\u5355\u51fb\u67e5\u770b\u539f\u6587 \u5728\u6267\u884cswitchover\u547d\u4ee4\u7684\u65f6\u5019\uff0cMHA\u6309\u4ee5\u4e0b\u6d41\u7a0b\u6765\u5207\u6362\u4e3b\u5e93\u5230\u65b0\u7684\u6570\u636e\u5e93\u5b9e\u4f8b 1\u3001\u6a2a\u5411\u6269\u5c55\u9762\u4e34\u7684\u6311\u6218 \u00b6 1.1\u3001\u6709\u72b6\u6001\u670d\u52a1 \u00b6 1.2\u3001\u6a2a\u5411\u6269\u5c55\u8017\u65f6 \u00b6 1.3\u3001\u6a2a\u5411\u6269\u5c55\u7684\u989d\u5916\u8d1f\u8f7d \u00b6 1.4\u3001\u6269\u5c55\u5199\u7684\u65b9\u5f0f \u00b6 2\u3001\u5982\u4f55\u6a2a\u5411\u6269\u5c55\u6570\u636e\u5e93 \u00b6 \u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u4e86\u6a2a\u5411\u6269\u5c55\u5c06\u4f1a\u9762\u4e34\u7684\u6311\u6218\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u54ea\u4e9b\u65b9\u5f0f\u53bb\u5b9e\u73b0\u5462\uff1f\u5982\u4f55\u6a2a\u5411\u6269\u5c55\u6570\u636e\u5e93\uff1f 2.1\u3001\u6dfb\u52a0\u4ece\u5e93 \u00b6 2.2\u3001\u6570\u636e\u5206\u7247 \u00b6 \u53ef\u4ee5\u901a\u8fc7 --new_master_host \u547d\u4ee4\u884c\u53c2\u6570\u663e\u5f0f\u6307\u5b9a\u65b0\u4e3b\uff1b\u5982\u679c\u6ca1\u6709\u663e\u5f0f\u6307\u5b9a\u7684\u8bdd\uff0cMHA\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u81ea\u52a8\u9009\u51fa\u65b0\u4e3b","title":"4.\u6570\u636e\u5e93\u6269\u5c55\u6700\u4f73\u5b9e\u8df5 \u7eed"},{"location":"mysql/ha/202202/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E7%BB%AD.html#-","text":"\u6b64\u535a\u5ba2\u7ffb\u8bd1\u81eaSeveralnines\uff0c\u5355\u51fb\u67e5\u770b\u539f\u6587 \u5728\u6267\u884cswitchover\u547d\u4ee4\u7684\u65f6\u5019\uff0cMHA\u6309\u4ee5\u4e0b\u6d41\u7a0b\u6765\u5207\u6362\u4e3b\u5e93\u5230\u65b0\u7684\u6570\u636e\u5e93\u5b9e\u4f8b","title":"\u6570\u636e\u5e93\u6269\u5c55\u6700\u4f73\u5b9e\u8df5-\u7eed"},{"location":"mysql/ha/202202/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E7%BB%AD.html#1","text":"","title":"1\u3001\u6a2a\u5411\u6269\u5c55\u9762\u4e34\u7684\u6311\u6218"},{"location":"mysql/ha/202202/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E7%BB%AD.html#11","text":"","title":"1.1\u3001\u6709\u72b6\u6001\u670d\u52a1"},{"location":"mysql/ha/202202/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E7%BB%AD.html#12","text":"","title":"1.2\u3001\u6a2a\u5411\u6269\u5c55\u8017\u65f6"},{"location":"mysql/ha/202202/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E7%BB%AD.html#13","text":"","title":"1.3\u3001\u6a2a\u5411\u6269\u5c55\u7684\u989d\u5916\u8d1f\u8f7d"},{"location":"mysql/ha/202202/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E7%BB%AD.html#14","text":"","title":"1.4\u3001\u6269\u5c55\u5199\u7684\u65b9\u5f0f"},{"location":"mysql/ha/202202/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E7%BB%AD.html#2","text":"\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u4e86\u6a2a\u5411\u6269\u5c55\u5c06\u4f1a\u9762\u4e34\u7684\u6311\u6218\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u54ea\u4e9b\u65b9\u5f0f\u53bb\u5b9e\u73b0\u5462\uff1f\u5982\u4f55\u6a2a\u5411\u6269\u5c55\u6570\u636e\u5e93\uff1f","title":"2\u3001\u5982\u4f55\u6a2a\u5411\u6269\u5c55\u6570\u636e\u5e93"},{"location":"mysql/ha/202202/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E7%BB%AD.html#21","text":"","title":"2.1\u3001\u6dfb\u52a0\u4ece\u5e93"},{"location":"mysql/ha/202202/4.%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-%E7%BB%AD.html#22","text":"\u53ef\u4ee5\u901a\u8fc7 --new_master_host \u547d\u4ee4\u884c\u53c2\u6570\u663e\u5f0f\u6307\u5b9a\u65b0\u4e3b\uff1b\u5982\u679c\u6ca1\u6709\u663e\u5f0f\u6307\u5b9a\u7684\u8bdd\uff0cMHA\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u81ea\u52a8\u9009\u51fa\u65b0\u4e3b","title":"2.2\u3001\u6570\u636e\u5206\u7247"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html","text":"MySQL semi-sync replication: durability, consistency and split brains \u00b6 \u6587\u7ae0\u6765\u81eaPlantscale\u535a\u5ba2\u5e73\u53f0\uff0c \u5355\u51fb\u67e5\u770b\u539f\u6587 MySQL semi-sync is a plugin mechanism on top of asynchronous replication, that can offer better durability and even consistency (term defined later). It helps in high availability solutions, but can in itself reduce availability. We look at some basics and follow up to present scenarios that require higher level intervention to ensure availability and to avoid split brains from taking place. I recommend reading this semi-sync blog post by Jean-Fran\u00e7ois Gagn\u00e9 (aka JFG), which illustrates the internals of the semi-sync implementation, and debunks some myths about semi-sync. We will overlap a bit with another recommended post by JFG, about high availability and recovery . Note: in this post we adopt the term \u201cprimary\u201d over the term \u201cmaster\u201d in the context of MySQL replication. However, at this time there is no alternative to using the actual names of some configuration and status variables that use \u201cmaster\u201d terminology, and some duality is present. Overview \u00b6 As quick recap, semi-synchronous replication is a mechanism where a commit on the primary does not apply the change onto internal table data and does not respond to the user, until the changelog is guaranteed to have been persisted (though not necessarily applied) on a preconfigured number of replicas. We limit our discussion to MySQL 5.7 or equivalent. Specifically, the primary is configured with rpl_semi_sync_master_wait_for_slave_count, which is 1 or above, if semi-sync is to be used. An INSERT transaction, for example, will not report being committed (i.e. the user will not get \u201cOK\u201d) until at least that number of replicas have acknowledged receipt of that transaction\u2019s changelog (entries in the binary log). In practice, this means at least that number of replicas have written the changelog onto their relay logs where the change is now persisted. The replicas will apply the change later on, normally as soon as they can. For the scope of this post, we assume replicas are not intentionally stopped, and we can also ignore delayed replicas. The primary waits up to rpl_semi_sync_master_timeout, after which it falls back to asynchronous replication mode, committing and responding to the user even if not all expected replicas have acknowledged receipt. In the scope of this post, we are interested in an \u201cinfinite\u201d timeout, which we will accept to be a very large number. The only replicas to acknowledge receipt of the changelog are replicas where semi-sync is enabled. There could be other, non semi-sync replicas in our topology. They, too, pull the changelog from the primary, but do not acknowledge receipt. As JFG points out in his post, the semi-sync replicas aren\u2019t necessarily the most up to date. It\u2019s possible that a non-semi-sync replica has pulled more changelog data than some or all semi-sync replicas. Durability \u00b6 The most straightforward use case for semi-sync is to guarantee durability of the data. We only approve a commit once the transaction (in the form of a changelog) is persisted elsewhere, on a different server, or on multiple servers. As mentioned earlier, this does not mean the changelog has been applied on those servers. Replication may be lagging and the servers may be too busy to be able to apply the changelog in a timely fashion. But, at the very least, if the primary crashes, there\u2019s \u201cforensic evidence\u201d in the relay logs of a semi-sync replica that can tell us what the latest changes were. Consistency \u00b6 The term \u201cconsistency\u201d is overloaded, and especially in distributed systems. The CAP Theorem definition of consistency is, for example, very strict: once data was written on one server, any immediate follow-up read on any other server must reflect that write (or any later write). We will suffice with eventual consistency. This in itself an overloaded term, so let\u2019s clarify: in the case of a primary outage, we consider our system consistent if we\u2019re able to promote a new primary within any amount of time (obviously in practice we expect the time to be short) such that it is consistent with the previous primary\u2019s advertised state. I write \u201cadvertised\u201d state because the end user or applications should not be surprised by any data changes when the new primary is promoted, regardless of how transactions/replication work internally. Split brain \u00b6 A split brain is a situation where there are two servers which are simultaneously taking writes, each thinking they\u2019re the (single) primary. In a split brain scenario the data diverges between the two servers. If those servers also have replicas, then we have two divergent replication trees. Fixing and merging those divergent trees is difficult, and normally we revert the changes on one to make it look like the other (whether by backup+restore or by some rollback method). Reiterating JFG\u2019s observation that while engineers normally frown upon split brains, the damage of split brain may well be within a product\u2019s allowance. Topologies and scenarios As always, getting best durability as possible, best consistency as possible, best response times as possible, best split brain mitigation as possible, is costly. Product owners and engineers make reasonable tradeoffs. Let\u2019s consider a few configured topologies, and see what scenarios we can expect upon failure. In particular, how durable our data is, can we expect it to be consistent, and can we expect split brains. General scenario: wait for single replica, multiple semi-sync replicas \u00b6 In this common scenario our primary is configured with rpl_semi_sync_master_wait_for_slave_count=1, and there are multiple (more than one) replicas configured with semi-sync. Let\u2019s say there are 4 semi-sync replicas, named R1, R2, R3, and R4. We nickname this setup \u201c1-n\u201d In this setup, a write takes place on the primary, and before approving the write to the user/app, the primary waits for an acknowledgement from exactly one replica. It doesn\u2019t matter which. For some writes, it will be replica R1; at some other time, R4 is the first to acknowledge. It\u2019s important to note that the changelog, the binary log, is sequential. A replica that acknowledges some changelog event, has necessarily received all of its prior events. This is why the primary doesn\u2019t need to care that different acknowledgements come from different replicas. An acknowledgement means there\u2019s a replica with full durability of committed transactions up to and including the one in question. Should the primary fail, we have at least one replica guaranteed to have all approved commits in its relay logs. These are not necessarily applied, but if our replication cluster is normally low-lagged, we can expect those commits to be few, and we can expect the replica to catch up (apply those commits) within a few seconds or less. A possible situation is that there may be non-semi-sync replicas even more up to date than our semi-sync replica. We can choose to use them. The fact they have more transactions than the most up-to-date semi sync replica means they have received binary log events not acknowledged by a semi-sync replica. While this may seem confusing at first, these are fine to accept, and do not contradict our promise to our users. We promised that \u201cif the primary tells you a commit is successful, then the data is durable elsewhere\u201d. We never said anything about the state of the data before telling the user the commit is successful. In fact, this scenario is no different than the primary actually getting a commit acknowledged by the replica, begins to communicate that to the user, then crashing halfway. The user cannot distinguish between the two cases at the time of failure (though post crash analysis may indicate which of the two was true). And so we can choose to use the data from that even-more-up-to-date non-semi-sync replica, seed the rest of the replicas with that data, or, we can choose to throw away any server that is more-up-to-date than our most-up-to-date semi-sync replica and recycle them. It\u2019s our choice and it\u2019s down to operational considerations (time, capacity, load, ...). If data is durable, does that mean it\u2019s available? \u00b6 Not necessarily. Consider this possible, even likely scenario: the primary and R1 are both in the same data center. R2, R3, R4 are in different availability zones, possibly remote, and so have higher latency than R1 communicating to the primary. The app issues an UPDATE on the primary. R1 acknowledges the write. R2, R3, R4 do not, as yet. But the primary does not care, it commits and reports success to the app. Then the primary and R1 both get network isolated together because the DC they\u2019re in has lost network. The loss of network cut short the delivery of the change log to R2, R3, R4. They never got it. Should we promote either R2, R3, or R4, we lose consistency. The app expects the result of that UPDATE to be there, but neither of these servers have the data. Moreover, even human intervention is limited. Since the data is only found on primary and R1, we cannot get hold of the data. A human can always transport to the physical server to extract the data and send it over via cellular network, or even by car. It\u2019s likely that this will take substantial time. A predefined failover plan may choose to promote, say, R2, after all, losing some data, but cutting short on outage time. Reconciliation will have to take place afterwards. Do we even know the status? \u00b6 If the primary and one of the semi-sync replicas go offline, we have an additional problem: we can\u2019t say for sure whether any of the remaining semi-sync replicas got the latest updates from the primary. It\u2019s possible that they did. But it\u2019s also possible that the single semi-sync replica that went offline, was the single one to get and acknowledge some last writes taking place on the primary. To generalize, if the number of lost semi-sync replicas is equal to, or greater than rpl_semi_sync_master_wait_for_slave_count, then we do not know whether the remaining replicas are consistent. Split brain \u00b6 But, arguably worse, is that we can now be in a split brain situation. Apps in the primary datacenter were still writing to the old primary when the network went down. Those writes continued to run. The old primary now receives writes never seen by R2 (the newly promoted primary). Once we do wish to reconcile, we are faced with contradicting information. Physical locations \u00b6 The geo-distribution of our servers plays a key part in how tolerant our system is for failure and what outcomes we can expect. Colocated primary and semi-sync replicas \u00b6 On a normal day, writes to the primary have low latency: acknowledgements from semi-sync replicas are quick to arrive thanks to the fast network within a datacenter. When the primary fails, we have at least one good semi-sync replica to promote (or we can use it to seed a different server to promote). Because we promote within the same datacenter, app behavior is unlikely to be affected, other than the obvious disruption during the failover time. If the datacenter is network-isolated, we need to make a decision: wait out the outage, incurring downtime to our services, or promote a new primary in another datacenter. We risk losing transactions (we cannot know whether we lose transactions until we are again able to connect to the original primary). We also risk a split brain scenario. Cross-site semi-sync replication \u00b6 If we only run semi-sync replicas in a different datacenter than the primary\u2019s, we first pay with increased write latency, as each commit runs a roundtrip outside the primary\u2019s datacenter and back. With multiple semi-sync replicas it\u2019s the time it takes for the fastest replica to respond. When the primary goes down, we have the data durable outside its datacenter. But we can then also compare with non semi-sync replicas in the primary\u2019s datacenter: they may yet have all the transactions, too, in which case we can promote one of them. Again, promoting within the same datacenter tends to be less disruptive to the application. Or, we can spend some time seeding them from one of our semi-sync replicas. Or, we can choose to promote our semi-sync replicas, switching the primary data center for the replication cluster. We then must reassign semi-sync replicas, and ensure none run from within the new primary\u2019s datacenter. In the event of the primary\u2019s datacenter network isolation, we promote one of our semi-sync replicas, in a different DC. We reconfigure semi-sync replicas, before making the new primary writable. This avoids a split brain scenario, assuming all of our semi-sync replicas are available to us. What if two or more sites get network isolated at the same time? \u00b6 It largely depends on your hardware distribution. If your servers are distributed across three sites, then the majority of your sites is now down. Chances are you were only planning for single site outage at any given time, and a two-site outage is a hard downtime for you. You may or may not have the capacity to run with just one third of your hardware. You\u2019d need to risk consistency and split brain. Let\u2019s assume we run out of 5 different sites (or availability zones), and 2 are down. In our \u201c1-n\u201d setup, split brain is still possible, even though the majority of sites are up. That\u2019s because our semi-sync setup is about the communication between a primary and any of its replicas. But this is also something you can attach a number to. What is the probability of two availability zones going down at the same time? For a given vendor? Cross vendors? Is there a number you\u2019re willing to accept? What is the probability of the two zones being in outage both over X minutes? Will you be willing to wait out X minutes to maintain durability and consistency? In our physical world, there is no hard limitation to how many sites could go down at the same time. We\u2019re generally willing to accept that some risks are so low that we can accept them. Quorum \u00b6 Of special interest is that in our \u201c1-n\u201d scenario, we have a quorum of two servers out of five or more. The primary, with a single additional replica, are able to form a quorum and to accept writes. That\u2019s how we got to have a split brain. While R2, R3, R4 form a majority of the servers, writes took place without their agreement. People familiar with Paxos and Raft consensus protocols may find this baffling. However, reliable minority consensus is achievable, and Sugu Sougoumarane\u2019s Consensus Algorithms series of posts continues to describe this","title":"MySQL semi-sync replication: durability, consistency and split brains"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html#mysql-semi-sync-replication-durability-consistency-and-split-brains","text":"\u6587\u7ae0\u6765\u81eaPlantscale\u535a\u5ba2\u5e73\u53f0\uff0c \u5355\u51fb\u67e5\u770b\u539f\u6587 MySQL semi-sync is a plugin mechanism on top of asynchronous replication, that can offer better durability and even consistency (term defined later). It helps in high availability solutions, but can in itself reduce availability. We look at some basics and follow up to present scenarios that require higher level intervention to ensure availability and to avoid split brains from taking place. I recommend reading this semi-sync blog post by Jean-Fran\u00e7ois Gagn\u00e9 (aka JFG), which illustrates the internals of the semi-sync implementation, and debunks some myths about semi-sync. We will overlap a bit with another recommended post by JFG, about high availability and recovery . Note: in this post we adopt the term \u201cprimary\u201d over the term \u201cmaster\u201d in the context of MySQL replication. However, at this time there is no alternative to using the actual names of some configuration and status variables that use \u201cmaster\u201d terminology, and some duality is present.","title":"MySQL semi-sync replication: durability, consistency and split brains"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html#overview","text":"As quick recap, semi-synchronous replication is a mechanism where a commit on the primary does not apply the change onto internal table data and does not respond to the user, until the changelog is guaranteed to have been persisted (though not necessarily applied) on a preconfigured number of replicas. We limit our discussion to MySQL 5.7 or equivalent. Specifically, the primary is configured with rpl_semi_sync_master_wait_for_slave_count, which is 1 or above, if semi-sync is to be used. An INSERT transaction, for example, will not report being committed (i.e. the user will not get \u201cOK\u201d) until at least that number of replicas have acknowledged receipt of that transaction\u2019s changelog (entries in the binary log). In practice, this means at least that number of replicas have written the changelog onto their relay logs where the change is now persisted. The replicas will apply the change later on, normally as soon as they can. For the scope of this post, we assume replicas are not intentionally stopped, and we can also ignore delayed replicas. The primary waits up to rpl_semi_sync_master_timeout, after which it falls back to asynchronous replication mode, committing and responding to the user even if not all expected replicas have acknowledged receipt. In the scope of this post, we are interested in an \u201cinfinite\u201d timeout, which we will accept to be a very large number. The only replicas to acknowledge receipt of the changelog are replicas where semi-sync is enabled. There could be other, non semi-sync replicas in our topology. They, too, pull the changelog from the primary, but do not acknowledge receipt. As JFG points out in his post, the semi-sync replicas aren\u2019t necessarily the most up to date. It\u2019s possible that a non-semi-sync replica has pulled more changelog data than some or all semi-sync replicas.","title":"Overview"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html#durability","text":"The most straightforward use case for semi-sync is to guarantee durability of the data. We only approve a commit once the transaction (in the form of a changelog) is persisted elsewhere, on a different server, or on multiple servers. As mentioned earlier, this does not mean the changelog has been applied on those servers. Replication may be lagging and the servers may be too busy to be able to apply the changelog in a timely fashion. But, at the very least, if the primary crashes, there\u2019s \u201cforensic evidence\u201d in the relay logs of a semi-sync replica that can tell us what the latest changes were.","title":"Durability"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html#consistency","text":"The term \u201cconsistency\u201d is overloaded, and especially in distributed systems. The CAP Theorem definition of consistency is, for example, very strict: once data was written on one server, any immediate follow-up read on any other server must reflect that write (or any later write). We will suffice with eventual consistency. This in itself an overloaded term, so let\u2019s clarify: in the case of a primary outage, we consider our system consistent if we\u2019re able to promote a new primary within any amount of time (obviously in practice we expect the time to be short) such that it is consistent with the previous primary\u2019s advertised state. I write \u201cadvertised\u201d state because the end user or applications should not be surprised by any data changes when the new primary is promoted, regardless of how transactions/replication work internally.","title":"Consistency"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html#split-brain","text":"A split brain is a situation where there are two servers which are simultaneously taking writes, each thinking they\u2019re the (single) primary. In a split brain scenario the data diverges between the two servers. If those servers also have replicas, then we have two divergent replication trees. Fixing and merging those divergent trees is difficult, and normally we revert the changes on one to make it look like the other (whether by backup+restore or by some rollback method). Reiterating JFG\u2019s observation that while engineers normally frown upon split brains, the damage of split brain may well be within a product\u2019s allowance. Topologies and scenarios As always, getting best durability as possible, best consistency as possible, best response times as possible, best split brain mitigation as possible, is costly. Product owners and engineers make reasonable tradeoffs. Let\u2019s consider a few configured topologies, and see what scenarios we can expect upon failure. In particular, how durable our data is, can we expect it to be consistent, and can we expect split brains.","title":"Split brain"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html#general-scenario-wait-for-single-replica-multiple-semi-sync-replicas","text":"In this common scenario our primary is configured with rpl_semi_sync_master_wait_for_slave_count=1, and there are multiple (more than one) replicas configured with semi-sync. Let\u2019s say there are 4 semi-sync replicas, named R1, R2, R3, and R4. We nickname this setup \u201c1-n\u201d In this setup, a write takes place on the primary, and before approving the write to the user/app, the primary waits for an acknowledgement from exactly one replica. It doesn\u2019t matter which. For some writes, it will be replica R1; at some other time, R4 is the first to acknowledge. It\u2019s important to note that the changelog, the binary log, is sequential. A replica that acknowledges some changelog event, has necessarily received all of its prior events. This is why the primary doesn\u2019t need to care that different acknowledgements come from different replicas. An acknowledgement means there\u2019s a replica with full durability of committed transactions up to and including the one in question. Should the primary fail, we have at least one replica guaranteed to have all approved commits in its relay logs. These are not necessarily applied, but if our replication cluster is normally low-lagged, we can expect those commits to be few, and we can expect the replica to catch up (apply those commits) within a few seconds or less. A possible situation is that there may be non-semi-sync replicas even more up to date than our semi-sync replica. We can choose to use them. The fact they have more transactions than the most up-to-date semi sync replica means they have received binary log events not acknowledged by a semi-sync replica. While this may seem confusing at first, these are fine to accept, and do not contradict our promise to our users. We promised that \u201cif the primary tells you a commit is successful, then the data is durable elsewhere\u201d. We never said anything about the state of the data before telling the user the commit is successful. In fact, this scenario is no different than the primary actually getting a commit acknowledged by the replica, begins to communicate that to the user, then crashing halfway. The user cannot distinguish between the two cases at the time of failure (though post crash analysis may indicate which of the two was true). And so we can choose to use the data from that even-more-up-to-date non-semi-sync replica, seed the rest of the replicas with that data, or, we can choose to throw away any server that is more-up-to-date than our most-up-to-date semi-sync replica and recycle them. It\u2019s our choice and it\u2019s down to operational considerations (time, capacity, load, ...).","title":"General scenario: wait for single replica, multiple semi-sync replicas"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html#if-data-is-durable-does-that-mean-its-available","text":"Not necessarily. Consider this possible, even likely scenario: the primary and R1 are both in the same data center. R2, R3, R4 are in different availability zones, possibly remote, and so have higher latency than R1 communicating to the primary. The app issues an UPDATE on the primary. R1 acknowledges the write. R2, R3, R4 do not, as yet. But the primary does not care, it commits and reports success to the app. Then the primary and R1 both get network isolated together because the DC they\u2019re in has lost network. The loss of network cut short the delivery of the change log to R2, R3, R4. They never got it. Should we promote either R2, R3, or R4, we lose consistency. The app expects the result of that UPDATE to be there, but neither of these servers have the data. Moreover, even human intervention is limited. Since the data is only found on primary and R1, we cannot get hold of the data. A human can always transport to the physical server to extract the data and send it over via cellular network, or even by car. It\u2019s likely that this will take substantial time. A predefined failover plan may choose to promote, say, R2, after all, losing some data, but cutting short on outage time. Reconciliation will have to take place afterwards.","title":"If data is durable, does that mean it\u2019s available?"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html#do-we-even-know-the-status","text":"If the primary and one of the semi-sync replicas go offline, we have an additional problem: we can\u2019t say for sure whether any of the remaining semi-sync replicas got the latest updates from the primary. It\u2019s possible that they did. But it\u2019s also possible that the single semi-sync replica that went offline, was the single one to get and acknowledge some last writes taking place on the primary. To generalize, if the number of lost semi-sync replicas is equal to, or greater than rpl_semi_sync_master_wait_for_slave_count, then we do not know whether the remaining replicas are consistent.","title":"Do we even know the status?"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html#split-brain_1","text":"But, arguably worse, is that we can now be in a split brain situation. Apps in the primary datacenter were still writing to the old primary when the network went down. Those writes continued to run. The old primary now receives writes never seen by R2 (the newly promoted primary). Once we do wish to reconcile, we are faced with contradicting information.","title":"Split brain"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html#physical-locations","text":"The geo-distribution of our servers plays a key part in how tolerant our system is for failure and what outcomes we can expect.","title":"Physical locations"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html#colocated-primary-and-semi-sync-replicas","text":"On a normal day, writes to the primary have low latency: acknowledgements from semi-sync replicas are quick to arrive thanks to the fast network within a datacenter. When the primary fails, we have at least one good semi-sync replica to promote (or we can use it to seed a different server to promote). Because we promote within the same datacenter, app behavior is unlikely to be affected, other than the obvious disruption during the failover time. If the datacenter is network-isolated, we need to make a decision: wait out the outage, incurring downtime to our services, or promote a new primary in another datacenter. We risk losing transactions (we cannot know whether we lose transactions until we are again able to connect to the original primary). We also risk a split brain scenario.","title":"Colocated primary and semi-sync replicas"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html#cross-site-semi-sync-replication","text":"If we only run semi-sync replicas in a different datacenter than the primary\u2019s, we first pay with increased write latency, as each commit runs a roundtrip outside the primary\u2019s datacenter and back. With multiple semi-sync replicas it\u2019s the time it takes for the fastest replica to respond. When the primary goes down, we have the data durable outside its datacenter. But we can then also compare with non semi-sync replicas in the primary\u2019s datacenter: they may yet have all the transactions, too, in which case we can promote one of them. Again, promoting within the same datacenter tends to be less disruptive to the application. Or, we can spend some time seeding them from one of our semi-sync replicas. Or, we can choose to promote our semi-sync replicas, switching the primary data center for the replication cluster. We then must reassign semi-sync replicas, and ensure none run from within the new primary\u2019s datacenter. In the event of the primary\u2019s datacenter network isolation, we promote one of our semi-sync replicas, in a different DC. We reconfigure semi-sync replicas, before making the new primary writable. This avoids a split brain scenario, assuming all of our semi-sync replicas are available to us.","title":"Cross-site semi-sync replication"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html#what-if-two-or-more-sites-get-network-isolated-at-the-same-time","text":"It largely depends on your hardware distribution. If your servers are distributed across three sites, then the majority of your sites is now down. Chances are you were only planning for single site outage at any given time, and a two-site outage is a hard downtime for you. You may or may not have the capacity to run with just one third of your hardware. You\u2019d need to risk consistency and split brain. Let\u2019s assume we run out of 5 different sites (or availability zones), and 2 are down. In our \u201c1-n\u201d setup, split brain is still possible, even though the majority of sites are up. That\u2019s because our semi-sync setup is about the communication between a primary and any of its replicas. But this is also something you can attach a number to. What is the probability of two availability zones going down at the same time? For a given vendor? Cross vendors? Is there a number you\u2019re willing to accept? What is the probability of the two zones being in outage both over X minutes? Will you be willing to wait out X minutes to maintain durability and consistency? In our physical world, there is no hard limitation to how many sites could go down at the same time. We\u2019re generally willing to accept that some risks are so low that we can accept them.","title":"What if two or more sites get network isolated at the same time?"},{"location":"mysql/ha/202202/5.MySQL-semi-sync-replication.html#quorum","text":"Of special interest is that in our \u201c1-n\u201d scenario, we have a quorum of two servers out of five or more. The primary, with a single additional replica, are able to form a quorum and to accept writes. That\u2019s how we got to have a split brain. While R2, R3, R4 form a majority of the servers, writes took place without their agreement. People familiar with Paxos and Raft consensus protocols may find this baffling. However, reliable minority consensus is achievable, and Sugu Sougoumarane\u2019s Consensus Algorithms series of posts continues to describe this","title":"Quorum"},{"location":"mysql/hp/index.html","text":"MySQL-\u9ad8\u6027\u80fd\u7bc7 \u00b6 1\u3001MySQL\u6027\u80fd\u4f18\u5316\u7684\u65b9\u5411\u6982\u8ff0","title":"\u9ad8\u6027\u80fd\u7bc7"},{"location":"mysql/hp/index.html#mysql-","text":"1\u3001MySQL\u6027\u80fd\u4f18\u5316\u7684\u65b9\u5411\u6982\u8ff0","title":"MySQL-\u9ad8\u6027\u80fd\u7bc7"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html","text":"MySQL\u6027\u80fd\u4f18\u5316\u65b9\u5411\u6982\u8ff0 \u00b6 1\u3001\u539f\u5219\uff1a\u6570\u636e\u5e93\u6027\u80fd\u4f18\u5316\u6c38\u65e0\u6b62\u5883\uff0c\u9700\u8981\u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u8be5\u505c\u4e0b\u6765 \u00b6 2\u3001 \u786c\u4ef6\u5c42\u9762 \u00b6 2.1 CPU \u00b6 2.2 \u5185\u5b58-Memory \u00b6 2.3 \u78c1\u76d8-Disk \u00b6 2.4 \u7f51\u7edc-Network \u00b6 3\u3001OS\u5c42\u9762\u7684\u4f18\u5316 \u00b6 3.1\u3001\u6587\u4ef6\u7cfb\u7edf\u9009\u62e9\u4e0e\u914d\u7f6e \u00b6 3.2\u3001\u6587\u4ef6\u7cfb\u7edf\u9009\u62e9\u4e0e\u914d\u7f6e \u00b6 4\u3001MySQL\u7cfb\u7edf\u53c2\u6570\u4f18\u5316 \u00b6 \u4e24\u4e2a\u91cd\u8981\u539f\u5219\uff1a \u4e0d\u8981\u4f7f\u7528MySQL\u9ed8\u8ba4\u7684\u914d\u7f6e \u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u505c\u4e0b\u6765\uff0c\u4e0d\u8981\u8fc7\u5ea6\u4f18\u5316 4.1\u3001\u5e38\u89c1\u4f18\u5316\u53c2\u6570 \u00b6 4.1.1\u3001server \u5c42\u9762 \u00b6 max_connections log_bin open_files_limit maybe more in the future 4.1.2\u3001InnoDB \u5c42\u9762 \u00b6 innodb_buffer_pool_size innodb_log_file_size innodb_flush_log_at_trx_commit innodb_flush_method = O_DIRECT 5\u3001SQL\u5c42\u9762 \u00b6 MySQL temp_table > tmp_table_size \u6216 MySQL temp_table > max_heap_table_size = \u8f6c\u5316\u4e3a\u57fa\u4e8e\u78c1\u76d8\u7684\u4e34\u65f6\u8868 5.1\u3001\u4ea7\u751f\u4e34\u65f6\u8868\u548c\u6587\u4ef6\u6392\u5e8f\u7684GROUP BY \u4f18\u5316 \u00b6 - \u589e\u52a0\u7d22\u5f15\u4f18\u5316\u5168\u8868\u626b\u63cf \u00b6 5.2\u3001ORDER BY \u4f18\u5316 \u00b6 5.3\u3001SELECT DISTINCT\u4f18\u5316 \u00b6 5.4\u3001\u4f18\u5316\u5355\u6761\u67e5\u8be2 \u00b6 mysql> set profiling = 1 ; mysql> show profiles ; mysql> set @query_id = N ; mysql> select STATE -> ,sum ( DURATION ) as Total_r -> ,round ( 100 *sum ( DURATION ) / ( select sum ( DURATION ) from PROFILING where query_id = @query_id ) ,2 ) as Pct_r -> ,count ( * ) as Calls -> ,sum ( DURATION ) /count ( * ) as \"R/call\" -> from PROFILING where query_id = @query_id -> group by state -> order by Total_r DESC ;","title":"MySQL\u6027\u80fd\u4f18\u5316\u65b9\u5411\u6982\u8ff0"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#mysql","text":"","title":"MySQL\u6027\u80fd\u4f18\u5316\u65b9\u5411\u6982\u8ff0"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#1","text":"","title":"1\u3001\u539f\u5219\uff1a\u6570\u636e\u5e93\u6027\u80fd\u4f18\u5316\u6c38\u65e0\u6b62\u5883\uff0c\u9700\u8981\u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u8be5\u505c\u4e0b\u6765"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#2","text":"","title":"2\u3001 \u786c\u4ef6\u5c42\u9762"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#21-cpu","text":"","title":"2.1 CPU"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#22-memory","text":"","title":"2.2 \u5185\u5b58-Memory"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#23-disk","text":"","title":"2.3 \u78c1\u76d8-Disk"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#24-network","text":"","title":"2.4 \u7f51\u7edc-Network"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#3os","text":"","title":"3\u3001OS\u5c42\u9762\u7684\u4f18\u5316"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#31","text":"","title":"3.1\u3001\u6587\u4ef6\u7cfb\u7edf\u9009\u62e9\u4e0e\u914d\u7f6e"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#32","text":"","title":"3.2\u3001\u6587\u4ef6\u7cfb\u7edf\u9009\u62e9\u4e0e\u914d\u7f6e"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#4mysql","text":"\u4e24\u4e2a\u91cd\u8981\u539f\u5219\uff1a \u4e0d\u8981\u4f7f\u7528MySQL\u9ed8\u8ba4\u7684\u914d\u7f6e \u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u505c\u4e0b\u6765\uff0c\u4e0d\u8981\u8fc7\u5ea6\u4f18\u5316","title":"4\u3001MySQL\u7cfb\u7edf\u53c2\u6570\u4f18\u5316"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#41","text":"","title":"4.1\u3001\u5e38\u89c1\u4f18\u5316\u53c2\u6570"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#411server","text":"max_connections log_bin open_files_limit maybe more in the future","title":"4.1.1\u3001server \u5c42\u9762"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#412innodb","text":"innodb_buffer_pool_size innodb_log_file_size innodb_flush_log_at_trx_commit innodb_flush_method = O_DIRECT","title":"4.1.2\u3001InnoDB \u5c42\u9762"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#5sql","text":"MySQL temp_table > tmp_table_size \u6216 MySQL temp_table > max_heap_table_size = \u8f6c\u5316\u4e3a\u57fa\u4e8e\u78c1\u76d8\u7684\u4e34\u65f6\u8868","title":"5\u3001SQL\u5c42\u9762"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#51group-by","text":"","title":"5.1\u3001\u4ea7\u751f\u4e34\u65f6\u8868\u548c\u6587\u4ef6\u6392\u5e8f\u7684GROUP BY \u4f18\u5316"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#-","text":"","title":"- \u589e\u52a0\u7d22\u5f15\u4f18\u5316\u5168\u8868\u626b\u63cf"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#52order-by","text":"","title":"5.2\u3001ORDER BY \u4f18\u5316"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#53select-distinct","text":"","title":"5.3\u3001SELECT DISTINCT\u4f18\u5316"},{"location":"mysql/hp/202201/1.MySQL%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E5%90%91%E6%A6%82%E8%BF%B0.html#54","text":"mysql> set profiling = 1 ; mysql> show profiles ; mysql> set @query_id = N ; mysql> select STATE -> ,sum ( DURATION ) as Total_r -> ,round ( 100 *sum ( DURATION ) / ( select sum ( DURATION ) from PROFILING where query_id = @query_id ) ,2 ) as Pct_r -> ,count ( * ) as Calls -> ,sum ( DURATION ) /count ( * ) as \"R/call\" -> from PROFILING where query_id = @query_id -> group by state -> order by Total_r DESC ;","title":"5.4\u3001\u4f18\u5316\u5355\u6761\u67e5\u8be2"},{"location":"redis/index.html","text":"","title":"Index"},{"location":"redis/basic/index.html","text":"Redis-\u57fa\u7840\u7bc7 \u00b6 1\u3001Redis\u90e8\u7f72\u5b9e\u8df5","title":"\u57fa\u7840"},{"location":"redis/basic/index.html#redis-","text":"1\u3001Redis\u90e8\u7f72\u5b9e\u8df5","title":"Redis-\u57fa\u7840\u7bc7"},{"location":"redis/basic/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html","text":"Redis\u90e8\u7f72\u5b9e\u8df5 \u00b6 Redis\u90e8\u7f72\u6a21\u5f0f\u4e3b\u8981\u5305\u542b\u54e8\u5175\u6a21\u5f0f\u548c\u96c6\u7fa4\u6a21\u5f0f\u4e24\u79cd\u6a21\u5f0f\uff0c\u6bcf\u4e00\u79cd\u90fd\u9700\u8981\u5148\u90e8\u7f72\u5b8c\u5355\u673a\u7248\u7684Redis\uff0c\u5728\u8fdb\u884c\u9488\u5bf9\u6027\u90e8\u7f72\uff1a 1.1 \u7cfb\u7edf\u53c2\u6570\u8c03\u6574 \u00b6 # \u4fee\u6539vm.overcommit_memory shell> vim /etc/sysctl.conf vm.overcommit_memory = 1 shell> sysctl vm.overcommit_memory=1 # \u7981\u7528\u5927\u9875\u4f20\u8f93 shell> echo never > /sys/kernel/mm/transparent_hugepage/enabled shell> echo never > /sys/kernel/mm/transparent_hugepage/enabled\" >>/etc/rc.local 1.2 \u5b89\u88c5\u5305\u4e0b\u8f7d \u00b6 \u5b89\u88c5\u5305\u53ef\u4ee5\u5230 Redis\u5b98\u7f51 \u6216\u8005\u5bf9\u5e94\u7684 GitHub\u4ed3\u5e93 \u8fdb\u884c\u4e0b\u8f7d # Redis\u5b98\u7f51 wget https://download.redis.io/releases/redis-5.0.12.tar.gz # Github\u4ed3\u5e93 wget https://github.com/redis/redis/archive/refs/tags/5.0.12.tar.gz 1.3 \u7f16\u8bd1\u5b89\u88c5 \u00b6 shell>tar -xzvf redis-5.0.12.tar.gz shell>cd redis-5.0.12 shell>make $$ make install # \u8fd0\u884c\u5b8c\u4e0a\u8ff0\u547d\u4ee4\u4ee5\u540e\uff0c\u9ed8\u8ba4\u5c06Redis\u76f8\u5173\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5b89\u88c5\u5230/usr/local/bin\u8def\u5f84\u4e0b # \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u786e\u8ba4Redis\u7248\u672c\u4ee5\u53ca\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u662f\u5426\u4f4d\u4e8e\u73af\u5883\u53d8\u91cf\u5185 shell>which redis-server /usr/local/bin/redis-server shell>redis-server --version Redis server v = 5 .0.7 sha = 00000000 :0 malloc = jemalloc-5.1.0 bits = 64 build = a257f57b53913ab shell>ll /usr/local/bin/ | grep redis -rwxr-xr-x 1 root root 4366848 Jun 28 20 :41 redis-benchmark -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-check-aof -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-check-rdb -rwxr-xr-x 1 root root 4807920 Jun 28 20 :41 redis-cli lrwxrwxrwx 1 root root 12 Jun 28 20 :41 redis-sentinel -> redis-server -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-server 1.4 \u6839\u636e\u5b9e\u9645\u9700\u6c42\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 \u00b6 1.5 \u914d\u7f6eRedis\u5f00\u673a\u542f\u52a8\u811a\u672c \u00b6 1.5.1 \u8fd0\u884c\u73af\u5883\u51c6\u5907 \u00b6 shell> groupadd -g 6379 redis ; useradd -s /sbin/nologin redis -g redis -u 6379 shell> export Redis_base_dir = /apply/redisdata shell> mkdir -p ${ Redis_base_dir } / { data,log,run } shell> chown -R redis:redis ${ Redis_base_dir } 1.5.2 \u914d\u7f6eRedis\u670d\u52a1\u542f\u52a8 \u00b6 \u5c06\u6b64\u811a\u672c\u653e\u5230 /usr/lib/systemd/system/\u4e0b cat /usr/lib/systemd/system/redis-server.service [ Unit ] Description = The redis-server Process Manager After = syslog.target network.target [ Service ] User = redis Group = redis Type = forking # \u4ee5\u4e0b\u9009\u9879\u53ef\u6839\u636eRedis\u53ef\u6267\u884c\u6587\u4ef6\u548c\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u4f4d\u7f6e\u8fdb\u884c\u8fdb\u884c\u4fee\u6539 ExecStart = /usr/local/bin/redis-server /usr/local/redis/config/redis.conf ExecReload = /bin/kill -USR2 $MAINPID ExecStartPost = /bin/sleep 1 ExecStop = /bin/kill -SIGINT $MAINPID PIDFile = /data/redisdata/run/redis.pid [ Install ] WantedBy = multi-user.target \u914d\u7f6e\u5f00\u673a\u542f\u52a8\u811a\u672c [root@localhost ~]# systemctl enable redis-server Created symlink from /etc/systemd/system/multi-user.target.wants/redis-server.service to /usr/lib/systemd/system/redis-server.service [root@localhost ~]# systemctl status redis-server \u25cf redis-server.service - The redis-server Process Manager Loaded: loaded (/usr/lib/systemd/system/redis-server.service; enabled; vendor preset: disabled) Active: active (running) since Wed 2021-12-15 16:40:10 CST; 1 weeks 0 days ago Main PID: 24562 (redis-server) CGroup: /system.slice/redis-server.service \u2514\u250024562 /usr/local/bin/redis-server *:6379 Dec 15 16:40:09 localhost.localdomain systemd[1]: Starting The redis-server Process Manager... Dec 15 16:40:10 localhost.localdomain systemd[1]: Started The redis-server Process Manager","title":"Redis\u90e8\u7f72\u5b9e\u8df5"},{"location":"redis/basic/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#redis","text":"Redis\u90e8\u7f72\u6a21\u5f0f\u4e3b\u8981\u5305\u542b\u54e8\u5175\u6a21\u5f0f\u548c\u96c6\u7fa4\u6a21\u5f0f\u4e24\u79cd\u6a21\u5f0f\uff0c\u6bcf\u4e00\u79cd\u90fd\u9700\u8981\u5148\u90e8\u7f72\u5b8c\u5355\u673a\u7248\u7684Redis\uff0c\u5728\u8fdb\u884c\u9488\u5bf9\u6027\u90e8\u7f72\uff1a","title":"Redis\u90e8\u7f72\u5b9e\u8df5"},{"location":"redis/basic/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#11","text":"# \u4fee\u6539vm.overcommit_memory shell> vim /etc/sysctl.conf vm.overcommit_memory = 1 shell> sysctl vm.overcommit_memory=1 # \u7981\u7528\u5927\u9875\u4f20\u8f93 shell> echo never > /sys/kernel/mm/transparent_hugepage/enabled shell> echo never > /sys/kernel/mm/transparent_hugepage/enabled\" >>/etc/rc.local","title":"1.1 \u7cfb\u7edf\u53c2\u6570\u8c03\u6574"},{"location":"redis/basic/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#12","text":"\u5b89\u88c5\u5305\u53ef\u4ee5\u5230 Redis\u5b98\u7f51 \u6216\u8005\u5bf9\u5e94\u7684 GitHub\u4ed3\u5e93 \u8fdb\u884c\u4e0b\u8f7d # Redis\u5b98\u7f51 wget https://download.redis.io/releases/redis-5.0.12.tar.gz # Github\u4ed3\u5e93 wget https://github.com/redis/redis/archive/refs/tags/5.0.12.tar.gz","title":"1.2 \u5b89\u88c5\u5305\u4e0b\u8f7d"},{"location":"redis/basic/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#13","text":"shell>tar -xzvf redis-5.0.12.tar.gz shell>cd redis-5.0.12 shell>make $$ make install # \u8fd0\u884c\u5b8c\u4e0a\u8ff0\u547d\u4ee4\u4ee5\u540e\uff0c\u9ed8\u8ba4\u5c06Redis\u76f8\u5173\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5b89\u88c5\u5230/usr/local/bin\u8def\u5f84\u4e0b # \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u786e\u8ba4Redis\u7248\u672c\u4ee5\u53ca\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u662f\u5426\u4f4d\u4e8e\u73af\u5883\u53d8\u91cf\u5185 shell>which redis-server /usr/local/bin/redis-server shell>redis-server --version Redis server v = 5 .0.7 sha = 00000000 :0 malloc = jemalloc-5.1.0 bits = 64 build = a257f57b53913ab shell>ll /usr/local/bin/ | grep redis -rwxr-xr-x 1 root root 4366848 Jun 28 20 :41 redis-benchmark -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-check-aof -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-check-rdb -rwxr-xr-x 1 root root 4807920 Jun 28 20 :41 redis-cli lrwxrwxrwx 1 root root 12 Jun 28 20 :41 redis-sentinel -> redis-server -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-server","title":"1.3 \u7f16\u8bd1\u5b89\u88c5"},{"location":"redis/basic/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#14","text":"","title":"1.4 \u6839\u636e\u5b9e\u9645\u9700\u6c42\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},{"location":"redis/basic/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#15-redis","text":"","title":"1.5 \u914d\u7f6eRedis\u5f00\u673a\u542f\u52a8\u811a\u672c"},{"location":"redis/basic/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#151","text":"shell> groupadd -g 6379 redis ; useradd -s /sbin/nologin redis -g redis -u 6379 shell> export Redis_base_dir = /apply/redisdata shell> mkdir -p ${ Redis_base_dir } / { data,log,run } shell> chown -R redis:redis ${ Redis_base_dir }","title":"1.5.1 \u8fd0\u884c\u73af\u5883\u51c6\u5907"},{"location":"redis/basic/202112/1.Redis%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#152-redis","text":"\u5c06\u6b64\u811a\u672c\u653e\u5230 /usr/lib/systemd/system/\u4e0b cat /usr/lib/systemd/system/redis-server.service [ Unit ] Description = The redis-server Process Manager After = syslog.target network.target [ Service ] User = redis Group = redis Type = forking # \u4ee5\u4e0b\u9009\u9879\u53ef\u6839\u636eRedis\u53ef\u6267\u884c\u6587\u4ef6\u548c\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u4f4d\u7f6e\u8fdb\u884c\u8fdb\u884c\u4fee\u6539 ExecStart = /usr/local/bin/redis-server /usr/local/redis/config/redis.conf ExecReload = /bin/kill -USR2 $MAINPID ExecStartPost = /bin/sleep 1 ExecStop = /bin/kill -SIGINT $MAINPID PIDFile = /data/redisdata/run/redis.pid [ Install ] WantedBy = multi-user.target \u914d\u7f6e\u5f00\u673a\u542f\u52a8\u811a\u672c [root@localhost ~]# systemctl enable redis-server Created symlink from /etc/systemd/system/multi-user.target.wants/redis-server.service to /usr/lib/systemd/system/redis-server.service [root@localhost ~]# systemctl status redis-server \u25cf redis-server.service - The redis-server Process Manager Loaded: loaded (/usr/lib/systemd/system/redis-server.service; enabled; vendor preset: disabled) Active: active (running) since Wed 2021-12-15 16:40:10 CST; 1 weeks 0 days ago Main PID: 24562 (redis-server) CGroup: /system.slice/redis-server.service \u2514\u250024562 /usr/local/bin/redis-server *:6379 Dec 15 16:40:09 localhost.localdomain systemd[1]: Starting The redis-server Process Manager... Dec 15 16:40:10 localhost.localdomain systemd[1]: Started The redis-server Process Manager","title":"1.5.2 \u914d\u7f6eRedis\u670d\u52a1\u542f\u52a8"},{"location":"redis/cluster/index.html","text":"Redis-\u5206\u7247\u96c6\u7fa4\u7bc7 \u00b6","title":"\u96c6\u7fa4-Cluster"},{"location":"redis/cluster/index.html#redis-","text":"","title":"Redis-\u5206\u7247\u96c6\u7fa4\u7bc7"},{"location":"redis/sentinel/index.html","text":"Redis-\u54e8\u5175\u7bc7 \u00b6 1\u3001Redis\u54e8\u5175\u90e8\u7f72\u5b9e\u8df5 2\u3001Redis\u54e8\u5175\u8282\u70b9\u8c03\u6574 3\u3001Redis-API","title":"\u54e8\u5175-Sentinel"},{"location":"redis/sentinel/index.html#redis-","text":"1\u3001Redis\u54e8\u5175\u90e8\u7f72\u5b9e\u8df5 2\u3001Redis\u54e8\u5175\u8282\u70b9\u8c03\u6574 3\u3001Redis-API","title":"Redis-\u54e8\u5175\u7bc7"},{"location":"redis/sentinel/202201/1.Redis%E5%93%A8%E5%85%B5%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html","text":"Redis\u54e8\u5175\u90e8\u7f72\u5b9e\u8df5 \u00b6 Redis\u90e8\u7f72\u6a21\u5f0f\u4e3b\u8981\u5305\u542b\u54e8\u5175\u6a21\u5f0f\u548c\u96c6\u7fa4\u6a21\u5f0f\u4e24\u79cd\u6a21\u5f0f\uff0c\u6bcf\u4e00\u79cd\u90fd\u9700\u8981\u5148\u90e8\u7f72\u5b8c \u5355\u673a\u7248\u7684Redis \uff0c\u6b64\u5904\u4ecb\u7ecdRedis\u54e8\u5175\u7684\u90e8\u7f72\uff1a 1.1 \u7cfb\u7edf\u53c2\u6570\u8c03\u6574 \u00b6 # \u4fee\u6539vm.overcommit_memory shell> vim /etc/sysctl.conf vm.overcommit_memory = 1 shell> sysctl vm.overcommit_memory=1 # \u7981\u7528\u5927\u9875\u4f20\u8f93 shell> echo never > /sys/kernel/mm/transparent_hugepage/enabled shell> echo \"echo never > /sys/kernel/mm/transparent_hugepage/enabled\" >>/etc/rc.local 1.2 \u5b89\u88c5\u5305\u4e0b\u8f7d \u00b6 \u5b89\u88c5\u5305\u53ef\u4ee5\u5230 Redis\u5b98\u7f51 \u6216\u8005\u5bf9\u5e94\u7684 GitHub\u4ed3\u5e93 \u8fdb\u884c\u4e0b\u8f7d # Redis\u5b98\u7f51 wget https://download.redis.io/releases/redis-5.0.12.tar.gz # Github\u4ed3\u5e93 wget https://github.com/redis/redis/archive/refs/tags/5.0.12.tar.gz 1.3 \u7f16\u8bd1\u5b89\u88c5 \u00b6 shell>tar -xzvf redis-5.0.12.tar.gz shell>cd redis-5.0.12 shell>make $$ make install # \u8fd0\u884c\u5b8c\u4e0a\u8ff0\u547d\u4ee4\u4ee5\u540e\uff0c\u9ed8\u8ba4\u5c06Redis\u76f8\u5173\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5b89\u88c5\u5230/usr/local/bin\u8def\u5f84\u4e0b # \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u786e\u8ba4Redis\u7248\u672c\u4ee5\u53ca\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u662f\u5426\u4f4d\u4e8e\u73af\u5883\u53d8\u91cf\u5185 shell>which redis-server /usr/local/bin/redis-server shell>redis-server --version Redis server v = 5 .0.7 sha = 00000000 :0 malloc = jemalloc-5.1.0 bits = 64 build = a257f57b53913ab shell>ll /usr/local/bin/ | grep redis -rwxr-xr-x 1 root root 4366848 Jun 28 20 :41 redis-benchmark -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-check-aof -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-check-rdb -rwxr-xr-x 1 root root 4807920 Jun 28 20 :41 redis-cli lrwxrwxrwx 1 root root 12 Jun 28 20 :41 redis-sentinel -> redis-server -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-server 1.4 \u6839\u636e\u5b9e\u9645\u9700\u6c42\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 \u00b6 1.5 \u914d\u7f6eRedis\u5f00\u673a\u542f\u52a8\u811a\u672c \u00b6 1.5.1 \u8fd0\u884c\u73af\u5883\u51c6\u5907 \u00b6 bash shell> groupadd -g 6379 redis;useradd -s /sbin/nologin redis -g redis -u 6379 shell> export Redis_base_dir=/apply/redisdata shell> mkdir -p ${Redis_base_dir}/{data,log,run} shell> chown -R redis:redis ${Redis_base_dir} 1.6 Redis\u9ad8\u53ef\u7528\u67b6\u6784\u90e8\u7f72 \u00b6 1.6.1 Redis-sentinel\u90e8\u7f72 \u00b6 1.6.2 Redis-cluster\u90e8\u7f72 \u00b6","title":"Redis\u54e8\u5175\u90e8\u7f72\u5b9e\u8df5"},{"location":"redis/sentinel/202201/1.Redis%E5%93%A8%E5%85%B5%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#redis","text":"Redis\u90e8\u7f72\u6a21\u5f0f\u4e3b\u8981\u5305\u542b\u54e8\u5175\u6a21\u5f0f\u548c\u96c6\u7fa4\u6a21\u5f0f\u4e24\u79cd\u6a21\u5f0f\uff0c\u6bcf\u4e00\u79cd\u90fd\u9700\u8981\u5148\u90e8\u7f72\u5b8c \u5355\u673a\u7248\u7684Redis \uff0c\u6b64\u5904\u4ecb\u7ecdRedis\u54e8\u5175\u7684\u90e8\u7f72\uff1a","title":"Redis\u54e8\u5175\u90e8\u7f72\u5b9e\u8df5"},{"location":"redis/sentinel/202201/1.Redis%E5%93%A8%E5%85%B5%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#11","text":"# \u4fee\u6539vm.overcommit_memory shell> vim /etc/sysctl.conf vm.overcommit_memory = 1 shell> sysctl vm.overcommit_memory=1 # \u7981\u7528\u5927\u9875\u4f20\u8f93 shell> echo never > /sys/kernel/mm/transparent_hugepage/enabled shell> echo \"echo never > /sys/kernel/mm/transparent_hugepage/enabled\" >>/etc/rc.local","title":"1.1 \u7cfb\u7edf\u53c2\u6570\u8c03\u6574"},{"location":"redis/sentinel/202201/1.Redis%E5%93%A8%E5%85%B5%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#12","text":"\u5b89\u88c5\u5305\u53ef\u4ee5\u5230 Redis\u5b98\u7f51 \u6216\u8005\u5bf9\u5e94\u7684 GitHub\u4ed3\u5e93 \u8fdb\u884c\u4e0b\u8f7d # Redis\u5b98\u7f51 wget https://download.redis.io/releases/redis-5.0.12.tar.gz # Github\u4ed3\u5e93 wget https://github.com/redis/redis/archive/refs/tags/5.0.12.tar.gz","title":"1.2 \u5b89\u88c5\u5305\u4e0b\u8f7d"},{"location":"redis/sentinel/202201/1.Redis%E5%93%A8%E5%85%B5%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#13","text":"shell>tar -xzvf redis-5.0.12.tar.gz shell>cd redis-5.0.12 shell>make $$ make install # \u8fd0\u884c\u5b8c\u4e0a\u8ff0\u547d\u4ee4\u4ee5\u540e\uff0c\u9ed8\u8ba4\u5c06Redis\u76f8\u5173\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5b89\u88c5\u5230/usr/local/bin\u8def\u5f84\u4e0b # \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u786e\u8ba4Redis\u7248\u672c\u4ee5\u53ca\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u662f\u5426\u4f4d\u4e8e\u73af\u5883\u53d8\u91cf\u5185 shell>which redis-server /usr/local/bin/redis-server shell>redis-server --version Redis server v = 5 .0.7 sha = 00000000 :0 malloc = jemalloc-5.1.0 bits = 64 build = a257f57b53913ab shell>ll /usr/local/bin/ | grep redis -rwxr-xr-x 1 root root 4366848 Jun 28 20 :41 redis-benchmark -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-check-aof -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-check-rdb -rwxr-xr-x 1 root root 4807920 Jun 28 20 :41 redis-cli lrwxrwxrwx 1 root root 12 Jun 28 20 :41 redis-sentinel -> redis-server -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-server","title":"1.3 \u7f16\u8bd1\u5b89\u88c5"},{"location":"redis/sentinel/202201/1.Redis%E5%93%A8%E5%85%B5%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#14","text":"","title":"1.4 \u6839\u636e\u5b9e\u9645\u9700\u6c42\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},{"location":"redis/sentinel/202201/1.Redis%E5%93%A8%E5%85%B5%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#15-redis","text":"","title":"1.5 \u914d\u7f6eRedis\u5f00\u673a\u542f\u52a8\u811a\u672c"},{"location":"redis/sentinel/202201/1.Redis%E5%93%A8%E5%85%B5%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#151","text":"bash shell> groupadd -g 6379 redis;useradd -s /sbin/nologin redis -g redis -u 6379 shell> export Redis_base_dir=/apply/redisdata shell> mkdir -p ${Redis_base_dir}/{data,log,run} shell> chown -R redis:redis ${Redis_base_dir}","title":"1.5.1 \u8fd0\u884c\u73af\u5883\u51c6\u5907"},{"location":"redis/sentinel/202201/1.Redis%E5%93%A8%E5%85%B5%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#16-redis","text":"","title":"1.6 Redis\u9ad8\u53ef\u7528\u67b6\u6784\u90e8\u7f72"},{"location":"redis/sentinel/202201/1.Redis%E5%93%A8%E5%85%B5%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#161-redis-sentinel","text":"","title":"1.6.1 Redis-sentinel\u90e8\u7f72"},{"location":"redis/sentinel/202201/1.Redis%E5%93%A8%E5%85%B5%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5.html#162-redis-cluster","text":"","title":"1.6.2 Redis-cluster\u90e8\u7f72"},{"location":"redis/sentinel/202202/1.Redis%E5%93%A8%E5%85%B5%E8%8A%82%E7%82%B9%E8%B0%83%E6%95%B4.html","text":"Redis\u54e8\u5175\u8282\u70b9\u8c03\u6574 \u00b6 Redis\u90e8\u7f72\u6a21\u5f0f\u4e3b\u8981\u5305\u542b\u54e8\u5175\u6a21\u5f0f\u548c\u96c6\u7fa4\u6a21\u5f0f\u4e24\u79cd\u6a21\u5f0f\uff0c\u6bcf\u4e00\u79cd\u90fd\u9700\u8981\u5148\u90e8\u7f72\u5b8c \u5355\u673a\u7248\u7684Redis \uff0c\u6b64\u5904\u4ecb\u7ecdRedis\u54e8\u5175\u7684\u90e8\u7f72\uff1a 1\u3001 \u65b0\u589eRedis\u5b9e\u4f8b \u00b6 # \u4fee\u6539vm.overcommit_memory shell> vim /etc/sysctl.conf vm.overcommit_memory = 1 shell> sysctl vm.overcommit_memory=1 # \u7981\u7528\u5927\u9875\u4f20\u8f93 shell> echo never > /sys/kernel/mm/transparent_hugepage/enabled shell> echo \"echo never > /sys/kernel/mm/transparent_hugepage/enabled\" >>/etc/rc.local 2\u3001 \u65b0\u589eSentinel\u5b9e\u4f8b \u00b6 \u5b89\u88c5\u5305\u53ef\u4ee5\u5230 Redis\u5b98\u7f51 \u6216\u8005\u5bf9\u5e94\u7684 GitHub\u4ed3\u5e93 \u8fdb\u884c\u4e0b\u8f7d # Redis\u5b98\u7f51 wget https://download.redis.io/releases/redis-5.0.12.tar.gz # Github\u4ed3\u5e93 wget https://github.com/redis/redis/archive/refs/tags/5.0.12.tar.gz 3\u3001 \u79fb\u9664Slave\u8282\u70b9 \u00b6 4\u3001 \u79fb\u9664Master\u8282\u70b9 \u00b6 5\u3001\u79fb\u9664Redis-sentinel \u00b6","title":"Redis\u54e8\u5175\u8282\u70b9\u8c03\u6574"},{"location":"redis/sentinel/202202/1.Redis%E5%93%A8%E5%85%B5%E8%8A%82%E7%82%B9%E8%B0%83%E6%95%B4.html#redis","text":"Redis\u90e8\u7f72\u6a21\u5f0f\u4e3b\u8981\u5305\u542b\u54e8\u5175\u6a21\u5f0f\u548c\u96c6\u7fa4\u6a21\u5f0f\u4e24\u79cd\u6a21\u5f0f\uff0c\u6bcf\u4e00\u79cd\u90fd\u9700\u8981\u5148\u90e8\u7f72\u5b8c \u5355\u673a\u7248\u7684Redis \uff0c\u6b64\u5904\u4ecb\u7ecdRedis\u54e8\u5175\u7684\u90e8\u7f72\uff1a","title":"Redis\u54e8\u5175\u8282\u70b9\u8c03\u6574"},{"location":"redis/sentinel/202202/1.Redis%E5%93%A8%E5%85%B5%E8%8A%82%E7%82%B9%E8%B0%83%E6%95%B4.html#1-redis","text":"# \u4fee\u6539vm.overcommit_memory shell> vim /etc/sysctl.conf vm.overcommit_memory = 1 shell> sysctl vm.overcommit_memory=1 # \u7981\u7528\u5927\u9875\u4f20\u8f93 shell> echo never > /sys/kernel/mm/transparent_hugepage/enabled shell> echo \"echo never > /sys/kernel/mm/transparent_hugepage/enabled\" >>/etc/rc.local","title":"1\u3001 \u65b0\u589eRedis\u5b9e\u4f8b"},{"location":"redis/sentinel/202202/1.Redis%E5%93%A8%E5%85%B5%E8%8A%82%E7%82%B9%E8%B0%83%E6%95%B4.html#2-sentinel","text":"\u5b89\u88c5\u5305\u53ef\u4ee5\u5230 Redis\u5b98\u7f51 \u6216\u8005\u5bf9\u5e94\u7684 GitHub\u4ed3\u5e93 \u8fdb\u884c\u4e0b\u8f7d # Redis\u5b98\u7f51 wget https://download.redis.io/releases/redis-5.0.12.tar.gz # Github\u4ed3\u5e93 wget https://github.com/redis/redis/archive/refs/tags/5.0.12.tar.gz","title":"2\u3001 \u65b0\u589eSentinel\u5b9e\u4f8b"},{"location":"redis/sentinel/202202/1.Redis%E5%93%A8%E5%85%B5%E8%8A%82%E7%82%B9%E8%B0%83%E6%95%B4.html#3-slave","text":"","title":"3\u3001 \u79fb\u9664Slave\u8282\u70b9"},{"location":"redis/sentinel/202202/1.Redis%E5%93%A8%E5%85%B5%E8%8A%82%E7%82%B9%E8%B0%83%E6%95%B4.html#4-master","text":"","title":"4\u3001 \u79fb\u9664Master\u8282\u70b9"},{"location":"redis/sentinel/202202/1.Redis%E5%93%A8%E5%85%B5%E8%8A%82%E7%82%B9%E8%B0%83%E6%95%B4.html#5redis-sentinel","text":"","title":"5\u3001\u79fb\u9664Redis-sentinel"},{"location":"redis/sentinel/202202/2.Redis-API.html","text":"Redis-API \u00b6 Redis\u90e8\u7f72\u6a21\u5f0f\u4e3b\u8981\u5305\u542b\u54e8\u5175\u6a21\u5f0f\u548c\u96c6\u7fa4\u6a21\u5f0f\u4e24\u79cd\u6a21\u5f0f\uff0c\u6bcf\u4e00\u79cd\u90fd\u9700\u8981\u5148\u90e8\u7f72\u5b8c\u5355\u673a\u7248\u7684Redis\uff0c\u5728\u8fdb\u884c\u9488\u5bf9\u6027\u90e8\u7f72\uff1a 1.1 \u7cfb\u7edf\u53c2\u6570\u8c03\u6574 \u00b6 # \u4fee\u6539vm.overcommit_memory shell> vim /etc/sysctl.conf vm.overcommit_memory = 1 shell> sysctl vm.overcommit_memory=1 # \u7981\u7528\u5927\u9875\u4f20\u8f93 shell> echo never > /sys/kernel/mm/transparent_hugepage/enabled shell> echo never > /sys/kernel/mm/transparent_hugepage/enabled\" >>/etc/rc.local 1.2 \u5b89\u88c5\u5305\u4e0b\u8f7d \u00b6 \u5b89\u88c5\u5305\u53ef\u4ee5\u5230 Redis\u5b98\u7f51 \u6216\u8005\u5bf9\u5e94\u7684 GitHub\u4ed3\u5e93 \u8fdb\u884c\u4e0b\u8f7d # Redis\u5b98\u7f51 wget https://download.redis.io/releases/redis-5.0.12.tar.gz # Github\u4ed3\u5e93 wget https://github.com/redis/redis/archive/refs/tags/5.0.12.tar.gz 1.3 \u7f16\u8bd1\u5b89\u88c5 \u00b6 shell>tar -xzvf redis-5.0.12.tar.gz shell>cd redis-5.0.12 shell>make $$ make install # \u8fd0\u884c\u5b8c\u4e0a\u8ff0\u547d\u4ee4\u4ee5\u540e\uff0c\u9ed8\u8ba4\u5c06Redis\u76f8\u5173\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5b89\u88c5\u5230/usr/local/bin\u8def\u5f84\u4e0b # \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u786e\u8ba4Redis\u7248\u672c\u4ee5\u53ca\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u662f\u5426\u4f4d\u4e8e\u73af\u5883\u53d8\u91cf\u5185 shell>which redis-server /usr/local/bin/redis-server shell>redis-server --version Redis server v = 5 .0.7 sha = 00000000 :0 malloc = jemalloc-5.1.0 bits = 64 build = a257f57b53913ab shell>ll /usr/local/bin/ | grep redis -rwxr-xr-x 1 root root 4366848 Jun 28 20 :41 redis-benchmark -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-check-aof -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-check-rdb -rwxr-xr-x 1 root root 4807920 Jun 28 20 :41 redis-cli lrwxrwxrwx 1 root root 12 Jun 28 20 :41 redis-sentinel -> redis-server -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-server 1.4 \u6839\u636e\u5b9e\u9645\u9700\u6c42\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6 \u00b6 1.5 \u914d\u7f6eRedis\u5f00\u673a\u542f\u52a8\u811a\u672c \u00b6 1.5.1 \u8fd0\u884c\u73af\u5883\u51c6\u5907 \u00b6 shell> groupadd -g 6379 redis ; useradd -s /sbin/nologin redis -g redis -u 6379 shell> export Redis_base_dir = /apply/redisdata shell> mkdir -p ${ Redis_base_dir } / { data,log,run } shell> chown -R redis:redis ${ Redis_base_dir } 1.5.2 \u914d\u7f6eRedis\u670d\u52a1\u542f\u52a8 \u00b6 \u5c06\u6b64\u811a\u672c\u653e\u5230 /usr/lib/systemd/system/\u4e0b cat /usr/lib/systemd/system/redis-server.service [ Unit ] Description = The redis-server Process Manager After = syslog.target network.target [ Service ] User = redis Group = redis Type = forking # \u4ee5\u4e0b\u9009\u9879\u53ef\u6839\u636eRedis\u53ef\u6267\u884c\u6587\u4ef6\u548c\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u4f4d\u7f6e\u8fdb\u884c\u8fdb\u884c\u4fee\u6539 ExecStart = /usr/local/bin/redis-server /usr/local/redis/config/redis.conf ExecReload = /bin/kill -USR2 $MAINPID ExecStartPost = /bin/sleep 1 ExecStop = /bin/kill -SIGINT $MAINPID PIDFile = /data/redisdata/run/redis.pid [ Install ] WantedBy = multi-user.target \u914d\u7f6e\u5f00\u673a\u542f\u52a8\u811a\u672c [root@localhost ~]# systemctl enable redis-server Created symlink from /etc/systemd/system/multi-user.target.wants/redis-server.service to /usr/lib/systemd/system/redis-server.service [root@localhost ~]# systemctl status redis-server \u25cf redis-server.service - The redis-server Process Manager Loaded: loaded (/usr/lib/systemd/system/redis-server.service; enabled; vendor preset: disabled) Active: active (running) since Wed 2021-12-15 16:40:10 CST; 1 weeks 0 days ago Main PID: 24562 (redis-server) CGroup: /system.slice/redis-server.service \u2514\u250024562 /usr/local/bin/redis-server *:6379 Dec 15 16:40:09 localhost.localdomain systemd[1]: Starting The redis-server Process Manager... Dec 15 16:40:10 localhost.localdomain systemd[1]: Started The redis-server Process Manager","title":"Redis-API"},{"location":"redis/sentinel/202202/2.Redis-API.html#redis-api","text":"Redis\u90e8\u7f72\u6a21\u5f0f\u4e3b\u8981\u5305\u542b\u54e8\u5175\u6a21\u5f0f\u548c\u96c6\u7fa4\u6a21\u5f0f\u4e24\u79cd\u6a21\u5f0f\uff0c\u6bcf\u4e00\u79cd\u90fd\u9700\u8981\u5148\u90e8\u7f72\u5b8c\u5355\u673a\u7248\u7684Redis\uff0c\u5728\u8fdb\u884c\u9488\u5bf9\u6027\u90e8\u7f72\uff1a","title":"Redis-API"},{"location":"redis/sentinel/202202/2.Redis-API.html#11","text":"# \u4fee\u6539vm.overcommit_memory shell> vim /etc/sysctl.conf vm.overcommit_memory = 1 shell> sysctl vm.overcommit_memory=1 # \u7981\u7528\u5927\u9875\u4f20\u8f93 shell> echo never > /sys/kernel/mm/transparent_hugepage/enabled shell> echo never > /sys/kernel/mm/transparent_hugepage/enabled\" >>/etc/rc.local","title":"1.1 \u7cfb\u7edf\u53c2\u6570\u8c03\u6574"},{"location":"redis/sentinel/202202/2.Redis-API.html#12","text":"\u5b89\u88c5\u5305\u53ef\u4ee5\u5230 Redis\u5b98\u7f51 \u6216\u8005\u5bf9\u5e94\u7684 GitHub\u4ed3\u5e93 \u8fdb\u884c\u4e0b\u8f7d # Redis\u5b98\u7f51 wget https://download.redis.io/releases/redis-5.0.12.tar.gz # Github\u4ed3\u5e93 wget https://github.com/redis/redis/archive/refs/tags/5.0.12.tar.gz","title":"1.2 \u5b89\u88c5\u5305\u4e0b\u8f7d"},{"location":"redis/sentinel/202202/2.Redis-API.html#13","text":"shell>tar -xzvf redis-5.0.12.tar.gz shell>cd redis-5.0.12 shell>make $$ make install # \u8fd0\u884c\u5b8c\u4e0a\u8ff0\u547d\u4ee4\u4ee5\u540e\uff0c\u9ed8\u8ba4\u5c06Redis\u76f8\u5173\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5b89\u88c5\u5230/usr/local/bin\u8def\u5f84\u4e0b # \u8fd0\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u786e\u8ba4Redis\u7248\u672c\u4ee5\u53ca\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u662f\u5426\u4f4d\u4e8e\u73af\u5883\u53d8\u91cf\u5185 shell>which redis-server /usr/local/bin/redis-server shell>redis-server --version Redis server v = 5 .0.7 sha = 00000000 :0 malloc = jemalloc-5.1.0 bits = 64 build = a257f57b53913ab shell>ll /usr/local/bin/ | grep redis -rwxr-xr-x 1 root root 4366848 Jun 28 20 :41 redis-benchmark -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-check-aof -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-check-rdb -rwxr-xr-x 1 root root 4807920 Jun 28 20 :41 redis-cli lrwxrwxrwx 1 root root 12 Jun 28 20 :41 redis-sentinel -> redis-server -rwxr-xr-x 1 root root 8125240 Jun 28 20 :41 redis-server","title":"1.3 \u7f16\u8bd1\u5b89\u88c5"},{"location":"redis/sentinel/202202/2.Redis-API.html#14","text":"","title":"1.4 \u6839\u636e\u5b9e\u9645\u9700\u6c42\uff0c\u4fee\u6539\u914d\u7f6e\u6587\u4ef6"},{"location":"redis/sentinel/202202/2.Redis-API.html#15-redis","text":"","title":"1.5 \u914d\u7f6eRedis\u5f00\u673a\u542f\u52a8\u811a\u672c"},{"location":"redis/sentinel/202202/2.Redis-API.html#151","text":"shell> groupadd -g 6379 redis ; useradd -s /sbin/nologin redis -g redis -u 6379 shell> export Redis_base_dir = /apply/redisdata shell> mkdir -p ${ Redis_base_dir } / { data,log,run } shell> chown -R redis:redis ${ Redis_base_dir }","title":"1.5.1 \u8fd0\u884c\u73af\u5883\u51c6\u5907"},{"location":"redis/sentinel/202202/2.Redis-API.html#152-redis","text":"\u5c06\u6b64\u811a\u672c\u653e\u5230 /usr/lib/systemd/system/\u4e0b cat /usr/lib/systemd/system/redis-server.service [ Unit ] Description = The redis-server Process Manager After = syslog.target network.target [ Service ] User = redis Group = redis Type = forking # \u4ee5\u4e0b\u9009\u9879\u53ef\u6839\u636eRedis\u53ef\u6267\u884c\u6587\u4ef6\u548c\u914d\u7f6e\u6587\u4ef6\u6240\u5728\u4f4d\u7f6e\u8fdb\u884c\u8fdb\u884c\u4fee\u6539 ExecStart = /usr/local/bin/redis-server /usr/local/redis/config/redis.conf ExecReload = /bin/kill -USR2 $MAINPID ExecStartPost = /bin/sleep 1 ExecStop = /bin/kill -SIGINT $MAINPID PIDFile = /data/redisdata/run/redis.pid [ Install ] WantedBy = multi-user.target \u914d\u7f6e\u5f00\u673a\u542f\u52a8\u811a\u672c [root@localhost ~]# systemctl enable redis-server Created symlink from /etc/systemd/system/multi-user.target.wants/redis-server.service to /usr/lib/systemd/system/redis-server.service [root@localhost ~]# systemctl status redis-server \u25cf redis-server.service - The redis-server Process Manager Loaded: loaded (/usr/lib/systemd/system/redis-server.service; enabled; vendor preset: disabled) Active: active (running) since Wed 2021-12-15 16:40:10 CST; 1 weeks 0 days ago Main PID: 24562 (redis-server) CGroup: /system.slice/redis-server.service \u2514\u250024562 /usr/local/bin/redis-server *:6379 Dec 15 16:40:09 localhost.localdomain systemd[1]: Starting The redis-server Process Manager... Dec 15 16:40:10 localhost.localdomain systemd[1]: Started The redis-server Process Manager","title":"1.5.2 \u914d\u7f6eRedis\u670d\u52a1\u542f\u52a8"}]}